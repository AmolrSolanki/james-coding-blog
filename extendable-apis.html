<!DOCTYPE html><html><head><title>Joys Of Apex | Extendable APIs</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="/joys-of-apex/favicon.ico"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/joys-of-apex/styles/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/joys-of-apex/bundle/codedoc-bundle.js"></script><meta property="og:image" content="./img/joys-of-apex-thumbnail.png"><script>window.githubConfig={"repo":"james-coding-blog","user":"jamessimone"}</script><style>.container{padding-top: 0 !important}</style><style>#-codedoc-toc { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px) }</style><meta name="twitter:title" content="Joys Of Apex | Extendable APIs"><meta property="og:type" content="article"><meta property="og:title" content="Joys Of Apex | Extendable APIs"></head><body><header style="margin-left: 1rem">Read more at <a href="https://wwww.jamessimone.net">jamessimone.net</a>, or return to the <a href="/joys-of-apex/">homepage</a></header><div id="-codedoc-container" class="container"><script>window.source = {"base":"posts","path":"extendable-apis.md","namespace":"/joys-of-apex","title":{"base":"Joys Of Apex","connector":" | "}}</script><div class="hero-0-0-8" style="margin-bottom: -156px"><img src="/joys-of-apex/img/the-joys-of-apex.png" class="image-0-0-9" data-hero=""><span class="caption-0-0-10"></span></div><marker><br>
<br>
<br>
<br>
<br>

</marker><h1 class="h-0-0-11 "><span style="color: green; 
      text-shadow: none; 
      font-size: 48px"><p>Extendable APIs</p></span></h1><script id="VZscCNtixX">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("VZscCNtixX", "kRzsgnV+B7EQTskbovy+YA==", {"src":"github","date":"2020-03-10T15:00:00.000Z"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div hidden="" data-ignore-text="" data-meta-override-property="og:image"><p>./img/joys-of-apex-thumbnail.png</p></div><p>API development in Apex (and pretty much every other language) is mostly bespoke, requiring the duplication of rest resources. Let's look at how we can change that using inheritance and polymorphism to power our routes. But first ...</p><p>At a certain point in everybody’s object-oriented journey, they are forced to confront a brutal truth of the world — in order to accept the power of polymorphism, sacrifices (typically) must be made. Somewhere, in the grand orchestra of closures and their concomitantly produced methods, a conductor must exist. Somewhere, things must be coupled more tightly than we would like to admit. This necessary evil wears many names; one but suits it for a short time only, and over time its etymological roots grow deeper and wider. We hear it referred to in tongues both ancient and modern, a manic susurrus with many words all converging towards one meaning:</p><ul><li>Factory</li><li>Manager</li><li>Assembler</li><li>Processor</li><li>Builder</li></ul><p>This conductor comes in many forms, but it is this entity that gives shape — gives meaning! — to the greater system it surrounds. Like some demented Rube Goldberg machine, it says “if this, do that.” Like the punch-card machine code that once defaced (or graced, opinion-dependent) the depths of this planet, the conductor knows exactly which instruments should be playing at any given moment. It observes; it coordinates; it flourishes. Deciding how and when to create polymorphic objects is its <em>jam</em>.</p><p>Let’s see what good old <a href="https://www.goodreads.com/book/show/3735293-clean-code">Uncle Bob</a> has to say on the subject:</p><blockquote><p>The solution to this problem is to bury the switch statement in the basement of an <em>ABSTRACT FACTORY</em>, and never let anyone see it.</p></blockquote><p>Uncle Bob would have our conductor live in the <strong>BASEMENT</strong>. Otherwise though, his point stands (somewhat charmingly, considering how recently Apex even got switch statements).</p><p>He also says:</p><blockquote><p>Duplication may be the root of all evil in software. Many principles and practices have been created for the purpose of controlling or eliminating it.</p></blockquote><p>And what does all this have to do with APIs? Is it true that we'll always need a factory method to dynamically produce polymorphic objects? Read on, dear Reader ...</p><hr><h2 id="what-a-typical-apex-api-looks-like" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>What A Typical Apex API Looks Like</h2><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="@RestResource(urlMapping='/orders/*')"><span class="lineCounter-0-0-15 prim">1</span><span class="token annotation punctuation">@RestResource</span><span class="token punctuation">(</span>urlMapping<span class="token operator">=</span><span class="token string">'/orders/*'</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="global class OrderService {"><span class="lineCounter-0-0-15">2</span>global <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    @HttpPost"><span class="lineCounter-0-0-15">3</span>    <span class="token annotation punctuation">@HttpPost</span></div><br><div class="line-0-0-16 " data-content="    global static String post(Order order) {"><span class="lineCounter-0-0-15">4</span>    global <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        /*do something with the order"><span class="lineCounter-0-0-15 prim">5</span>        <span class="token comment">/*do something with the order</span></div><br><div class="line-0-0-16 " data-content="        possibly by instantiating another class"><span class="lineCounter-0-0-15">6</span>        possibly by instantiating another class</div><br><div class="line-0-0-16 " data-content="        we will just skip over this not being bulkified for now ...*/"><span class="lineCounter-0-0-15">7</span>        we will just skip over this not being bulkified for now ...*/</div><br><div class="line-0-0-16 " data-content="        return 'Success';"><span class="lineCounter-0-0-15">8</span>        <span class="token keyword">return</span> <span class="token string">'Success'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">9</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">10</span><span class="token punctuation">}</span></div><br></code></pre><p>This is fine boilerplate (<em>probably</em>) in the event that you only have one or two APIs communicating with external services. For distributed systems with many needs to interact with your Salesforce instance, though, you're going to quickly find yourself saying things like: "what was the syntax for creating the API again? <em>goes and looks it up.</em> Oh, that's right, '@RestResource', and the class needs to be global ...".</p><p>Plus, every time some other team needs to interact with some of your objects, your <em>best case</em> scenario is that they agree to honor contracts (in this case, another word for interfaces ...) you put forth as to the shape of the Salesforce objects / classes that you already have in place ... and you'll still need to go ahead and create the extra routes / API methods.</p><p>Can we come up with something more dynamic that enables the creation and organization of new and existing routes without all this mess? Can we do so while avoiding the typical Factory switch statement? How might we go about doing so?</p><p>Looking at that typical example, several insights may immediately jump to mind about the steps necessary to tame the beast:</p><ul><li>Because REST resources need to use static methods, this is one of the very few use-cases where I support the use of a <a href="https://en.wikipedia.org/wiki/Facade_pattern">Facade Pattern</a> -- separating the concerns of calling the underlying APIs from the service where the routes are actually constructed</li><li>If you read <a href="/joys-of-apex/idiomatic-salesforce-apex/">Idiomatic Apex</a>, you'll know that the best way to implement the Facade is through the use of the Apex singleton pattern</li><li>Can we finagle a system into being that will tie the name of the route our consumers are trying to use to the objects that will handle their requests? (This, instead of the switch statement)</li></ul><h2 id="creating-dynamic-extendable-apis" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Creating Dynamic Extendable APIs</h2><p>Let's write a few tests for an object that will be crucial in the success of implementing a more dynamic set of rest resources within Apex. We'll need a resolver of sorts to extract what some people like to call the "needful information" from incoming rest requests (tests first!):</p><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="@isTest"><span class="lineCounter-0-0-15 prim">1</span><span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="private class ApiRequestResolverTests {"><span class="lineCounter-0-0-15">2</span><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">ApiRequestResolverTests</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    @isTest"><span class="lineCounter-0-0-15">3</span>    <span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="    static void it_should_resolve_api_route() {"><span class="lineCounter-0-0-15">4</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_resolve_api_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        String endpointName = 'orders';"><span class="lineCounter-0-0-15 prim">5</span>        <span class="token class-name">String</span> endpointName <span class="token operator">=</span> <span class="token string">'orders'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        RestRequest req = new RestRequest();"><span class="lineCounter-0-0-15">6</span>        <span class="token class-name">RestRequest</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        req.requestURI = '/services/apexrest/api/' + endpointName + '/';"><span class="lineCounter-0-0-15">7</span>        req<span class="token punctuation">.</span>requestURI <span class="token operator">=</span> <span class="token string">'/services/apexrest/api/'</span> <span class="token operator">+</span> endpointName <span class="token operator">+</span> <span class="token string">'/'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">8</span></div><br><div class="line-0-0-16 " data-content="        ApiRequestResolver resolver = new ApiRequestResolver(req);"><span class="lineCounter-0-0-15">9</span>        <span class="token class-name">ApiRequestResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApiRequestResolver</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">10</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(endpointName.capitalize(), resolver.ApiName);"><span class="lineCounter-0-0-15">11</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>endpointName<span class="token punctuation">.</span><span class="token function">capitalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> resolver<span class="token punctuation">.</span><span class="token class-name">ApiName</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">12</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">13</span></div><br><div class="line-0-0-16 " data-content="    @isTest"><span class="lineCounter-0-0-15">14</span>    <span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="    static void it_should_handle_non_trailing_slash() {"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_handle_non_trailing_slash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        String endpointName = 'orders';"><span class="lineCounter-0-0-15">16</span>        <span class="token class-name">String</span> endpointName <span class="token operator">=</span> <span class="token string">'orders'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        RestRequest req = new RestRequest();"><span class="lineCounter-0-0-15">17</span>        <span class="token class-name">RestRequest</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        req.requestURI = '/services/apexrest/api/' + endpointName;"><span class="lineCounter-0-0-15">18</span>        req<span class="token punctuation">.</span>requestURI <span class="token operator">=</span> <span class="token string">'/services/apexrest/api/'</span> <span class="token operator">+</span> endpointName<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">19</span></div><br><div class="line-0-0-16 " data-content="        ApiRequestResolver resolver = new ApiRequestResolver(req);"><span class="lineCounter-0-0-15 prim">20</span>        <span class="token class-name">ApiRequestResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApiRequestResolver</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">21</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(endpointName.capitalize(), resolver.ApiName);"><span class="lineCounter-0-0-15">22</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>endpointName<span class="token punctuation">.</span><span class="token function">capitalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> resolver<span class="token punctuation">.</span><span class="token class-name">ApiName</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">23</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">24</span></div><br><div class="line-0-0-16 " data-content="    @isTest"><span class="lineCounter-0-0-15 prim">25</span>    <span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="    static void it_should_resolve_request_body() {"><span class="lineCounter-0-0-15">26</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_resolve_request_body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        String body = '{}';"><span class="lineCounter-0-0-15">27</span>        <span class="token class-name">String</span> body <span class="token operator">=</span> <span class="token string">'{}'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        RestRequest req = new RestRequest();"><span class="lineCounter-0-0-15">28</span>        <span class="token class-name">RestRequest</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        req.requestBody = Blob.valueOf(body);"><span class="lineCounter-0-0-15">29</span>        req<span class="token punctuation">.</span>requestBody <span class="token operator">=</span> <span class="token class-name">Blob</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">30</span></div><br><div class="line-0-0-16 " data-content="        ApiRequestResolver resolver = new ApiRequestResolver(req);"><span class="lineCounter-0-0-15">31</span>        <span class="token class-name">ApiRequestResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApiRequestResolver</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">32</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(body, resolver.RequestBody);"><span class="lineCounter-0-0-15">33</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> resolver<span class="token punctuation">.</span><span class="token class-name">RequestBody</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">34</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">35</span></div><br><div class="line-0-0-16 " data-content="    @isTest"><span class="lineCounter-0-0-15">36</span>    <span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="    static void it_should_resolve_request_url_param() {"><span class="lineCounter-0-0-15">37</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_resolve_request_url_param</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        String fakeAccountId = '0016g00000EPjVcXXX';"><span class="lineCounter-0-0-15">38</span>        <span class="token class-name">String</span> fakeAccountId <span class="token operator">=</span> <span class="token string">'0016g00000EPjVcXXX'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        RestRequest req = new RestRequest();"><span class="lineCounter-0-0-15">39</span>        <span class="token class-name">RestRequest</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        req.requestURI = '/services/apexrest/api/account/' + fakeAccountId;"><span class="lineCounter-0-0-15 prim">40</span>        req<span class="token punctuation">.</span>requestURI <span class="token operator">=</span> <span class="token string">'/services/apexrest/api/account/'</span> <span class="token operator">+</span> fakeAccountId<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">41</span></div><br><div class="line-0-0-16 " data-content="        ApiRequestResolver resolver = new ApiRequestResolver(req);"><span class="lineCounter-0-0-15">42</span>        <span class="token class-name">ApiRequestResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApiRequestResolver</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">43</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(fakeAccountId, resolver.RequestUrlBody);"><span class="lineCounter-0-0-15">44</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>fakeAccountId<span class="token punctuation">,</span> resolver<span class="token punctuation">.</span><span class="token class-name">RequestUrlBody</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">45</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">46</span><span class="token punctuation">}</span></div><br></code></pre><p>And the (admittedly basic) implementation:</p><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="public class ApiRequestResolver {"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiRequestResolver</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    private final String apiBase = '/api/';"><span class="lineCounter-0-0-15">2</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> apiBase <span class="token operator">=</span> <span class="token string">'/api/'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">3</span></div><br><div class="line-0-0-16 " data-content="    public String ApiName { get; private set; }"><span class="lineCounter-0-0-15">4</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">ApiName</span> <span class="token punctuation">{</span> get<span class="token punctuation">;</span> <span class="token keyword">private</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    public String RequestBody { get; private set; }"><span class="lineCounter-0-0-15 prim">5</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">RequestBody</span> <span class="token punctuation">{</span> get<span class="token punctuation">;</span> <span class="token keyword">private</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    public String RequestUrlBody { get; private set; }"><span class="lineCounter-0-0-15">6</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">RequestUrlBody</span> <span class="token punctuation">{</span> get<span class="token punctuation">;</span> <span class="token keyword">private</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">7</span></div><br><div class="line-0-0-16 " data-content="    public ApiRequestResolver(RestRequest req) {"><span class="lineCounter-0-0-15">8</span>    <span class="token keyword">public</span> <span class="token class-name">ApiRequestResolver</span><span class="token punctuation">(</span><span class="token class-name">RestRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        this.ApiName = this.getApiName(req.requestURI);"><span class="lineCounter-0-0-15">9</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">ApiName</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getApiName</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>requestURI<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        this.RequestBody = req.requestBody != null ?"><span class="lineCounter-0-0-15 prim">10</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">RequestBody</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>requestBody <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span></div><br><div class="line-0-0-16 " data-content="            req.requestBody.toString() :"><span class="lineCounter-0-0-15">11</span>            req<span class="token punctuation">.</span>requestBody<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span></div><br><div class="line-0-0-16 " data-content="            '';"><span class="lineCounter-0-0-15">12</span>            <span class="token string">''</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        //taken straight outta the docs..."><span class="lineCounter-0-0-15">13</span>        <span class="token comment">//taken straight outta the docs...</span></div><br><div class="line-0-0-16 " data-content="        this.RequestUrlBody = req.requestURI != null ?"><span class="lineCounter-0-0-15">14</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">RequestUrlBody</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>requestURI <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span></div><br><div class="line-0-0-16 " data-content="            req.requestURI.substring(req.requestURI.lastIndexOf('/') + 1)"><span class="lineCounter-0-0-15 prim">15</span>            req<span class="token punctuation">.</span>requestURI<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>requestURI<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="            : '';"><span class="lineCounter-0-0-15">16</span>            <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">17</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">18</span></div><br><div class="line-0-0-16 " data-content="    private String getApiName(String requestURI) {"><span class="lineCounter-0-0-15">19</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getApiName</span><span class="token punctuation">(</span><span class="token class-name">String</span> requestURI<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        if(requestURI == null) { return ''; }"><span class="lineCounter-0-0-15 prim">20</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>requestURI <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="        Integer apiNameStart = requestURI.indexOf(apiBase) + apiBase.length();"><span class="lineCounter-0-0-15">21</span>        <span class="token class-name">Integer</span> apiNameStart <span class="token operator">=</span> requestURI<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>apiBase<span class="token punctuation">)</span> <span class="token operator">+</span> apiBase<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        Integer lastSlash = requestURI.lastIndexOf('/');"><span class="lineCounter-0-0-15">22</span>        <span class="token class-name">Integer</span> lastSlash <span class="token operator">=</span> requestURI<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        Integer apiNameEnd = lastSlash < apiNameStart ? requestURI.length() : lastSlash;"><span class="lineCounter-0-0-15">23</span>        <span class="token class-name">Integer</span> apiNameEnd <span class="token operator">=</span> lastSlash <span class="token operator">&lt;</span> apiNameStart <span class="token operator">?</span> requestURI<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> lastSlash<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        return requestURI.substring(apiNameStart, apiNameEnd).capitalize();"><span class="lineCounter-0-0-15">24</span>        <span class="token keyword">return</span> requestURI<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>apiNameStart<span class="token punctuation">,</span> apiNameEnd<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">capitalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">25</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">26</span><span class="token punctuation">}</span></div><br></code></pre><p>Our master API class is minimal. It merely defines the HTTP methods that are possible. It's route-agnostic. It creates the <code>ApiRequestResolver</code>, and delegates the rest downwards:</p><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="@RestResource(urlMapping='/api/*')"><span class="lineCounter-0-0-15 prim">1</span><span class="token annotation punctuation">@RestResource</span><span class="token punctuation">(</span>urlMapping<span class="token operator">=</span><span class="token string">'/api/*'</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="global class ApiService {"><span class="lineCounter-0-0-15">2</span>global <span class="token keyword">class</span> <span class="token class-name">ApiService</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    private static final ApiRequestResolver resolver ="><span class="lineCounter-0-0-15">3</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ApiRequestResolver</span> resolver <span class="token operator">=</span></div><br><div class="line-0-0-16 " data-content="        new ApiRequestResolver(RestContext.request);"><span class="lineCounter-0-0-15">4</span>        <span class="token keyword">new</span> <span class="token class-name">ApiRequestResolver</span><span class="token punctuation">(</span><span class="token class-name">RestContext</span><span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">5</span></div><br><div class="line-0-0-16 " data-content="    @HttpDelete"><span class="lineCounter-0-0-15">6</span>    <span class="token annotation punctuation">@HttpDelete</span></div><br><div class="line-0-0-16 " data-content="    global static Api.Response doDelete() {"><span class="lineCounter-0-0-15">7</span>    global <span class="token keyword">static</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> <span class="token function">doDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        return Api.Facade.doDelete(resolver);"><span class="lineCounter-0-0-15">8</span>        <span class="token keyword">return</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Facade</span><span class="token punctuation">.</span><span class="token function">doDelete</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">9</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">10</span></div><br><div class="line-0-0-16 " data-content="    @HttpGet"><span class="lineCounter-0-0-15">11</span>    <span class="token annotation punctuation">@HttpGet</span></div><br><div class="line-0-0-16 " data-content="    global static Api.Response doGet() {"><span class="lineCounter-0-0-15">12</span>    global <span class="token keyword">static</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        return Api.Facade.doGet(resolver);"><span class="lineCounter-0-0-15">13</span>        <span class="token keyword">return</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Facade</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">14</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">15</span></div><br><div class="line-0-0-16 " data-content="    @HttpPatch"><span class="lineCounter-0-0-15">16</span>    <span class="token annotation punctuation">@HttpPatch</span></div><br><div class="line-0-0-16 " data-content="    global static Api.Response patch() {"><span class="lineCounter-0-0-15">17</span>    global <span class="token keyword">static</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> <span class="token function">patch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        return Api.Facade.doPatch(resolver);"><span class="lineCounter-0-0-15">18</span>        <span class="token keyword">return</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Facade</span><span class="token punctuation">.</span><span class="token function">doPatch</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">19</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">20</span></div><br><div class="line-0-0-16 " data-content="    @HttpPost"><span class="lineCounter-0-0-15">21</span>    <span class="token annotation punctuation">@HttpPost</span></div><br><div class="line-0-0-16 " data-content="    global static Api.Response post() {"><span class="lineCounter-0-0-15">22</span>    global <span class="token keyword">static</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        return Api.Facade.doPost(resolver);"><span class="lineCounter-0-0-15">23</span>        <span class="token keyword">return</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Facade</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">24</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">25</span></div><br><div class="line-0-0-16 " data-content="    @HttpPut"><span class="lineCounter-0-0-15">26</span>    <span class="token annotation punctuation">@HttpPut</span></div><br><div class="line-0-0-16 " data-content="    global static Api.Response put() {"><span class="lineCounter-0-0-15">27</span>    global <span class="token keyword">static</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        return Api.Facade.doPut(resolver);"><span class="lineCounter-0-0-15">28</span>        <span class="token keyword">return</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Facade</span><span class="token punctuation">.</span><span class="token function">doPut</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">29</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">30</span><span class="token punctuation">}</span></div><br></code></pre><p>The tests are simple, and a pleasure (just one route shown for brevity's sake):</p><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="@isTest"><span class="lineCounter-0-0-15 prim">1</span><span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="private class ApiServiceTests {"><span class="lineCounter-0-0-15">2</span><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">ApiServiceTests</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    @isTest"><span class="lineCounter-0-0-15">3</span>    <span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="    static void it_should_return_fail_for_not_existent_route() {"><span class="lineCounter-0-0-15">4</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_return_fail_for_not_existent_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        RestContext.request = new RestRequest();"><span class="lineCounter-0-0-15 prim">5</span>        <span class="token class-name">RestContext</span><span class="token punctuation">.</span>request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        RestContext.request.requestURI = '/api/fake/';"><span class="lineCounter-0-0-15">6</span>        <span class="token class-name">RestContext</span><span class="token punctuation">.</span>request<span class="token punctuation">.</span>requestURI <span class="token operator">=</span> <span class="token string">'/api/fake/'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">7</span></div><br><div class="line-0-0-16 " data-content="        Api.Response res = ApiService.doGet();"><span class="lineCounter-0-0-15">8</span>        <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> res <span class="token operator">=</span> <span class="token class-name">ApiService</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">9</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(false, res.Success);"><span class="lineCounter-0-0-15 prim">10</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token class-name">Success</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(Api.BASIC_RESPONSE, res.ResponseBody);"><span class="lineCounter-0-0-15">11</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token class-name">Api</span><span class="token punctuation">.</span>BASIC_RESPONSE<span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token class-name">ResponseBody</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">12</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">13</span></div><br><div class="line-0-0-16 " data-content="    @isTest"><span class="lineCounter-0-0-15">14</span>    <span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="    static void it_should_return_true_for_existing_route() {"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_return_true_for_existing_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        RestContext.request = new RestRequest();"><span class="lineCounter-0-0-15">16</span>        <span class="token class-name">RestContext</span><span class="token punctuation">.</span>request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        RestContext.request.requestURI = '/api/test/';"><span class="lineCounter-0-0-15">17</span>        <span class="token class-name">RestContext</span><span class="token punctuation">.</span>request<span class="token punctuation">.</span>requestURI <span class="token operator">=</span> <span class="token string">'/api/test/'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">18</span></div><br><div class="line-0-0-16 " data-content="        //have to insert the &quot;namespace&quot; for the test class"><span class="lineCounter-0-0-15">19</span>        <span class="token comment">//have to insert the "namespace" for the test class</span></div><br><div class="line-0-0-16 " data-content="        //otherwise it will fail to dynamically build correctly"><span class="lineCounter-0-0-15 prim">20</span>        <span class="token comment">//otherwise it will fail to dynamically build correctly</span></div><br><div class="line-0-0-16 " data-content="        Api.HANDLER_NAME = 'ApiServiceTests.' + Api.HANDLER_NAME;"><span class="lineCounter-0-0-15">21</span>        <span class="token class-name">Api</span><span class="token punctuation">.</span>HANDLER_NAME <span class="token operator">=</span> <span class="token string">'ApiServiceTests.'</span> <span class="token operator">+</span> <span class="token class-name">Api</span><span class="token punctuation">.</span>HANDLER_NAME<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">22</span></div><br><div class="line-0-0-16 " data-content="        Api.Response res = ApiService.doGet();"><span class="lineCounter-0-0-15">23</span>        <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> res <span class="token operator">=</span> <span class="token class-name">ApiService</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">24</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(true, res.Success);"><span class="lineCounter-0-0-15 prim">25</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token class-name">Success</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(TEST_RESPONSE, res.ResponseBody);"><span class="lineCounter-0-0-15">26</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>TEST_RESPONSE<span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token class-name">ResponseBody</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">27</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">28</span></div><br><div class="line-0-0-16 " data-content="    static String TEST_RESPONSE = 'test';"><span class="lineCounter-0-0-15">29</span>    <span class="token keyword">static</span> <span class="token class-name">String</span> TEST_RESPONSE <span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    public class ApiHandlerTest extends Api.Handler {"><span class="lineCounter-0-0-15 prim">30</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiHandlerTest</span> <span class="token keyword">extends</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Handler</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        public override Api.Response doGet(ApiRequestResolver resolver) {"><span class="lineCounter-0-0-15">31</span>        <span class="token keyword">public</span> override <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">ApiRequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            Api.Response res = this.getResponse(TEST_RESPONSE);"><span class="lineCounter-0-0-15">32</span>            <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span>TEST_RESPONSE<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            res.Success = true;"><span class="lineCounter-0-0-15">33</span>            res<span class="token punctuation">.</span><span class="token class-name">Success</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            return res;"><span class="lineCounter-0-0-15">34</span>            <span class="token keyword">return</span> res<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15 prim">35</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">36</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">37</span><span class="token punctuation">}</span></div><br></code></pre><p>At a very high level, if you were to see only these tests, you would probably understand 95% of how to interact with a given API:</p><ul><li>there needs to be a class that extends another class called <code>Api.Handler</code></li><li>that class has access to override HTTP methods in order to get things done</li><li>that class's name corresponds to route that ends up getting used</li></ul><p>When I first wrote this article, I had the facade in a different, stand-alone, class ... but when I took a break from writing and thought more about it, I realized that for me, personally, encapsulating the different aspects of the API into one abstract class (a pseudo-namespace, in other words) was appealing. Your mileage may vary. I find things fit nicely into classes like this, provided they don't get too large; minimizing the surface area I need to grok when re-reading and re-remembering. Plus, the stand-alone facade class was still reaching into the Api class to make use of the constant <code>HANDLER_NAME</code> -- a code smell that I wasn't pleased with.</p><p>It's possible you'll have strong feelings about this pseudo-namespace and want things separated. To be clear -- I think that's perfectly fine. What works for me won't always work for you. This article is meant more as an exercise in the creation of dynamic APIs rather than an interjection on the best file structure:</p><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="global abstract class Api {"><span class="lineCounter-0-0-15 prim">1</span>global <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Api</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    public static String HANDLER_NAME = 'ApiHandler';"><span class="lineCounter-0-0-15">2</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> HANDLER_NAME <span class="token operator">=</span> <span class="token string">'ApiHandler'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    public static final String BASIC_RESPONSE = 'HTTP method not yet implemented';"><span class="lineCounter-0-0-15">3</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> BASIC_RESPONSE <span class="token operator">=</span> <span class="token string">'HTTP method not yet implemented'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">4</span></div><br><div class="line-0-0-16 " data-content="    global class Response {"><span class="lineCounter-0-0-15 prim">5</span>    global <span class="token keyword">class</span> <span class="token class-name">Response</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        global Response(String body) {"><span class="lineCounter-0-0-15">6</span>        global <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token class-name">String</span> body<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            this.Success = false;"><span class="lineCounter-0-0-15">7</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">Success</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            this.ResponseBody = body;"><span class="lineCounter-0-0-15">8</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">ResponseBody</span> <span class="token operator">=</span> body<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">9</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">10</span></div><br><div class="line-0-0-16 " data-content="        public Boolean Success { get; set; }"><span class="lineCounter-0-0-15">11</span>        <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token class-name">Success</span> <span class="token punctuation">{</span> get<span class="token punctuation">;</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="        public String ResponseBody { get; private set; }"><span class="lineCounter-0-0-15">12</span>        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">ResponseBody</span> <span class="token punctuation">{</span> get<span class="token punctuation">;</span> <span class="token keyword">private</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">13</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">14</span></div><br><div class="line-0-0-16 " data-content="    public static Facade Facade {"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Facade</span> <span class="token class-name">Facade</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        get {"><span class="lineCounter-0-0-15">16</span>        get <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            if(Facade == null) {"><span class="lineCounter-0-0-15">17</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Facade</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                Facade = new Facade();"><span class="lineCounter-0-0-15">18</span>                <span class="token class-name">Facade</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Facade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            }"><span class="lineCounter-0-0-15">19</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="            return Facade;"><span class="lineCounter-0-0-15 prim">20</span>            <span class="token keyword">return</span> <span class="token class-name">Facade</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">21</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="        private set;"><span class="lineCounter-0-0-15">22</span>        <span class="token keyword">private</span> set<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">23</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">24</span></div><br><div class="line-0-0-16 " data-content="    public class Facade {"><span class="lineCounter-0-0-15 prim">25</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Facade</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        private Facade() { }"><span class="lineCounter-0-0-15">26</span>        <span class="token keyword">private</span> <span class="token class-name">Facade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">27</span></div><br><div class="line-0-0-16 " data-content="        public Response doDelete(ApiRequestResolver resolver) {"><span class="lineCounter-0-0-15">28</span>        <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">doDelete</span><span class="token punctuation">(</span><span class="token class-name">ApiRequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return this.getHandler(resolver).doDelete(resolver);"><span class="lineCounter-0-0-15">29</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doDelete</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15 prim">30</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">31</span></div><br><div class="line-0-0-16 " data-content="        public Response doGet(ApiRequestResolver resolver) {"><span class="lineCounter-0-0-15">32</span>        <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">ApiRequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return this.getHandler(resolver).doGet(resolver);"><span class="lineCounter-0-0-15">33</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">34</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">35</span></div><br><div class="line-0-0-16 " data-content="        public Response doPatch(ApiRequestResolver resolver) {"><span class="lineCounter-0-0-15">36</span>        <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">doPatch</span><span class="token punctuation">(</span><span class="token class-name">ApiRequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return this.getHandler(resolver).doPatch(resolver);"><span class="lineCounter-0-0-15">37</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doPatch</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">38</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">39</span></div><br><div class="line-0-0-16 " data-content="        public Response doPost(ApiRequestResolver resolver) {"><span class="lineCounter-0-0-15 prim">40</span>        <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">ApiRequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return this.getHandler(resolver).doPost(resolver);"><span class="lineCounter-0-0-15">41</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">42</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">43</span></div><br><div class="line-0-0-16 " data-content="        public Response doPut(ApiRequestResolver resolver) {"><span class="lineCounter-0-0-15">44</span>        <span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">doPut</span><span class="token punctuation">(</span><span class="token class-name">ApiRequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return this.getHandler(resolver).doPut(resolver);"><span class="lineCounter-0-0-15 prim">45</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doPut</span><span class="token punctuation">(</span>resolver<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">46</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">47</span></div><br><div class="line-0-0-16 " data-content="        public Handler getHandler(ApiRequestResolver resolver) {"><span class="lineCounter-0-0-15">48</span>        <span class="token keyword">public</span> <span class="token class-name">Handler</span> <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token class-name">ApiRequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            Type handlerType = Type.forName(Api.HANDLER_NAME + resolver.ApiName);"><span class="lineCounter-0-0-15">49</span>            <span class="token class-name">Type</span> handlerType <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token class-name">Api</span><span class="token punctuation">.</span>HANDLER_NAME <span class="token operator">+</span> resolver<span class="token punctuation">.</span><span class="token class-name">ApiName</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            return handlerType != null ? (Api.Handler)handlerType.newInstance() : new Api.Handler();"><span class="lineCounter-0-0-15 prim">50</span>            <span class="token keyword">return</span> handlerType <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Handler</span><span class="token punctuation">)</span>handlerType<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">51</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">52</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">53</span></div><br><div class="line-0-0-16 " data-content="    public virtual class Handler {"><span class="lineCounter-0-0-15">54</span>    <span class="token keyword">public</span> virtual <span class="token keyword">class</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        //enforce zero argument constructor"><span class="lineCounter-0-0-15 prim">55</span>        <span class="token comment">//enforce zero argument constructor</span></div><br><div class="line-0-0-16 " data-content="        public Handler() { }"><span class="lineCounter-0-0-15">56</span>        <span class="token keyword">public</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">57</span></div><br><div class="line-0-0-16 " data-content="        public virtual Response doDelete(RequestResolver resolver) {"><span class="lineCounter-0-0-15">58</span>        <span class="token keyword">public</span> virtual <span class="token class-name">Response</span> <span class="token function">doDelete</span><span class="token punctuation">(</span><span class="token class-name">RequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return getResponse(BASIC_RESPONSE);"><span class="lineCounter-0-0-15">59</span>            <span class="token keyword">return</span> <span class="token function">getResponse</span><span class="token punctuation">(</span>BASIC_RESPONSE<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15 prim">60</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="        public virtual Response doGet(RequestResolver resolver) {"><span class="lineCounter-0-0-15">61</span>        <span class="token keyword">public</span> virtual <span class="token class-name">Response</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">RequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return getResponse(BASIC_RESPONSE);"><span class="lineCounter-0-0-15">62</span>            <span class="token keyword">return</span> <span class="token function">getResponse</span><span class="token punctuation">(</span>BASIC_RESPONSE<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">63</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="        public virtual Response doPatch(RequestResolver resolver) {"><span class="lineCounter-0-0-15">64</span>        <span class="token keyword">public</span> virtual <span class="token class-name">Response</span> <span class="token function">doPatch</span><span class="token punctuation">(</span><span class="token class-name">RequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return getResponse(BASIC_RESPONSE);"><span class="lineCounter-0-0-15 prim">65</span>            <span class="token keyword">return</span> <span class="token function">getResponse</span><span class="token punctuation">(</span>BASIC_RESPONSE<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">66</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="        public virtual Response doPost(RequestResolver resolver) {"><span class="lineCounter-0-0-15">67</span>        <span class="token keyword">public</span> virtual <span class="token class-name">Response</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">RequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return getResponse(BASIC_RESPONSE);"><span class="lineCounter-0-0-15">68</span>            <span class="token keyword">return</span> <span class="token function">getResponse</span><span class="token punctuation">(</span>BASIC_RESPONSE<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">69</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="        public virtual Response doPut(RequestResolver resolver) {"><span class="lineCounter-0-0-15 prim">70</span>        <span class="token keyword">public</span> virtual <span class="token class-name">Response</span> <span class="token function">doPut</span><span class="token punctuation">(</span><span class="token class-name">RequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return getResponse(BASIC_RESPONSE);"><span class="lineCounter-0-0-15">71</span>            <span class="token keyword">return</span> <span class="token function">getResponse</span><span class="token punctuation">(</span>BASIC_RESPONSE<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">72</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">73</span></div><br><div class="line-0-0-16 " data-content="        protected Response getResponse(String responseBody) {"><span class="lineCounter-0-0-15">74</span>        <span class="token keyword">protected</span> <span class="token class-name">Response</span> <span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> responseBody<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return new Response(responseBody);"><span class="lineCounter-0-0-15 prim">75</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span>responseBody<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">76</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">77</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">78</span><span class="token punctuation">}</span></div><br></code></pre><div class="tabs-0-0-18"><script id="VcscmqoHGE">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("VcscmqoHGE", "T764P9zpaV5eSCd1H0okyw==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div class="tab first selected" data-tab-title="Delegating to Type.forName"><p>So, in the end, our conductor has been delegated to <code>Type.forName(String yourTypeName)</code> -- a coupling that I ordinarily tend to &gt; &gt; shy away from; within the system, it's easy to pass around Type references (for those following along, you may recall that that &gt; &gt; is precisely how the <a href="/joys-of-apex/future-method-callout-callback/">Callback</a> interface works), but it's not as though we &gt; &gt; have that luxury when interacting with cross-system consumers. Furthermore, it <em>makes sense</em> that if a tight coupling should &gt; &gt; &gt; &gt; exist, that it be between the name of the API and the underlying objects.</p></div><div class="tab" data-tab-title="Notes"><p>Now, I'm not saying that I know the underlying specifics of how "Type.forName" is implemented ... but if I had to guess Salesforce just does a lookup to the ApexClass table based on the name you provide (and the namespace, if you're in the business of creating managed packages). Not <em>quite</em> an if/else or switch statement, but since we're delegating ... who knows!</p></div></div><p>I'll end this section by saying that I think there's plenty of room for improvement in what I'm showing off. In an actual implementation of this, for example, I would likely:</p><ul><li>have a method for returning successful responses in addition to a method for returning failed responses</li><li>alternatively, have different response classes for success/fail instead of defaulting the existing class to failure</li></ul><p>One thing I considered, but wouldn't actually do? Wrapping the virtual methods within the <code>Handler</code> in try/catch. If your operation has some chance of failing, it should be within the override that you try/catch.</p><h2 id="implementing-new-routes" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Implementing New Routes</h2><p>Implementing new APIs off of the base <code>/api/</code> route is now as simple as adding classes that extend <code>Api.Handler</code> with names that start with "ApiHandler" (of course you could tweak "ApiHandler" if that naming convention doesn't appeal to you) -- I'll show an example API designed to fetch accounts. It should be noted that this GET request can be formulated either with:</p><ul><li><code>https://instance.salesforce.com/services/apexrest/api/account/ACCOUNT_ID_HERE</code></li><li>or <code>https://instance.salesforce.com/services/apexrest/api/account/</code> with the Id in the request body (though I haven't shown this approach)</li></ul><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="public class ApiHandlerAccount extends Api.Handler {"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiHandlerAccount</span> <span class="token keyword">extends</span> <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Handler</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    public final static String NOT_FOUND = 'Account Not Found';"><span class="lineCounter-0-0-15">2</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> NOT_FOUND <span class="token operator">=</span> <span class="token string">'Account Not Found'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">3</span></div><br><div class="line-0-0-16 " data-content="    private final IRepository accountRepo;"><span class="lineCounter-0-0-15">4</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">IRepository</span> accountRepo<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">5</span></div><br><div class="line-0-0-16 " data-content="    public ApiHandlerAccount() {"><span class="lineCounter-0-0-15">6</span>    <span class="token keyword">public</span> <span class="token class-name">ApiHandlerAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        super();"><span class="lineCounter-0-0-15">7</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        //install your dependencies via the Factory"><span class="lineCounter-0-0-15">8</span>        <span class="token comment">//install your dependencies via the Factory</span></div><br><div class="line-0-0-16 " data-content="        this.accountRepo = Factory.getFactory().RepoFactory.getAccountRepo();"><span class="lineCounter-0-0-15">9</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>accountRepo <span class="token operator">=</span> <span class="token class-name">Factory</span><span class="token punctuation">.</span><span class="token function">getFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token class-name">RepoFactory</span><span class="token punctuation">.</span><span class="token function">getAccountRepo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">10</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">11</span></div><br><div class="line-0-0-16 " data-content="    public override Api.Response doGet(ApiRequestResolver resolver) {"><span class="lineCounter-0-0-15">12</span>    <span class="token keyword">public</span> override <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">ApiRequestResolver</span> resolver<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        Id accountId = Id.valueOf(resolver.RequestUrlBody);"><span class="lineCounter-0-0-15">13</span>        <span class="token class-name">Id</span> accountId <span class="token operator">=</span> <span class="token class-name">Id</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>resolver<span class="token punctuation">.</span><span class="token class-name">RequestUrlBody</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        List<Account> accounts = this.accountRepo.get("><span class="lineCounter-0-0-15">14</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> accounts <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>accountRepo<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="            new Query("><span class="lineCounter-0-0-15 prim">15</span>            <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="                Account.Id,"><span class="lineCounter-0-0-15">16</span>                <span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token class-name">Id</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="                Query.Operator.EQUALS,"><span class="lineCounter-0-0-15">17</span>                <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token class-name">Operator</span><span class="token punctuation">.</span>EQUALS<span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="                accountId"><span class="lineCounter-0-0-15">18</span>                accountId</div><br><div class="line-0-0-16 " data-content="            )"><span class="lineCounter-0-0-15">19</span>            <span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="        );"><span class="lineCounter-0-0-15 prim">20</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        Account acc = accounts.size() > 0 ?"><span class="lineCounter-0-0-15">21</span>        <span class="token class-name">Account</span> acc <span class="token operator">=</span> accounts<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span></div><br><div class="line-0-0-16 " data-content="            accounts[0] :"><span class="lineCounter-0-0-15">22</span>            accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span></div><br><div class="line-0-0-16 " data-content="            new Account(Name = NOT_FOUND);"><span class="lineCounter-0-0-15">23</span>            <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token class-name">Name</span> <span class="token operator">=</span> NOT_FOUND<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">24</span></div><br><div class="line-0-0-16 " data-content="        Api.Response res = this.getResponse(Json.serialize(acc));"><span class="lineCounter-0-0-15 prim">25</span>        <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token class-name">Json</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        res.Success = accounts.size() > 0;"><span class="lineCounter-0-0-15">26</span>        res<span class="token punctuation">.</span><span class="token class-name">Success</span> <span class="token operator">=</span> accounts<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        return res;"><span class="lineCounter-0-0-15">27</span>        <span class="token keyword">return</span> res<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">28</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">29</span><span class="token punctuation">}</span></div><br></code></pre><p>You probably <em>wouldn't</em> be serializing the whole Account to return to your calling service -- this is just an example!</p><p>If looking at that Factory statement has you going <em>huh!?!</em> then I'll kindly refer you to the <a href="/joys-of-apex/dependency-injection-factory-pattern">Factory &amp; Dependency Injection post</a>. The whole downside of <code>Type.forName</code> -- that your object is required to have a zero-argument constructor -- can be recovered from if you have the ability to quickly swap out the objects of your choice when testing, <strong>plus</strong> you can actually assert that you're querying for the correct things, as I'll show with the test:</p><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="@isTest"><span class="lineCounter-0-0-15 prim">1</span><span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="private class ApiHandlerAccountTests {"><span class="lineCounter-0-0-15">2</span><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">ApiHandlerAccountTests</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    @isTest"><span class="lineCounter-0-0-15">3</span>    <span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="    static void it_should_return_stringified_account_to_api() {"><span class="lineCounter-0-0-15">4</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_return_stringified_account_to_api</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        /*most of my objects have a one-argument"><span class="lineCounter-0-0-15 prim">5</span>        <span class="token comment">/*most of my objects have a one-argument</span></div><br><div class="line-0-0-16 " data-content="        constructor that takes in the factory"><span class="lineCounter-0-0-15">6</span>        constructor that takes in the factory</div><br><div class="line-0-0-16 " data-content="        and they use the following syntax:"><span class="lineCounter-0-0-15">7</span>        and they use the following syntax:</div><br><div class="line-0-0-16 " data-content="        Factory.withMocks.getClassHere.methodUnderTest"><span class="lineCounter-0-0-15">8</span>        Factory.withMocks.getClassHere.methodUnderTest</div><br><div class="line-0-0-16 " data-content="        for zero-argument constructors, we have to explicitly call"><span class="lineCounter-0-0-15">9</span>        for zero-argument constructors, we have to explicitly call</div><br><div class="line-0-0-16 " data-content="        useMocks prior to testing */"><span class="lineCounter-0-0-15 prim">10</span>        useMocks prior to testing */</div><br><div class="line-0-0-16 " data-content="        Factory.useMocks();"><span class="lineCounter-0-0-15">11</span>        <span class="token class-name">Factory</span><span class="token punctuation">.</span><span class="token function">useMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        //arrange"><span class="lineCounter-0-0-15">12</span>        <span class="token comment">//arrange</span></div><br><div class="line-0-0-16 " data-content="        Id accountId = TestingUtils.generateId(Account.SObjectType);"><span class="lineCounter-0-0-15">13</span>        <span class="token class-name">Id</span> accountId <span class="token operator">=</span> <span class="token class-name">TestingUtils</span><span class="token punctuation">.</span><span class="token function">generateId</span><span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token class-name">SObjectType</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        Account fakeAccount = new Account(Id = accountId, Name = 'ApiHandlerTest');"><span class="lineCounter-0-0-15">14</span>        <span class="token class-name">Account</span> fakeAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token class-name">Id</span> <span class="token operator">=</span> accountId<span class="token punctuation">,</span> <span class="token class-name">Name</span> <span class="token operator">=</span> <span class="token string">'ApiHandlerTest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        RepoFactoryMock.QueryResults.add(fakeAccount);"><span class="lineCounter-0-0-15 prim">15</span>        <span class="token class-name">RepoFactoryMock</span><span class="token punctuation">.</span><span class="token class-name">QueryResults</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fakeAccount<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        RestContext.request = getAccountRequest(accountId);"><span class="lineCounter-0-0-15">16</span>        <span class="token class-name">RestContext</span><span class="token punctuation">.</span>request <span class="token operator">=</span> <span class="token function">getAccountRequest</span><span class="token punctuation">(</span>accountId<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">17</span></div><br><div class="line-0-0-16 " data-content="        //act"><span class="lineCounter-0-0-15">18</span>        <span class="token comment">//act</span></div><br><div class="line-0-0-16 " data-content="        Api.Response res = ApiService.doGet();"><span class="lineCounter-0-0-15">19</span>        <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> res <span class="token operator">=</span> <span class="token class-name">ApiService</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        Account deserializedAccount = (Account)Json.deserialize("><span class="lineCounter-0-0-15 prim">20</span>        <span class="token class-name">Account</span> deserializedAccount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">)</span><span class="token class-name">Json</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="            res.ResponseBody,"><span class="lineCounter-0-0-15">21</span>            res<span class="token punctuation">.</span><span class="token class-name">ResponseBody</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="            Schema.Account.class"><span class="lineCounter-0-0-15">22</span>            <span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token keyword">class</span></div><br><div class="line-0-0-16 " data-content="        );"><span class="lineCounter-0-0-15">23</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">24</span></div><br><div class="line-0-0-16 " data-content="        //assert"><span class="lineCounter-0-0-15 prim">25</span>        <span class="token comment">//assert</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(true, res.Success);"><span class="lineCounter-0-0-15">26</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token class-name">Success</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(accountId, deserializedAccount.Id);"><span class="lineCounter-0-0-15">27</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>accountId<span class="token punctuation">,</span> deserializedAccount<span class="token punctuation">.</span><span class="token class-name">Id</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(fakeAccount.Name, deserializedAccount.Name);"><span class="lineCounter-0-0-15">28</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>fakeAccount<span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token punctuation">,</span> deserializedAccount<span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">29</span></div><br><div class="line-0-0-16 " data-content="        Query performedQuery = RepoFactoryMock.QueriesMade[0];"><span class="lineCounter-0-0-15 prim">30</span>        <span class="token class-name">Query</span> performedQuery <span class="token operator">=</span> <span class="token class-name">RepoFactoryMock</span><span class="token punctuation">.</span><span class="token class-name">QueriesMade</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(Account.Id, performedQuery.field);"><span class="lineCounter-0-0-15">31</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token class-name">Id</span><span class="token punctuation">,</span> performedQuery<span class="token punctuation">.</span>field<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(Query.Operator.EQUALS, performedQuery.operator);"><span class="lineCounter-0-0-15">32</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token class-name">Operator</span><span class="token punctuation">.</span>EQUALS<span class="token punctuation">,</span> performedQuery<span class="token punctuation">.</span>operator<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(accountId, performedQuery.predicates[0]);"><span class="lineCounter-0-0-15">33</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>accountId<span class="token punctuation">,</span> performedQuery<span class="token punctuation">.</span>predicates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">34</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">35</span></div><br><div class="line-0-0-16 " data-content="    @isTest"><span class="lineCounter-0-0-15">36</span>    <span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="    static void it_should_return_account_not_found_for_no_results() {"><span class="lineCounter-0-0-15">37</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_return_account_not_found_for_no_results</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        //no need to mock the result"><span class="lineCounter-0-0-15">38</span>        <span class="token comment">//no need to mock the result</span></div><br><div class="line-0-0-16 " data-content="        //we can go straight to the db here"><span class="lineCounter-0-0-15">39</span>        <span class="token comment">//we can go straight to the db here</span></div><br><div class="line-0-0-16 " data-content="        //even though there's no result"><span class="lineCounter-0-0-15 prim">40</span>        <span class="token comment">//even though there's no result</span></div><br><div class="line-0-0-16 " data-content="        // it's still 8x slower than mocking!!"><span class="lineCounter-0-0-15">41</span>        <span class="token comment">// it's still 8x slower than mocking!!</span></div><br><div class="line-0-0-16 " data-content="        RestContext.request = getAccountRequest("><span class="lineCounter-0-0-15">42</span>        <span class="token class-name">RestContext</span><span class="token punctuation">.</span>request <span class="token operator">=</span> <span class="token function">getAccountRequest</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="            TestingUtils.generateId(Account.SObjectType)"><span class="lineCounter-0-0-15">43</span>            <span class="token class-name">TestingUtils</span><span class="token punctuation">.</span><span class="token function">generateId</span><span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token class-name">SObjectType</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="        );"><span class="lineCounter-0-0-15">44</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">45</span></div><br><div class="line-0-0-16 " data-content="        Api.Response res = ApiService.doGet();"><span class="lineCounter-0-0-15">46</span>        <span class="token class-name">Api</span><span class="token punctuation">.</span><span class="token class-name">Response</span> res <span class="token operator">=</span> <span class="token class-name">ApiService</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        Account deserializedAccount = (Account)Json.deserialize("><span class="lineCounter-0-0-15">47</span>        <span class="token class-name">Account</span> deserializedAccount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">)</span><span class="token class-name">Json</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="            res.ResponseBody,"><span class="lineCounter-0-0-15">48</span>            res<span class="token punctuation">.</span><span class="token class-name">ResponseBody</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="            Schema.Account.class"><span class="lineCounter-0-0-15">49</span>            <span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token keyword">class</span></div><br><div class="line-0-0-16 " data-content="        );"><span class="lineCounter-0-0-15 prim">50</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">51</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(false, res.Success);"><span class="lineCounter-0-0-15">52</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token class-name">Success</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        System.assertEquals(ApiHandlerAccount.NOT_FOUND, deserializedAccount.Name);"><span class="lineCounter-0-0-15">53</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token class-name">ApiHandlerAccount</span><span class="token punctuation">.</span>NOT_FOUND<span class="token punctuation">,</span> deserializedAccount<span class="token punctuation">.</span><span class="token class-name">Name</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">54</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">55</span></div><br><div class="line-0-0-16 " data-content="    static RestRequest getAccountRequest(Id accountId) {"><span class="lineCounter-0-0-15">56</span>    <span class="token keyword">static</span> <span class="token class-name">RestRequest</span> <span class="token function">getAccountRequest</span><span class="token punctuation">(</span><span class="token class-name">Id</span> accountId<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        RestRequest req = new RestRequest();"><span class="lineCounter-0-0-15">57</span>        <span class="token class-name">RestRequest</span> req <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        req.requestURI = '/api/account/' + accountId;"><span class="lineCounter-0-0-15">58</span>        req<span class="token punctuation">.</span>requestURI <span class="token operator">=</span> <span class="token string">'/api/account/'</span> <span class="token operator">+</span> accountId<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        return req;"><span class="lineCounter-0-0-15">59</span>        <span class="token keyword">return</span> req<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">60</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">61</span><span class="token punctuation">}</span></div><br></code></pre><p>And there you have it. Our first test runs in two-hundredths of a second on average, making the one-tenth of a second for the second test (the one that actually performs a SOQL query) seem positively pokey by comparison. Our first test is capable of verifying not only that the expected Account is returned to us, but also that the query that returns the Account is in fact exactly what we expect. That's huge.</p><h2 id="wrapping-up" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Wrapping Up</h2><p>Thanks for reading this Joys Of Apex post! I sincerely hope you learned something and enjoyed the process. The full code from this example is available on <a href="https://github.com/jamessimone/apex-mocks-stress-test/tree/dynamic-apis">my Github</a> if you'd like to browse through the classes in a bit more detail. It's my hope that the code will prove thought-provoking when you consider your existing APIs, and that you would consider using it on a greenfield project; for the truly brave, there's little downside to gradually migrating your existing APIs to be housed under a single route.</p><p>Of course, as with any concept, what I've talked about here doesn't cover the full breadth of what you'll need to consider when using this pattern with SFDC. Just off the top of my head:</p><ul><li>you'll still need to provision Remote Site Settings for users of your API</li><li>API use validation is another concern: I would cover that from within my individual API handlers. Of course, checking for the existence of an API key or some other magic string in your headers is not fool-proof, but I would expect that the information available within the <code>RestContext.request</code> to be sufficient for most people's needs. The <code>ApiRequestResolver</code> could also be souped-up to hold these values if you, like me, dislike people accessing static globals all over the place.</li></ul><div class="contentnav-0-0-7" data-no-search=""><a href="#what-a-typical-apex-api-looks-like" class="h2" data-content-highlight="what-a-typical-apex-api-looks-like">What A Typical Apex API Looks Like</a><a href="#creating-dynamic-extendable-apis" class="h2" data-content-highlight="creating-dynamic-extendable-apis">Creating Dynamic Extendable APIs</a><a href="#implementing-new-routes" class="h2" data-content-highlight="implementing-new-routes">Implementing New Routes</a><a href="#wrapping-up" class="h2" data-content-highlight="wrapping-up">Wrapping Up</a></div></div><div id="-codedoc-toc" class="toc-0-0-4"><div class="content-0-0-5"><p><a href="/joys-of-apex/">Home</a>
<a href="/joys-of-apex/apex-logging-service">Apex Logging Service</a>
<a href="/joys-of-apex/apex-object-oriented-basics">Apex Object-Oriented Basics</a>
<a href="/joys-of-apex/batchable-and-queueable-apex">Batchable And Queueable Apex</a>
<a href="/joys-of-apex/building-a-better-singleton">Building A Better Singleton</a>
<a href="/joys-of-apex/continuous-integration-with-sfdx">Continuous Integration With SFDX</a>
<a href="/joys-of-apex/dependency-injection-factory-pattern">Dependency Injection &amp; Factory Pattern</a>
<a href="/joys-of-apex/enum-apex-class-gotchas">Enum Apex Class Gotchas</a>
<a href="/joys-of-apex/extendable-apis">Extendable Apis</a>
<a href="/joys-of-apex/future-method-callout-callback">Future Methods, Callouts &amp; Callbacks</a>
<a href="/joys-of-apex/idiomatic-salesforce-apex">Idiomatic Salesforce Apex</a>
<a href="/joys-of-apex/intro">Introduction &amp; Testing Philosophy</a>
<a href="/joys-of-apex/lazy-iterators">Lazy Iterators</a>
<a href="/joys-of-apex/lightweight-trigger-handler">Lightweight Trigger Handler</a>
<a href="/joys-of-apex/lwc-composable-pagination">LWC Composable Pagination</a>
<a href="/joys-of-apex/mocking-dml">Mocking DML</a>
<a href="/joys-of-apex/react-versus-lightning-web-components">React Versus Lightning Web Components</a>
<a href="/joys-of-apex/repository-pattern">Repository Pattern</a>
<a href="/joys-of-apex/sorting-and-performance-in-apex">Sorting And Performance In Apex</a>
<a href="/joys-of-apex/test-driven-development-example">Test Driven Development Example</a>
<a href="/joys-of-apex/writing-performance-apex-tests">Writing Performant Apex Tests</a></p><p><br><br></p><p><a href="https://www.jamessimone.net/">Read more tech articles</a></p></div></div><div class="footer-0-0-3"><div class="left"><script id="fWIqxeZshr">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("fWIqxeZshr", "BWW0vHR4333HbDOiwZ67JA==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"></div></div><div class="right"><script id="iSVVurfAQD">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("iSVVurfAQD", "6yEdMfRRlNsUBKSBOTazFg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="rZvkyiSWex">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("rZvkyiSWex", "wh9V9isakhdwzlz9ZUjvyw==", {"namespace":"/joys-of-apex"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>