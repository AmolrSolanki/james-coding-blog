<!DOCTYPE html><html><head><title>Joys Of Apex | Mocking DML</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="/joys-of-apex/favicon.ico"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/joys-of-apex/styles/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/joys-of-apex/bundle/codedoc-bundle.js"></script><meta property="og:image" content="./img/joys-of-apex-thumbnail.png"><script>window.githubConfig={"repo":"james-coding-blog","user":"jamessimone"}</script><style>.container{padding-top: 0 !important}</style><style>#-codedoc-toc { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px) }</style><meta name="twitter:title" content="Joys Of Apex | Mocking DML"><meta property="og:type" content="article"><meta property="og:title" content="Joys Of Apex | Mocking DML"></head><body><header style="margin-left: 1rem">Read more at <a href="https://wwww.jamessimone.net">jamessimone.net</a>, or return to the <a href="/joys-of-apex/">homepage</a></header><div id="-codedoc-container" class="container"><script>window.source = {"base":"posts","path":"mocking-dml.md","namespace":"/joys-of-apex","title":{"base":"Joys Of Apex","connector":" | "}}</script><div class="hero-0-0-8" style="margin-bottom: -156px"><img src="/joys-of-apex/img/the-joys-of-apex.png" class="image-0-0-9" data-hero=""><span class="caption-0-0-10"></span></div><marker><br>
<br>
<br>
<br>
<br>

</marker><h1 class="h-0-0-11 "><span style="color: green; 
      text-shadow: none; 
      font-size: 48px"><p>Mocking DML</p></span></h1><script id="VjYzfaGmwd">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("VjYzfaGmwd", "kRzsgnV+B7EQTskbovy+YA==", {"src":"github","date":"2019-12-28T15:00:00.000Z"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div hidden="" data-ignore-text="" data-meta-override-property="og:image"><p>./img/joys-of-apex-thumbnail.png</p></div><blockquote><p>I never met a unit test I didn't like. - Me, probably.</p></blockquote><p>Hi everyone and welcome back to the <a href="/joys-of-apex/">Joys of Apex</a>. This time around, we'll be covering the all-important subject of unit testing. In the <a href="/joys-of-apex/intro">Introduction</a> we covered TDD as it relates to Salesforce, and some early on project experience I had as a Salesforce developer that impressed upon me the need to have a snappy test suite:</p><ul><li>it encouraged quick iteration</li><li>fast tests meant as feature requests rolled in and existing code was refactored, the team remained confident that regressions were being avoided</li><li>fast deploys meant shipping features faster</li></ul><p>I think we'd all like to ship features quickly and safely at the end of the day.</p><h3 id="mocking-dml-through-crud-wrappers" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Mocking DML through CRUD wrappers</h3><p>To improve on the abysmal testing time of my first project, I began writing some failing tests:</p><pre class="with-bar"><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span>classes/Crud_Tests.cls</span></span><div class="line-0-0-16 " data-content="@isTest"><span class="lineCounter-0-0-15 prim">1</span><span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="private class Crud_Tests {"><span class="lineCounter-0-0-15">2</span><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">Crud_Tests</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    @isTest"><span class="lineCounter-0-0-15">3</span>    <span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="    static void it_should_insert() {"><span class="lineCounter-0-0-15">4</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        Contact con = new Contact("><span class="lineCounter-0-0-15 prim">5</span>        <span class="token class-name">Contact</span> con <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="            LastName = 'Washington',"><span class="lineCounter-0-0-15">6</span>            <span class="token class-name">LastName</span> <span class="token operator">=</span> <span class="token string">'Washington'</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="            LeadSource = 'test'"><span class="lineCounter-0-0-15">7</span>            <span class="token class-name">LeadSource</span> <span class="token operator">=</span> <span class="token string">'test'</span></div><br><div class="line-0-0-16 " data-content="            //other fields you require"><span class="lineCounter-0-0-15">8</span>            <span class="token comment">//other fields you require</span></div><br><div class="line-0-0-16 " data-content="        );"><span class="lineCounter-0-0-15">9</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        new Crud().doInsert(con);"><span class="lineCounter-0-0-15 prim">10</span>        <span class="token keyword">new</span> <span class="token class-name">Crud</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doInsert</span><span class="token punctuation">(</span>con<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        System.assertNotEquals(null, con.Id);"><span class="lineCounter-0-0-15">11</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertNotEquals</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> con<span class="token punctuation">.</span><span class="token class-name">Id</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">12</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">13</span><span class="token punctuation">}</span></div><br></code></pre><p>That leads to this familiar assertion failure:</p><pre class=""><code class="bash code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="System.AssertException:"><span class="lineCounter-0-0-15 prim">1</span>System.AssertException:</div><br><div class="line-0-0-16 " data-content="Assertion Failed:"><span class="lineCounter-0-0-15">2</span>Assertion Failed:</div><br><div class="line-0-0-16 " data-content="Same value: null"><span class="lineCounter-0-0-15 prim">3</span>Same value: null</div><br></code></pre><p>Ouch. OK! Let's implement the method in our Crud class to fix this issue.</p><pre class="with-bar"><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span>classes/Crud.cls</span></span><div class="line-0-0-16 " data-content="public class Crud {"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Crud</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    public SObject doInsert(SObject record) {"><span class="lineCounter-0-0-15">2</span>    <span class="token keyword">public</span> <span class="token class-name">SObject</span> <span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        Database.insert(record);"><span class="lineCounter-0-0-15">3</span>        <span class="token class-name">Database</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        return record;"><span class="lineCounter-0-0-15">4</span>        <span class="token keyword">return</span> <span class="token keyword">record</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">5</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">6</span><span class="token punctuation">}</span></div><br></code></pre><p>Easy peasy. In fact, let's update the code so that we get both record and records-based ability to insert:</p><pre class="with-bar"><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span>classes/Crud.cls</span></span><div class="line-0-0-16 " data-content="    public SObject doInsert(SObject record) {"><span class="lineCounter-0-0-15 prim">1</span>    <span class="token keyword">public</span> <span class="token class-name">SObject</span> <span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        return this.doInsert(new List<SObject>{ record })[0];"><span class="lineCounter-0-0-15">2</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> <span class="token keyword">record</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">3</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">4</span></div><br><div class="line-0-0-16 " data-content="    public List<SObject> doInsert(List<SObject> records) {"><span class="lineCounter-0-0-15 prim">5</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> records<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        Database.insert(records);"><span class="lineCounter-0-0-15">6</span>        <span class="token class-name">Database</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        return records;"><span class="lineCounter-0-0-15">7</span>        <span class="token keyword">return</span> records<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">8</span>    <span class="token punctuation">}</span></div><br></code></pre><p>You can imagine the implementation for the update, upsert, and delete methods ... but there's one gotcha!</p><pre class="with-bar"><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span>classes/Crud_Tests.cls</span></span><div class="line-0-0-16 " data-content="//in Crud_Tests.cls"><span class="lineCounter-0-0-15 prim">1</span><span class="token comment">//in Crud_Tests.cls</span></div><br><div class="line-0-0-16 " data-content="@isTest"><span class="lineCounter-0-0-15">2</span><span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="static void it_should_not_fail_on_update_due_to_chunking_errors() {"><span class="lineCounter-0-0-15">3</span><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_not_fail_on_update_due_to_chunking_errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    /*this constant is normally kept in a class I call SalesforceLimits"><span class="lineCounter-0-0-15">4</span>    <span class="token comment">/*this constant is normally kept in a class I call SalesforceLimits</span></div><br><div class="line-0-0-16 " data-content="    thanks to Xi Xiao for pointing out that though the salesforce"><span class="lineCounter-0-0-15 prim">5</span>    thanks to Xi Xiao for pointing out that though the salesforce</div><br><div class="line-0-0-16 " data-content="    error message returns &quot;Cannot have more than 10 chunks in a single operation&quot;"><span class="lineCounter-0-0-15">6</span>    error message returns "Cannot have more than 10 chunks in a single operation"</div><br><div class="line-0-0-16 " data-content="    if the objects are always alternating,"><span class="lineCounter-0-0-15">7</span>    if the objects are always alternating,</div><br><div class="line-0-0-16 " data-content="    the chunk size increases with each alternation, thus the error will occur"><span class="lineCounter-0-0-15">8</span>    the chunk size increases with each alternation, thus the error will occur</div><br><div class="line-0-0-16 " data-content="    in as little as 6 iterations */"><span class="lineCounter-0-0-15">9</span>    in as little as 6 iterations */</div><br><div class="line-0-0-16 " data-content="    Integer MAX_DML_CHUNKS = 6;"><span class="lineCounter-0-0-15 prim">10</span>    <span class="token class-name">Integer</span> MAX_DML_CHUNKS <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    List<SObject> records = new List<SObject>();"><span class="lineCounter-0-0-15">11</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    List<Account> accounts = new List<Account>();"><span class="lineCounter-0-0-15">12</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> accounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    List<Contact> contacts = new List<Contact>();"><span class="lineCounter-0-0-15">13</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Contact</span><span class="token punctuation">&gt;</span></span> contacts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Contact</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">14</span></div><br><div class="line-0-0-16 " data-content="    for(Integer i = 0; i < MAX_DML_CHUNKS; i ++) {"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX_DML_CHUNKS<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        Account a = new Account(Name = 'test' + i);"><span class="lineCounter-0-0-15">16</span>        <span class="token class-name">Account</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token class-name">Name</span> <span class="token operator">=</span> <span class="token string">'test'</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        accounts.add(a);"><span class="lineCounter-0-0-15">17</span>        accounts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        records.add(a);"><span class="lineCounter-0-0-15">18</span>        records<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">19</span></div><br><div class="line-0-0-16 " data-content="        Contact c = new Contact(LastName = test + i);"><span class="lineCounter-0-0-15 prim">20</span>        <span class="token class-name">Contact</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token class-name">LastName</span> <span class="token operator">=</span> test <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        contacts.add(c);"><span class="lineCounter-0-0-15">21</span>        contacts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        records.add(c);"><span class="lineCounter-0-0-15">22</span>        records<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">23</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">24</span></div><br><div class="line-0-0-16 " data-content="    insert accounts;"><span class="lineCounter-0-0-15 prim">25</span>    insert accounts<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    insert contacts;"><span class="lineCounter-0-0-15">26</span>    insert contacts<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">27</span></div><br><div class="line-0-0-16 " data-content="    try {"><span class="lineCounter-0-0-15">28</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        new Crud().doUpdate(records);"><span class="lineCounter-0-0-15">29</span>        <span class="token keyword">new</span> <span class="token class-name">Crud</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doUpdate</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    } catch(Exception ex) {"><span class="lineCounter-0-0-15 prim">30</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        System.assert(false, ex);"><span class="lineCounter-0-0-15">31</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        //should not make it here ..."><span class="lineCounter-0-0-15">32</span>        <span class="token comment">//should not make it here ...</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">33</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">34</span><span class="token punctuation">}</span></div><br></code></pre><p>That brings about this lovely exception:</p><pre class=""><code class="bash code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="System.AssertException:"><span class="lineCounter-0-0-15 prim">1</span>System.AssertException:</div><br><div class="line-0-0-16 " data-content="Assertion Failed: System.TypeException:"><span class="lineCounter-0-0-15">2</span>Assertion Failed: System.TypeException:</div><br><div class="line-0-0-16 " data-content="Cannot have more than 10 chunks in a single operation."><span class="lineCounter-0-0-15">3</span>Cannot have <span class="token function">more</span> than <span class="token number">10</span> chunks <span class="token keyword">in</span> a single operation.</div><br><div class="line-0-0-16 " data-content="Please rearrange the data to reduce chunking."><span class="lineCounter-0-0-15 prim">4</span>Please rearrange the data to reduce chunking.</div><br></code></pre><p>When developing in Apex, I think people quickly come to learn that no matter how much you know about the SFDC ecosystem, there are <em>always</em> going to be new things to learn. Getting burned is also sometimes the fastest way to learn. I'm not an oracle -- this test is really a regression test, which only came up during active development on my second Salesforce org when our error logs started occasionally recording this error.</p><p>Let's fix the chunking issue:</p><pre class="with-bar"><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span>classes/Crud.cls</span></span><div class="line-0-0-16 " data-content="public SObject doInsert(SObject record) {"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">public</span> <span class="token class-name">SObject</span> <span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    return this.doInsert(new List<SObject>{record})[0];"><span class="lineCounter-0-0-15">2</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">record</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">3</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="public List<SObject> doInsert(List<SObject> records) {"><span class="lineCounter-0-0-15">4</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> records<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    this.sortToPreventChunkingErrors(records);"><span class="lineCounter-0-0-15 prim">5</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sortToPreventChunkingErrors</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    Database.insert(records);"><span class="lineCounter-0-0-15">6</span>    <span class="token class-name">Database</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    return records;"><span class="lineCounter-0-0-15">7</span>    <span class="token keyword">return</span> records<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">8</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">9</span></div><br><div class="line-0-0-16 " data-content="public SObject doUpdate(SObject record) {"><span class="lineCounter-0-0-15 prim">10</span><span class="token keyword">public</span> <span class="token class-name">SObject</span> <span class="token function">doUpdate</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    return this.doUpdate(new List<SObject>{record})[0];"><span class="lineCounter-0-0-15">11</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doUpdate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">record</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">12</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="public List<SObject> doUpdate(List<SObject> records) {"><span class="lineCounter-0-0-15">13</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doUpdate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> records<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    this.sortToPreventChunkingErrors(records);"><span class="lineCounter-0-0-15">14</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sortToPreventChunkingErrors</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    Database.update(records);"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token class-name">Database</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    return records;"><span class="lineCounter-0-0-15">16</span>    <span class="token keyword">return</span> records<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">17</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">18</span></div><br><div class="line-0-0-16 " data-content="private void sortToPreventChunkingErrors(List<SObject> records) {"><span class="lineCounter-0-0-15">19</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sortToPreventChunkingErrors</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> records<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    //prevents a chunking error that can occur"><span class="lineCounter-0-0-15 prim">20</span>    <span class="token comment">//prevents a chunking error that can occur</span></div><br><div class="line-0-0-16 " data-content="    //if SObject types are in the list out of order."><span class="lineCounter-0-0-15">21</span>    <span class="token comment">//if SObject types are in the list out of order.</span></div><br><div class="line-0-0-16 " data-content="    //no need to sort if the list size is below the limit"><span class="lineCounter-0-0-15">22</span>    <span class="token comment">//no need to sort if the list size is below the limit</span></div><br><div class="line-0-0-16 " data-content="    if(records.size() >= SalesforceLimits.MAX_DML_CHUNKING) {"><span class="lineCounter-0-0-15">23</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>records<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token class-name">SalesforceLimits</span><span class="token punctuation">.</span>MAX_DML_CHUNKING<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        records.sort();"><span class="lineCounter-0-0-15">24</span>        records<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">25</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">26</span><span class="token punctuation">}</span></div><br></code></pre><p>And now the tests pass -- one gotcha down! I feel ready to take on the world!
<img src="/joys-of-apex/img/ready-to-take-on-the-world.jpg" alt="Just kidding..."></p><p>There's always one more gotcha in Apex (and <code>gotchas = n + 1</code> is only true with the <em>gotchas I know</em>). Let's cover one more ... lovely ... issue:</p><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="//in Crud_Tests.cls"><span class="lineCounter-0-0-15 prim">1</span><span class="token comment">//in Crud_Tests.cls</span></div><br><div class="line-0-0-16 " data-content="@testSetup"><span class="lineCounter-0-0-15">2</span><span class="token annotation punctuation">@testSetup</span></div><br><div class="line-0-0-16 " data-content="private static void setup() {"><span class="lineCounter-0-0-15">3</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    insert new Contact(FirstName = 'George');"><span class="lineCounter-0-0-15">4</span>    insert <span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token class-name">FirstName</span> <span class="token operator">=</span> <span class="token string">'George'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">5</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">6</span></div><br><div class="line-0-0-16 " data-content="@isTest"><span class="lineCounter-0-0-15">7</span><span class="token annotation punctuation">@isTest</span></div><br><div class="line-0-0-16 " data-content="static void it_should_do_crud_upsert() {"><span class="lineCounter-0-0-15">8</span><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">it_should_do_crud_upsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    Contact contact = [SELECT Id FROM Contact];"><span class="lineCounter-0-0-15">9</span>    <span class="token class-name">Contact</span> contact <span class="token operator">=</span> <span class="token punctuation">[</span>SELECT <span class="token class-name">Id</span> FROM <span class="token class-name">Contact</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    contact.FirstName = 'Harry';"><span class="lineCounter-0-0-15 prim">10</span>    contact<span class="token punctuation">.</span><span class="token class-name">FirstName</span> <span class="token operator">=</span> <span class="token string">'Harry'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    new Crud().doUpsert(contact);"><span class="lineCounter-0-0-15">11</span>    <span class="token keyword">new</span> <span class="token class-name">Crud</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doUpsert</span><span class="token punctuation">(</span>contact<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">12</span></div><br><div class="line-0-0-16 " data-content="    System.assertEquals('Harry', contact.FirstName);"><span class="lineCounter-0-0-15">13</span>    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">'Harry'</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span><span class="token class-name">FirstName</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">14</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">15</span></div><br><div class="line-0-0-16 " data-content="//and in Crud.cls"><span class="lineCounter-0-0-15">16</span><span class="token comment">//and in Crud.cls</span></div><br><div class="line-0-0-16 " data-content="public SObject doUpsert(SObject record) {"><span class="lineCounter-0-0-15">17</span><span class="token keyword">public</span> <span class="token class-name">SObject</span> <span class="token function">doUpsert</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    return this.doUpsert(new List<SObject>{ record })[0];"><span class="lineCounter-0-0-15">18</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doUpsert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> <span class="token keyword">record</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">19</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">20</span></div><br><div class="line-0-0-16 " data-content="public List<SObject> doUpsert(List<SObject> records) {"><span class="lineCounter-0-0-15">21</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doUpsert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> records<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    this.sortToPreventChunkingErrors(records);"><span class="lineCounter-0-0-15">22</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sortToPreventChunkingErrors</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    Database.upsert(records);"><span class="lineCounter-0-0-15">23</span>    <span class="token class-name">Database</span><span class="token punctuation">.</span><span class="token function">upsert</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    return records;"><span class="lineCounter-0-0-15">24</span>    <span class="token keyword">return</span> records<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">25</span><span class="token punctuation">}</span></div><br></code></pre><p>Which leads to:</p><pre class=""><code class="bash code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="System.TypeException:"><span class="lineCounter-0-0-15 prim">1</span>System.TypeException:</div><br><div class="line-0-0-16 " data-content="DML on generic List<SObject> only allowed for insert, update or delete."><span class="lineCounter-0-0-15 prim">2</span>DML on generic List<span class="token operator">&lt;</span>SObject<span class="token operator">&gt;</span> only allowed <span class="token keyword">for</span> insert, update or delete.</div><br></code></pre><p>OK ... didn't see that one coming. Let's fix it:</p><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="//I know. Abstract. Has everyone gone crazy??"><span class="lineCounter-0-0-15 prim">1</span><span class="token comment">//I know. Abstract. Has everyone gone crazy??</span></div><br><div class="line-0-0-16 " data-content="//Because Apex doesn't support static classes"><span class="lineCounter-0-0-15">2</span><span class="token comment">//Because Apex doesn't support static classes</span></div><br><div class="line-0-0-16 " data-content="//(which would have been the sane way to handle this)"><span class="lineCounter-0-0-15">3</span><span class="token comment">//(which would have been the sane way to handle this)</span></div><br><div class="line-0-0-16 " data-content="//I like to make my static classes Abstract to prevent"><span class="lineCounter-0-0-15">4</span><span class="token comment">//I like to make my static classes Abstract to prevent</span></div><br><div class="line-0-0-16 " data-content="//them from being improperly initialized."><span class="lineCounter-0-0-15 prim">5</span><span class="token comment">//them from being improperly initialized.</span></div><br><div class="line-0-0-16 " data-content="public abstract class TypeUtils {"><span class="lineCounter-0-0-15">6</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">TypeUtils</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    public static List<SObject> createSObjectList(SObject record) {"><span class="lineCounter-0-0-15">7</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">createSObjectList</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        String listType = 'List<' + record.getSObjectType() + '>';"><span class="lineCounter-0-0-15">8</span>        <span class="token class-name">String</span> listType <span class="token operator">=</span> <span class="token string">'List&lt;'</span> <span class="token operator">+</span> <span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">getSObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&gt;'</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        List<SObject> records = (List<SObject>) create(listType);"><span class="lineCounter-0-0-15">9</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token function">create</span><span class="token punctuation">(</span>listType<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        records.add(record);"><span class="lineCounter-0-0-15 prim">10</span>        records<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        return records;"><span class="lineCounter-0-0-15">11</span>        <span class="token keyword">return</span> records<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">12</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">13</span></div><br><div class="line-0-0-16 " data-content="    public static Object create(String objectName) {"><span class="lineCounter-0-0-15">14</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> objectName<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        return Type.forName(objectName).newInstance();"><span class="lineCounter-0-0-15 prim">15</span>        <span class="token keyword">return</span> <span class="token class-name">Type</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>objectName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">16</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">17</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">18</span></div><br><div class="line-0-0-16 " data-content="//and in Crud.cls"><span class="lineCounter-0-0-15">19</span><span class="token comment">//and in Crud.cls</span></div><br><div class="line-0-0-16 " data-content="public SObject doUpsert(SObject record) {"><span class="lineCounter-0-0-15 prim">20</span><span class="token keyword">public</span> <span class="token class-name">SObject</span> <span class="token function">doUpsert</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    List<SObject> castRecords = TypeUtils.createSObjectList(record);"><span class="lineCounter-0-0-15">21</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> castRecords <span class="token operator">=</span> <span class="token class-name">TypeUtils</span><span class="token punctuation">.</span><span class="token function">createSObjectList</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    return this.doUpsert(castRecords)[0];"><span class="lineCounter-0-0-15">22</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doUpsert</span><span class="token punctuation">(</span>castRecords<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">23</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">24</span></div><br></code></pre><p>Wow. OK. We've got our database wrapper ready to go, and all it took was a few years off my life, some gray hairs, a few shed tears, high cholesterol ... a small price to pay. Now let's get down to the actual business.</p><h3 id="implementing-the-dml-interface" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Implementing the DML interface</h3><p>In order to make use of this Crud class within our production level code while keeping our tests blazing fast, we're going to need a common interface:</p><pre class="with-bar"><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span>classes/ICrud.cls</span></span><div class="line-0-0-16 " data-content="public interface ICrud {"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICrud</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    SObject doInsert(SObject record);"><span class="lineCounter-0-0-15">2</span>    <span class="token class-name">SObject</span> <span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    List<SObject> doInsert(List<SObject> recordList);"><span class="lineCounter-0-0-15">3</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    SObject doUpdate(SObject record);"><span class="lineCounter-0-0-15">4</span>    <span class="token class-name">SObject</span> <span class="token function">doUpdate</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    List<SObject> doUpdate(List<SObject> recordList);"><span class="lineCounter-0-0-15 prim">5</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doUpdate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    SObject doUpsert(SObject record);"><span class="lineCounter-0-0-15">6</span>    <span class="token class-name">SObject</span> <span class="token function">doUpsert</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    List<SObject> doUpsert(List<SObject> recordList);"><span class="lineCounter-0-0-15">7</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doUpsert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    List<SObject> doUpsert(List<SObject> recordList, Schema.SObjectField externalIDField);"><span class="lineCounter-0-0-15">8</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doUpsert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">,</span> <span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">SObjectField</span> externalIDField<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    SObject doUndelete(SObject record);"><span class="lineCounter-0-0-15">9</span>    <span class="token class-name">SObject</span> <span class="token function">doUndelete</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    List<SObject> doUndelete(List<SObject> recordList);"><span class="lineCounter-0-0-15 prim">10</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doUndelete</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">11</span></div><br><div class="line-0-0-16 " data-content="    void doDelete(SObject record);"><span class="lineCounter-0-0-15">12</span>    <span class="token keyword">void</span> <span class="token function">doDelete</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    void doDelete(List<SObject> recordList);"><span class="lineCounter-0-0-15">13</span>    <span class="token keyword">void</span> <span class="token function">doDelete</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    void doHardDelete(SObject record);"><span class="lineCounter-0-0-15">14</span>    <span class="token keyword">void</span> <span class="token function">doHardDelete</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    void doHardDelete(List<SObject> recordList);"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token keyword">void</span> <span class="token function">doHardDelete</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">16</span><span class="token punctuation">}</span></div><br></code></pre><p>Implementing this in the base class is trivial:</p><pre class="with-bar"><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span>classes/Crud.cls</span></span><div class="line-0-0-16 " data-content="public virtual class Crud implements ICrud {"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">public</span> virtual <span class="token keyword">class</span> <span class="token class-name">Crud</span> <span class="token keyword">implements</span> <span class="token class-name">ICrud</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    //you've already seen the implementation ..."><span class="lineCounter-0-0-15">2</span>    <span class="token comment">//you've already seen the implementation ...</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">3</span><span class="token punctuation">}</span></div><br></code></pre><p>And <strong>now</strong> for my next trick ...</p><pre class="with-bar"><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span>classes/CrudMock.cls</span></span><div class="line-0-0-16 " data-content="//@isTest classes cannot be marked virtual"><span class="lineCounter-0-0-15 prim">1</span><span class="token comment">//@isTest classes cannot be marked virtual</span></div><br><div class="line-0-0-16 " data-content="//bummer"><span class="lineCounter-0-0-15">2</span><span class="token comment">//bummer</span></div><br><div class="line-0-0-16 " data-content="public virtual class CrudMock extends Crud {"><span class="lineCounter-0-0-15">3</span><span class="token keyword">public</span> virtual <span class="token keyword">class</span> <span class="token class-name">CrudMock</span> <span class="token keyword">extends</span> <span class="token class-name">Crud</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    public static List<SObject> InsertedRecords = new List<SObject>();"><span class="lineCounter-0-0-15">4</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">InsertedRecords</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    public static List<SObject> UpsertedRecords = new List<SObject>();"><span class="lineCounter-0-0-15 prim">5</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">UpsertedRecords</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    public static List<SObject> UpdatedRecords = new List<SObject>();"><span class="lineCounter-0-0-15">6</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">UpdatedRecords</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    public static List<SObject> DeletedRecords = new List<SObject>();"><span class="lineCounter-0-0-15">7</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">DeletedRecords</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    public static List<SObject> UndeletedRecords = new List<SObject>();"><span class="lineCounter-0-0-15">8</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">UndeletedRecords</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">9</span></div><br><div class="line-0-0-16 " data-content="    //prevent undue initialization"><span class="lineCounter-0-0-15 prim">10</span>    <span class="token comment">//prevent undue initialization</span></div><br><div class="line-0-0-16 " data-content="    private CrudMock() {}"><span class="lineCounter-0-0-15">11</span>    <span class="token keyword">private</span> <span class="token class-name">CrudMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">12</span></div><br><div class="line-0-0-16 " data-content="    private static CrudMock thisCrudMock;"><span class="lineCounter-0-0-15">13</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">CrudMock</span> thisCrudMock<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">14</span></div><br><div class="line-0-0-16 " data-content="    //provide a getter for use"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token comment">//provide a getter for use</span></div><br><div class="line-0-0-16 " data-content="    public static CrudMock getMock() {"><span class="lineCounter-0-0-15">16</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CrudMock</span> <span class="token function">getMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        if(thisCrudMock == null) {"><span class="lineCounter-0-0-15">17</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>thisCrudMock <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            thisCrudMock = new CrudMock();"><span class="lineCounter-0-0-15">18</span>            thisCrudMock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CrudMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">19</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">20</span></div><br><div class="line-0-0-16 " data-content="        return thisCrudMock;"><span class="lineCounter-0-0-15">21</span>        <span class="token keyword">return</span> thisCrudMock<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">22</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">23</span></div><br><div class="line-0-0-16 " data-content="        // DML"><span class="lineCounter-0-0-15">24</span>        <span class="token comment">// DML</span></div><br><div class="line-0-0-16 " data-content="    public override List<SObject> doInsert(List<SObject> recordList) {"><span class="lineCounter-0-0-15 prim">25</span>    <span class="token keyword">public</span> override <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">doInsert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        TestingUtils.generateIds(recordList);"><span class="lineCounter-0-0-15">26</span>        <span class="token class-name">TestingUtils</span><span class="token punctuation">.</span><span class="token function">generateIds</span><span class="token punctuation">(</span>recordList<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        InsertedRecords.addAll(recordList);"><span class="lineCounter-0-0-15">27</span>        <span class="token class-name">InsertedRecords</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>recordList<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        return recordList;"><span class="lineCounter-0-0-15">28</span>        <span class="token keyword">return</span> recordList<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">29</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    // etc ..."><span class="lineCounter-0-0-15 prim">30</span>    <span class="token comment">// etc ...</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">31</span><span class="token punctuation">}</span></div><br></code></pre><p>A couple of things to note here:</p><ul><li>Insert / Upsert methods stub out Ids using a helper method. Since it's common in tests to confirm record insertion by positing the existence of an SObject's Id, stubbing Ids helps to decouple our tests from the mock DML implementation.</li><li>@isTest classes cannot be marked virtual. You could make the argument that true test safety could be achieved by simply reimplementing the CrudMock class instead of extending the existing Crud class. I've gone back and forth on this many times.</li><li>Within the CrudMock, we also ended up implementing some helpful getter methods for retrieving records of a specific Type. If you're testing a multi-step process with a lot of DML along the way, it can be helpful to pull back only the records you need to assert against. I'll use an example with Tasks below.</li></ul><pre class=""><code class="java code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="//in a test class looking to get ONLY an inserted Task record"><span class="lineCounter-0-0-15 prim">1</span><span class="token comment">//in a test class looking to get ONLY an inserted Task record</span></div><br><div class="line-0-0-16 " data-content="Task t = (Task) CrudMock.Inserted.Tasks.singleOrDefault;"><span class="lineCounter-0-0-15">2</span><span class="token class-name">Task</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Task</span><span class="token punctuation">)</span> <span class="token class-name">CrudMock</span><span class="token punctuation">.</span><span class="token class-name">Inserted</span><span class="token punctuation">.</span><span class="token class-name">Tasks</span><span class="token punctuation">.</span>singleOrDefault<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">3</span></div><br><div class="line-0-0-16 " data-content="//in CrudMock.cls"><span class="lineCounter-0-0-15">4</span><span class="token comment">//in CrudMock.cls</span></div><br><div class="line-0-0-16 " data-content="public static RecordsWrapper Inserted {"><span class="lineCounter-0-0-15 prim">5</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Inserted</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        get {"><span class="lineCounter-0-0-15">6</span>        get <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return new RecordsWrapper(InsertedRecords);"><span class="lineCounter-0-0-15">7</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RecordsWrapper</span><span class="token punctuation">(</span><span class="token class-name">InsertedRecords</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">8</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">9</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">10</span></div><br><div class="line-0-0-16 " data-content="    public static RecordsWrapper Upserted {"><span class="lineCounter-0-0-15">11</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Upserted</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        get {"><span class="lineCounter-0-0-15">12</span>        get <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return new RecordsWrapper(UpsertedRecords);"><span class="lineCounter-0-0-15">13</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RecordsWrapper</span><span class="token punctuation">(</span><span class="token class-name">UpsertedRecords</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">14</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">16</span></div><br><div class="line-0-0-16 " data-content="    public static RecordsWrapper Updated {"><span class="lineCounter-0-0-15">17</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Updated</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        get {"><span class="lineCounter-0-0-15">18</span>        get <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return new RecordsWrapper(UpdatedRecords);"><span class="lineCounter-0-0-15">19</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RecordsWrapper</span><span class="token punctuation">(</span><span class="token class-name">UpdatedRecords</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15 prim">20</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">21</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">22</span></div><br><div class="line-0-0-16 " data-content="    public static RecordsWrapper Deleted {"><span class="lineCounter-0-0-15">23</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Deleted</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        get {"><span class="lineCounter-0-0-15">24</span>        get <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return new RecordsWrapper(DeletedRecords);"><span class="lineCounter-0-0-15 prim">25</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RecordsWrapper</span><span class="token punctuation">(</span><span class="token class-name">DeletedRecords</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">26</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">27</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">28</span></div><br><div class="line-0-0-16 " data-content="    public static RecordsWrapper Undeleted {"><span class="lineCounter-0-0-15">29</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Undeleted</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        get {"><span class="lineCounter-0-0-15 prim">30</span>        get <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return new RecordsWrapper(UndeletedRecords);"><span class="lineCounter-0-0-15">31</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RecordsWrapper</span><span class="token punctuation">(</span><span class="token class-name">UndeletedRecords</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">32</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">33</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">34</span></div><br><div class="line-0-0-16 " data-content="    public class RecordsWrapper {"><span class="lineCounter-0-0-15 prim">35</span>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecordsWrapper</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        List<SObject> recordList;"><span class="lineCounter-0-0-15">36</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        RecordsWrapper(List<SObject> recordList) {"><span class="lineCounter-0-0-15">37</span>        <span class="token class-name">RecordsWrapper</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> recordList<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            this.recordList = recordList;"><span class="lineCounter-0-0-15">38</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>recordList <span class="token operator">=</span> recordList<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">39</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">40</span></div><br><div class="line-0-0-16 " data-content="        public RecordsWrapper ofType(Schema.SObjectType sObjectType) {"><span class="lineCounter-0-0-15">41</span>        <span class="token keyword">public</span> <span class="token class-name">RecordsWrapper</span> <span class="token function">ofType</span><span class="token punctuation">(</span><span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">SObjectType</span> sObjectType<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return new RecordsWrapper(this.getRecordsMatchingType(recordList, sObjectType));"><span class="lineCounter-0-0-15">42</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RecordsWrapper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRecordsMatchingType</span><span class="token punctuation">(</span>recordList<span class="token punctuation">,</span> sObjectType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">43</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">44</span></div><br><div class="line-0-0-16 " data-content="        public RecordsWrapper Accounts { get { return this.ofType(Schema.Account.SObjectType); }}"><span class="lineCounter-0-0-15 prim">45</span>        <span class="token keyword">public</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Accounts</span> <span class="token punctuation">{</span> get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ofType</span><span class="token punctuation">(</span><span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token class-name">SObjectType</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">46</span></div><br><div class="line-0-0-16 " data-content="        public RecordsWrapper Leads { get { return this.ofType(Schema.Lead.SObjectType); }}"><span class="lineCounter-0-0-15">47</span>        <span class="token keyword">public</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Leads</span> <span class="token punctuation">{</span> get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ofType</span><span class="token punctuation">(</span><span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">Lead</span><span class="token punctuation">.</span><span class="token class-name">SObjectType</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">48</span></div><br><div class="line-0-0-16 " data-content="        public RecordsWrapper Contacts { get { return this.ofType(Schema.Contact.SObjectType); }}"><span class="lineCounter-0-0-15">49</span>        <span class="token keyword">public</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Contacts</span> <span class="token punctuation">{</span> get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ofType</span><span class="token punctuation">(</span><span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">Contact</span><span class="token punctuation">.</span><span class="token class-name">SObjectType</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">50</span></div><br><div class="line-0-0-16 " data-content="        public RecordsWrapper Opportunities { get { return this.ofType(Schema.Opportunity.SObjectType); }}"><span class="lineCounter-0-0-15">51</span>        <span class="token keyword">public</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Opportunities</span> <span class="token punctuation">{</span> get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ofType</span><span class="token punctuation">(</span><span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">Opportunity</span><span class="token punctuation">.</span><span class="token class-name">SObjectType</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">52</span></div><br><div class="line-0-0-16 " data-content="        public RecordsWrapper Tasks { get { return this.ofType(Schema.Task.SObjectType); }}"><span class="lineCounter-0-0-15">53</span>        <span class="token keyword">public</span> <span class="token class-name">RecordsWrapper</span> <span class="token class-name">Tasks</span> <span class="token punctuation">{</span> get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ofType</span><span class="token punctuation">(</span><span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">Task</span><span class="token punctuation">.</span><span class="token class-name">SObjectType</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">54</span></div><br><div class="line-0-0-16 " data-content="        public Boolean hasId(Id recordId) {"><span class="lineCounter-0-0-15 prim">55</span>        <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">hasId</span><span class="token punctuation">(</span><span class="token class-name">Id</span> recordId<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            Boolean exists = false;"><span class="lineCounter-0-0-15">56</span>            <span class="token class-name">Boolean</span> exists <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            for(SObject record : this.recordList) {"><span class="lineCounter-0-0-15">57</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>recordList<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                if(record.Id == recordId) {"><span class="lineCounter-0-0-15">58</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">.</span><span class="token class-name">Id</span> <span class="token operator">==</span> recordId<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                    exists = true;"><span class="lineCounter-0-0-15">59</span>                    exists <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="                }"><span class="lineCounter-0-0-15 prim">60</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="            }"><span class="lineCounter-0-0-15">61</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="            return exists;"><span class="lineCounter-0-0-15">62</span>            <span class="token keyword">return</span> exists<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">63</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">64</span></div><br><div class="line-0-0-16 " data-content="        public Boolean hasId(Id whatId, SObjectField idField) {"><span class="lineCounter-0-0-15 prim">65</span>        <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">hasId</span><span class="token punctuation">(</span><span class="token class-name">Id</span> whatId<span class="token punctuation">,</span> <span class="token class-name">SObjectField</span> idField<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            Boolean exists = false;"><span class="lineCounter-0-0-15">66</span>            <span class="token class-name">Boolean</span> exists <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            for(SObject record : this.recordList) {"><span class="lineCounter-0-0-15">67</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>recordList<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                if((Id)record.get(idField) == whatId) {"><span class="lineCounter-0-0-15">68</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Id</span><span class="token punctuation">)</span><span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>idField<span class="token punctuation">)</span> <span class="token operator">==</span> whatId<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                    exists = true;"><span class="lineCounter-0-0-15">69</span>                    exists <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="                }"><span class="lineCounter-0-0-15 prim">70</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="            }"><span class="lineCounter-0-0-15">71</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="            return exists;"><span class="lineCounter-0-0-15">72</span>            <span class="token keyword">return</span> exists<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">73</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">74</span></div><br><div class="line-0-0-16 " data-content="        public Integer size() {"><span class="lineCounter-0-0-15 prim">75</span>        <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            return this.recordList.size();"><span class="lineCounter-0-0-15">76</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>recordList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">77</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">78</span></div><br><div class="line-0-0-16 " data-content="        public SObject singleOrDefault {"><span class="lineCounter-0-0-15">79</span>        <span class="token keyword">public</span> <span class="token class-name">SObject</span> singleOrDefault <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            get {"><span class="lineCounter-0-0-15 prim">80</span>            get <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                if(recordList.size() > 1) {"><span class="lineCounter-0-0-15">81</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>recordList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                    throw new Exceptions.InvalidOperationException();"><span class="lineCounter-0-0-15">82</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exceptions</span><span class="token punctuation">.</span><span class="token class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="                }"><span class="lineCounter-0-0-15">83</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="                return recordList.size() == 0 ? null : recordList[0];"><span class="lineCounter-0-0-15">84</span>                <span class="token keyword">return</span> recordList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> recordList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            }"><span class="lineCounter-0-0-15 prim">85</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">86</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">87</span></div><br><div class="line-0-0-16 " data-content="         public SObject firstOrDefault {"><span class="lineCounter-0-0-15">88</span>         <span class="token keyword">public</span> <span class="token class-name">SObject</span> firstOrDefault <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            get {"><span class="lineCounter-0-0-15">89</span>            get <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                if(recordList.size() > 0) {"><span class="lineCounter-0-0-15 prim">90</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>recordList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                    return recordList[0];"><span class="lineCounter-0-0-15">91</span>                    <span class="token keyword">return</span> recordList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="                }"><span class="lineCounter-0-0-15">92</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="                return null;"><span class="lineCounter-0-0-15">93</span>                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            }"><span class="lineCounter-0-0-15">94</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15 prim">95</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">96</span></div><br><div class="line-0-0-16 " data-content="        public List<SObject> getRecordsMatchingType(List<SObject> records, Schema.SObjectType sObjectType) {"><span class="lineCounter-0-0-15">97</span>        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRecordsMatchingType</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> records<span class="token punctuation">,</span> <span class="token class-name">Schema</span><span class="token punctuation">.</span><span class="token class-name">SObjectType</span> sObjectType<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            List<SObject> matchingRecords = new List<SObject>();"><span class="lineCounter-0-0-15">98</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span> matchingRecords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SObject</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="            for (SObject record : records) {"><span class="lineCounter-0-0-15">99</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SObject</span> <span class="token keyword">record</span> <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                if(record.getSObjectType() == sObjectType) {"><span class="lineCounter-0-0-15 prim">100</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">.</span><span class="token function">getSObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> sObjectType<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="                    matchingRecords.add(record);"><span class="lineCounter-0-0-15">101</span>                    matchingRecords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">record</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="                }"><span class="lineCounter-0-0-15">102</span>                <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="            }"><span class="lineCounter-0-0-15">103</span>            <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="            return matchingRecords;"><span class="lineCounter-0-0-15">104</span>            <span class="token keyword">return</span> matchingRecords<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15 prim">105</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">106</span>    <span class="token punctuation">}</span></div><br></code></pre><p>Yeah. That's some boilerplate right there. In practice, the <code>RecordWrapper</code> helper for the <code>CrudMock</code> came into being only when we realized as a team that we were repetitively trying to filter records out of the static lists implemented in the <code>CrudMock</code>. And that's another important part of practicing TDD correctly: there's a reason I didn't lead with the <code>ICrud</code> interface when beginning this discussion. That would have been a "prefactor," or premature optimization. It wasn't relevant to the subject material at hand.</p><p>Try to avoid the urge to prefactor in your own Apex coding practice, and (when possible) encourage the same in your teammates. TDD at its best allows you (and a friend, if you are doing extreme / paired programming) to extract design elements and shared interfaces from your code as you go, as a product of making the tests pass. Some of the best code I've written on the Force.com platform was the result of refactors -- made possible by excellent unit tests, and the organic need to revisit code.</p><p>I've worked in orgs where you had to swim through layer after layer of abstraction to get to any kind of implementing code. In my experience, over-architecting code leads to unnecessary abstraction and terrible stacktraces. Maintaining the balance between code reusability and readability is of course a life-long see-saw.</p><hr><p>Thanks for tuning in for another <a href="/joys-of-apex/">Joys Of Apex</a> talk -- I hope this post encourages you to think outside the box about how to extract the database from impacting your SFDC unit test time. Next time around, we'll cover some important bridging ground -- now that you've got a DML wrapper for your Apex unit tests, how do you begin to enforce the usage of the actual <code>Crud</code> class in production level code while ensuring that whenever mocking is necessary in your tests, you can easily swap out for the <code>CrudMock</code>? The answer lies in everyone's favorite Gang Of Four pattern - the <a href="/joys-of-apex/dependency-injection-factory-pattern">Factory pattern</a>. (If you just read that and winced ... you truly have my apologies!)</p><div class="contentnav-0-0-7" data-no-search=""><a href="#mocking-dml-through-crud-wrappers" class="h3" data-content-highlight="mocking-dml-through-crud-wrappers">Mocking DML through CRUD wrappers</a><a href="#implementing-the-dml-interface" class="h3" data-content-highlight="implementing-the-dml-interface">Implementing the DML interface</a></div></div><div id="-codedoc-toc" class="toc-0-0-4"><div class="content-0-0-5"><p><a href="/joys-of-apex/">Home</a>
<a href="/joys-of-apex/apex-logging-service">Apex Logging Service</a>
<a href="/joys-of-apex/apex-object-oriented-basics">Apex Object-Oriented Basics</a>
<a href="/joys-of-apex/batchable-and-queueable-apex">Batchable And Queueable Apex</a>
<a href="/joys-of-apex/building-a-better-singleton">Building A Better Singleton</a>
<a href="/joys-of-apex/continuous-integration-with-sfdx">Continuous Integration With SFDX</a>
<a href="/joys-of-apex/dependency-injection-factory-pattern">Dependency Injection &amp; Factory Pattern</a>
<a href="/joys-of-apex/enum-apex-class-gotchas">Enum Apex Class Gotchas</a>
<a href="/joys-of-apex/extendable-apis">Extendable Apis</a>
<a href="/joys-of-apex/future-method-callout-callback">Future Methods, Callouts &amp; Callbacks</a>
<a href="/joys-of-apex/idiomatic-salesforce-apex">Idiomatic Salesforce Apex</a>
<a href="/joys-of-apex/intro">Introduction &amp; Testing Philosophy</a>
<a href="/joys-of-apex/lazy-iterators">Lazy Iterators</a>
<a href="/joys-of-apex/lightweight-trigger-handler">Lightweight Trigger Handler</a>
<a href="/joys-of-apex/lwc-composable-modal">LWC Composable Modal</a>
<a href="/joys-of-apex/lwc-composable-pagination">LWC Composable Pagination</a>
<a href="/joys-of-apex/mocking-dml">Mocking DML</a>
<a href="/joys-of-apex/react-versus-lightning-web-components">React Versus Lightning Web Components</a>
<a href="/joys-of-apex/repository-pattern">Repository Pattern</a>
<a href="/joys-of-apex/sorting-and-performance-in-apex">Sorting And Performance In Apex</a>
<a href="/joys-of-apex/test-driven-development-example">Test Driven Development Example</a>
<a href="/joys-of-apex/writing-performant-apex-tests">Writing Performant Apex Tests</a></p><p><br><br></p><p><a href="https://www.jamessimone.net/">Read more tech articles</a></p></div></div><div class="footer-0-0-3"><div class="left"><script id="eaXLZZldoP">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("eaXLZZldoP", "BWW0vHR4333HbDOiwZ67JA==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"></div></div><div class="right"><script id="aeAutonFsv">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("aeAutonFsv", "6yEdMfRRlNsUBKSBOTazFg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="NclMxMBVKH">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("NclMxMBVKH", "wh9V9isakhdwzlz9ZUjvyw==", {"namespace":"/joys-of-apex"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>