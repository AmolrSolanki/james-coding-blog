<!DOCTYPE html><html><head><title>Joys Of Apex | Lightning Web Components Composable Modal</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="/joys-of-apex/favicon.ico"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/joys-of-apex/styles/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/joys-of-apex/bundle/codedoc-bundle.js"></script><meta property="og:image" content="./img/joys-of-apex-thumbnail.png"><script>window.githubConfig={"repo":"james-coding-blog","user":"jamessimone"}</script><style>.container{padding-top: 0 !important}</style><style>#-codedoc-toc { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px) }</style><meta name="twitter:title" content="Joys Of Apex | Lightning Web Components Composable Modal"><meta property="og:type" content="article"><meta property="og:title" content="Joys Of Apex | Lightning Web Components Composable Modal"></head><body><header style="margin-left: 1rem">Read more at <a href="https://wwww.jamessimone.net">jamessimone.net</a>, or return to the <a href="/joys-of-apex/">homepage</a></header><div id="-codedoc-container" class="container"><script>window.source = {"base":"posts","path":"lwc-composable-modal.md","namespace":"/joys-of-apex","title":{"base":"Joys Of Apex","connector":" | "}}</script><div class="hero-0-0-8" style="margin-bottom: -156px"><img src="/joys-of-apex/img/the-joys-of-apex.png" class="image-0-0-9" data-hero=""><span class="caption-0-0-10"></span></div><marker><br>
<br>
<br>
<br>
<br>

</marker><h1 class="h-0-0-11 "><span style="color: green; 
      text-shadow: none; 
      font-size: 48px"><p>Lightning Web Components Composable Modal</p></span></h1><script id="eDrwKyKzKs">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("eDrwKyKzKs", "kRzsgnV+B7EQTskbovy+YA==", {"src":"github"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div hidden="" data-ignore-text="" data-meta-override-property="og:image"><p>./img/joys-of-apex-thumbnail.png</p></div><p>Continuing on the LWC train from our talk on <a href="/joys-of-apex/lwc-composable-pagination">pagination</a> comes this post on creating a reusable modal, or pop-up, as a Lightning Web Component. Modals, by themselves, have complicated requirements for both accessibility and UX; they must block-off the rest of the screen, for example. It's good practice for a modal to control the page's focus until it is closed. How can we build a <em>composable</em> modal, or one whose implementation is not tied to the existence of another LWC?</p><p>The answer, once more, lies with <em>slots</em>.</p><h2 id="a-quick-aside-on-web-components" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>A Quick Aside On Web Components</h2><p>Before we dive fully in, it's worth pointing out some quirks associated with the <em>Shadow DOM</em>, or the layer on top of the actual DOM (Document Object Model ... or the stuff that actually gets rendered on a web page) that the Web Components standard utilizes to encapsulate a component's consituents, be it styles, JavaScript, or markup. Technically speaking, a <code>&lt;template&gt;</code> based Web Component is self-contained. The HTML (markup), CSS (styles), and JavaScript (behavior) are not supposed to leak beyond the component. In this sense, the Web Component standard resembles backend objects a la Apex in more ways than one. This is why <em>encapsulation</em> is such a big part of the Web Component standard.</p><p>Injecting a Web Component (or Lightning Web Component) with additional markdown by way of <code>&lt;slot&gt;</code>s breaks this encapsulation. Now, the DOM associated with a web component is not just what's in that web component's markup -- since it's also now responsible for rendering however many HTML nodes come from its slots when the web component is used in another component.</p><p>There has been an attempt by MDN (the creators of the Web Component framework) and Salesforce to differentiate between and keep separate the markup injected by way of slots versus the markup that's part of the component's <code>&lt;template&gt;</code>. For this reason, Salesforce includes in their documentation for composition the following tidbit:</p><blockquote><p>The <code>&lt;slot&gt;&lt;/slot&gt;</code> element is part of a component’s shadow tree. To access elements in its shadow tree, a component calls <code>this.template.querySelector()</code> and <code>this.template.querySelectorAll()</code>. However, the DOM elements that are passed into the slot aren’t part of the component’s shadow tree. To access elements passed via slots, a component calls <code>this.querySelector()</code> and <code>this.querySelectorAll()</code>.</p></blockquote><p>That tidbit ended up yielding some interesting results when trying to enforce accessibility constraints within the modal.</p><h2 id="modal-basics" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Modal Basics</h2><p>The <a href="https://www.lightningdesignsystem.com/components/modals/">Lightning Design System features a whole page on modals</a>, including some example markup:</p><p><img src="/joys-of-apex/img/lwc-example-modal.png" alt="The example Lightning Design System modal"></p><p>I'm going to take this markup and run with it. There's one crucial piece of markup, in particular, that we'll need to wrap in a <code>&lt;template if:true&gt;</code> flag:</p><pre class=""><code class="html code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="<template>"><span class="lineCounter-0-0-15 prim">1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  <section>"><span class="lineCounter-0-0-15">2</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    <!-- the rest of the modal content here -->"><span class="lineCounter-0-0-15">3</span>    <span class="token comment">&lt;!-- the rest of the modal content here --&gt;</span></div><br><div class="line-0-0-16 " data-content="  </section>"><span class="lineCounter-0-0-15">4</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  <template if:true=&quot;{isOpen}&quot;>"><span class="lineCounter-0-0-15 prim">5</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">if:</span>true</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{isOpen}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    <div class=&quot;slds-backdrop slds-backdrop_open&quot;></div>"><span class="lineCounter-0-0-15">6</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-backdrop slds-backdrop_open<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  </template>"><span class="lineCounter-0-0-15">7</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="</template>"><span class="lineCounter-0-0-15 prim">8</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br></code></pre><p>That singular <code>&lt;div&gt;</code> at the bottom applies the styles necessary to gray out the remainder of the screen. We'll utilize an <code>isOpen</code> property on the LWC JavaScript controller to determine whether or not to show this. We can also make use of this singular flag to address some accessibility concerns presented in the Lightning Design System documentation:</p><blockquote><p>When the modal is open, everything behind it has HTML attribute <code>aria-hidden="true"</code>, so assistive technology won't read out the underlying page. The best way to do this is to give the modal and the page separate wrapper elements and toggle <code>aria-hidden="true"</code>/<code>aria-hidden="false"</code> on the main page's wrapper depending on whether or not the modal is open.</p></blockquote><p>At first I took the documentation seriously and created a wrapper element; later I was able to handle all of the <code>aria</code> attributes correctly inside of the modal LWC alone. That said, we'll need to control not only the <code>aria-hidden</code> attributes, but also the CSS styles to show/hide the modal. Something like this will do:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="export default class Modal extends LightningElement {"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Modal</span> <span class="token keyword">extends</span> <span class="token class-name">LightningElement</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  isOpen = false;"><span class="lineCounter-0-0-15">2</span>  isOpen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">3</span></div><br><div class="line-0-0-16 " data-content="  // this has to be public so consumers of the modal can tell it to open!"><span class="lineCounter-0-0-15">4</span>  <span class="token comment">// this has to be public so consumers of the modal can tell it to open!</span></div><br><div class="line-0-0-16 " data-content="  @api"><span class="lineCounter-0-0-15 prim">5</span>  @api</div><br><div class="line-0-0-16 " data-content="  toggleModal() {"><span class="lineCounter-0-0-15">6</span>  <span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    this.isOpen = !this.isOpen;"><span class="lineCounter-0-0-15">7</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isOpen <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">8</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  // the crucial CSS necessary to show/hide the modal"><span class="lineCounter-0-0-15">9</span>  <span class="token comment">// the crucial CSS necessary to show/hide the modal</span></div><br><div class="line-0-0-16 " data-content="  @api"><span class="lineCounter-0-0-15 prim">10</span>  @api</div><br><div class="line-0-0-16 " data-content="  get cssClass() {"><span class="lineCounter-0-0-15">11</span>  <span class="token keyword">get</span> <span class="token function">cssClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const baseClass = &quot;slds-modal &quot;;"><span class="lineCounter-0-0-15">12</span>    <span class="token keyword">const</span> baseClass <span class="token operator">=</span> <span class="token string">"slds-modal "</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    return ("><span class="lineCounter-0-0-15">13</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="      baseClass +"><span class="lineCounter-0-0-15">14</span>      baseClass <span class="token operator">+</span></div><br><div class="line-0-0-16 " data-content="      (this.isOpen ? &quot;slds-visible slds-fade-in-open&quot; : &quot;slds-hidden&quot;)"><span class="lineCounter-0-0-15 prim">15</span>      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen <span class="token operator">?</span> <span class="token string">"slds-visible slds-fade-in-open"</span> <span class="token operator">:</span> <span class="token string">"slds-hidden"</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="    );"><span class="lineCounter-0-0-15">16</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">17</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">18</span></div><br><div class="line-0-0-16 " data-content="  // we have to use a separate property for this because you can't negate in markup"><span class="lineCounter-0-0-15">19</span>  <span class="token comment">// we have to use a separate property for this because you can't negate in markup</span></div><br><div class="line-0-0-16 " data-content="  @api"><span class="lineCounter-0-0-15 prim">20</span>  @api</div><br><div class="line-0-0-16 " data-content="  get modalAriaHidden() {"><span class="lineCounter-0-0-15">21</span>  <span class="token keyword">get</span> <span class="token function">modalAriaHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    return !this.isOpen;"><span class="lineCounter-0-0-15">22</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">23</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">24</span><span class="token punctuation">}</span></div><br></code></pre><p>That means our modal's baseline markup will look something like:</p><pre class=""><code class="html code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="<template>"><span class="lineCounter-0-0-15 prim">1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  <section aria-hidden=&quot;{isOpen}&quot; class=&quot;outerModalContent&quot;>"><span class="lineCounter-0-0-15">2</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{isOpen}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>outerModalContent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    <slot name=&quot;body&quot;></slot>"><span class="lineCounter-0-0-15">3</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  </section>"><span class="lineCounter-0-0-15">4</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  <section"><span class="lineCounter-0-0-15 prim">5</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span></span></div><br><div class="line-0-0-16 " data-content="    aria-describedby=&quot;modal-content-id-1&quot;"><span class="lineCounter-0-0-15">6</span>    <span class="token attr-name">aria-describedby</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modal-content-id-1<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    aria-hidden=&quot;{modalAriaHidden}&quot;"><span class="lineCounter-0-0-15">7</span>    <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{modalAriaHidden}<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    aria-labelledby=&quot;modal-heading-01&quot;"><span class="lineCounter-0-0-15">8</span>    <span class="token attr-name">aria-labelledby</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modal-heading-01<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    aria-modal=&quot;true&quot;"><span class="lineCounter-0-0-15">9</span>    <span class="token attr-name">aria-modal</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    class=&quot;{cssClass}&quot;"><span class="lineCounter-0-0-15 prim">10</span>    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{cssClass}<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    role=&quot;dialog&quot;"><span class="lineCounter-0-0-15">11</span>    <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dialog<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    onclick=&quot;{toggleModal}&quot;"><span class="lineCounter-0-0-15">12</span>    <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{toggleModal}<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="  >"><span class="lineCounter-0-0-15">13</span>  <span class="token punctuation">&gt;</span></div><br><div class="line-0-0-16 " data-content="    <div class=&quot;slds-modal__container outerModalContent&quot;>"><span class="lineCounter-0-0-15">14</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-modal__container outerModalContent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="      <div"><span class="lineCounter-0-0-15 prim">15</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span></span></div><br><div class="line-0-0-16 " data-content="        class=&quot;innerModal&quot;"><span class="lineCounter-0-0-15">16</span>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>innerModal<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="        onclick=&quot;{toggleModal}&quot;"><span class="lineCounter-0-0-15">17</span>        <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{toggleModal}<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="        tabindex=&quot;0&quot;"><span class="lineCounter-0-0-15">18</span>        <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="        onfocus=&quot;{handleModalLostFocus}&quot;"><span class="lineCounter-0-0-15">19</span>        <span class="token attr-name">onfocus</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{handleModalLostFocus}<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="      >"><span class="lineCounter-0-0-15 prim">20</span>      <span class="token punctuation">&gt;</span></div><br><div class="line-0-0-16 " data-content="        <template if:true=&quot;{modalHeader}&quot;>"><span class="lineCounter-0-0-15">21</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">if:</span>true</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{modalHeader}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="          <header class=&quot;slds-modal__header&quot;>"><span class="lineCounter-0-0-15">22</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-modal__header<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="            <h2 id=&quot;modal-heading-01&quot; class=&quot;slds-modal__title slds-hyphenate&quot;>"><span class="lineCounter-0-0-15">23</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modal-heading-01<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-modal__title slds-hyphenate<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="              {modalHeader}"><span class="lineCounter-0-0-15">24</span>              {modalHeader}</div><br><div class="line-0-0-16 " data-content="            </h2>"><span class="lineCounter-0-0-15 prim">25</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="            <template if:true=&quot;{modalTagline}&quot;>"><span class="lineCounter-0-0-15">26</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">if:</span>true</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{modalTagline}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="              <p class=&quot;slds-m-top_x-small&quot;>"><span class="lineCounter-0-0-15">27</span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-m-top_x-small<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="                {modalTagline}"><span class="lineCounter-0-0-15">28</span>                {modalTagline}</div><br><div class="line-0-0-16 " data-content="              </p>"><span class="lineCounter-0-0-15">29</span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="            </template>"><span class="lineCounter-0-0-15 prim">30</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="          </header>"><span class="lineCounter-0-0-15">31</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="        </template>"><span class="lineCounter-0-0-15">32</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="        <div"><span class="lineCounter-0-0-15">33</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span></span></div><br><div class="line-0-0-16 " data-content="          class=&quot;slds-modal__content slds-p-around_medium&quot;"><span class="lineCounter-0-0-15">34</span>          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-modal__content slds-p-around_medium<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="          id=&quot;modal-content-id-1&quot;"><span class="lineCounter-0-0-15 prim">35</span>          <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modal-content-id-1<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="        >"><span class="lineCounter-0-0-15">36</span>        <span class="token punctuation">&gt;</span></div><br><div class="line-0-0-16 " data-content="          <slot name=&quot;modalContent&quot;></slot>"><span class="lineCounter-0-0-15">37</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modalContent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="        </div>"><span class="lineCounter-0-0-15">38</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="        <footer class=&quot;slds-modal__footer&quot;>"><span class="lineCounter-0-0-15">39</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-modal__footer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="          <button"><span class="lineCounter-0-0-15 prim">40</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span></span></div><br><div class="line-0-0-16 " data-content="            class=&quot;slds-button slds-button_neutral focusable&quot;"><span class="lineCounter-0-0-15">41</span>            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-button slds-button_neutral focusable<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="            onclick=&quot;{closeModal}&quot;"><span class="lineCounter-0-0-15">42</span>            <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{closeModal}<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="          >"><span class="lineCounter-0-0-15">43</span>          <span class="token punctuation">&gt;</span></div><br><div class="line-0-0-16 " data-content="            Cancel"><span class="lineCounter-0-0-15">44</span>            Cancel</div><br><div class="line-0-0-16 " data-content="          </button>"><span class="lineCounter-0-0-15 prim">45</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="          <template if:true=&quot;{modalSaveHandler}&quot;>"><span class="lineCounter-0-0-15">46</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">if:</span>true</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{modalSaveHandler}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="            <button"><span class="lineCounter-0-0-15">47</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span></span></div><br><div class="line-0-0-16 " data-content="              class=&quot;slds-button slds-button_brand focusable&quot;"><span class="lineCounter-0-0-15">48</span>              <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-button slds-button_brand focusable<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="              onclick=&quot;{modalSaveHandler}&quot;"><span class="lineCounter-0-0-15">49</span>              <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{modalSaveHandler}<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="            >"><span class="lineCounter-0-0-15 prim">50</span>            <span class="token punctuation">&gt;</span></div><br><div class="line-0-0-16 " data-content="              Save"><span class="lineCounter-0-0-15">51</span>              Save</div><br><div class="line-0-0-16 " data-content="            </button>"><span class="lineCounter-0-0-15">52</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="          </template>"><span class="lineCounter-0-0-15">53</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="        </footer>"><span class="lineCounter-0-0-15">54</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="      </div>"><span class="lineCounter-0-0-15 prim">55</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    </div>"><span class="lineCounter-0-0-15">56</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  </section>"><span class="lineCounter-0-0-15">57</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  <template if:true=&quot;{isOpen}&quot;>"><span class="lineCounter-0-0-15">58</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">if:</span>true</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{isOpen}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    <div class=&quot;slds-backdrop slds-backdrop_open outerModalContent&quot;></div>"><span class="lineCounter-0-0-15">59</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-backdrop slds-backdrop_open outerModalContent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  </template>"><span class="lineCounter-0-0-15 prim">60</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="</template>"><span class="lineCounter-0-0-15 prim">61</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br></code></pre><p>So, what do we have?</p><ul><li>some public properties that users of the modal will need to supply; most notably, the optional parameters: <code>modalHeader</code>, <code>modalTagline</code> (strings) and <code>modalSaveHandler</code> (a function) that can be used to display a save button and wire up logic for handling form elements/elements in the modal on submission</li><li>some references to click handlers; <code>closeModal</code> and <code>toggleModal</code> probably need no description, but what the heck is going on with that <code>handleModalLostFocus</code> function??</li><li>the crucial slots that will be used: <code>body</code> for everything not in the modal that is part of the parent Lightning Web Component, and <code>modalContent</code> for ... everything in the modal.</li><li>the addition of a <code>focusable</code> CSS class to be used as a selector for tabbable component elements</li><li>the addition of an <code>innerModal</code> CSS class to be used as a selector</li><li>an <code>outerModalContent</code> CSS class to be used as a selector (an excellent contribution by Justin Lyon, see the "Contributions" section at the end for more info!)</li></ul><h2 id="handling-clicks-and-key-presses-properly-for-modals" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Handling Clicks And Key Presses Properly For Modals</h2><p>Of what's shown above, there are two complicated pieces to address:</p><ul><li>closing the modal when the ESC is pressed <em>or</em> when the area outside the modal is clicked</li><li>enforcing that tab/shift-tab does not move focus to an element outside of the modal while it is opened</li></ul><p>It took quite a few iterations to get things working satisfactorily, and there's still a big caveat (which is why I went through the aside on the Shadow DOM, earlier). Closing the modal is complicated because if the element is not in focus properly when first opened, the ESC keypress won't be "heard", and thus the modal won't close. The modal also technically takes up more than the visible area shown in the example; technically, its bounds extend to the top and bottom of the page (this works in tandem with the aforementioned <code>&lt;div class="slds-backdrop slds-backdrop_open"&gt;</code> to effectively lock navigation while the modal is open). However, if clicks <em>outside</em> the modal are supposed to close it, but we're technically still clicking in the modal's list of DOM nodes ... that's going to represent an issue. Luckily, this one can be handled somewhat gracefully by appending the specific <code>outerModalContent</code> class to the "outer" sections of the modal.</p><p>Once again, there is a key snippet included in the docs (this time in the "Run Code When A Component Is Inserted Or Removed From The DOM" section) that gives us a clue as to how to proceed:</p><blockquote><p>The <code>connectedCallback()</code> lifecycle hook fires when a component is inserted into the DOM. The <code>disconnectedCallback()</code> lifecycle hook fires when a component is removed from the DOM. The framework takes care of managing and cleaning up listeners for you as part of the component lifecycle. However, if you add a listener to anything else (like the window object, the document object, and so on), you’re responsible for removing the listener yourself.</p></blockquote><p>Aha. The window object is available. But be warned -- here be dragons:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="import { api, LightningElement } from &quot;lwc&quot;;"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">import</span> <span class="token punctuation">{</span> api<span class="token punctuation">,</span> LightningElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lwc"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">2</span></div><br><div class="line-0-0-16 " data-content="const ESC_KEY_CODE = 27;"><span class="lineCounter-0-0-15">3</span><span class="token keyword">const</span> <span class="token constant">ESC_KEY_CODE</span> <span class="token operator">=</span> <span class="token number">27</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="const ESC_KEY_STRING = &quot;Escape&quot;;"><span class="lineCounter-0-0-15">4</span><span class="token keyword">const</span> <span class="token constant">ESC_KEY_STRING</span> <span class="token operator">=</span> <span class="token string">"Escape"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="const FOCUSABLE_ELEMENTS = &quot;.focusable&quot;;"><span class="lineCounter-0-0-15 prim">5</span><span class="token keyword">const</span> <span class="token constant">FOCUSABLE_ELEMENTS</span> <span class="token operator">=</span> <span class="token string">".focusable"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="const OUTER_MODAL_CLASS = &quot;outerModalContent&quot;;"><span class="lineCounter-0-0-15">6</span><span class="token keyword">const</span> <span class="token constant">OUTER_MODAL_CLASS</span> <span class="token operator">=</span> <span class="token string">"outerModalContent"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="const TAB_KEY_CODE = 9;"><span class="lineCounter-0-0-15">7</span><span class="token keyword">const</span> <span class="token constant">TAB_KEY_CODE</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="const TAB_KEY_STRING = &quot;Tab&quot;;"><span class="lineCounter-0-0-15">8</span><span class="token keyword">const</span> <span class="token constant">TAB_KEY_STRING</span> <span class="token operator">=</span> <span class="token string">"Tab"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">9</span></div><br><div class="line-0-0-16 " data-content="export default class Modal extends LightningElement {"><span class="lineCounter-0-0-15 prim">10</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Modal</span> <span class="token keyword">extends</span> <span class="token class-name">LightningElement</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  isFirstRender = true;"><span class="lineCounter-0-0-15">11</span>  isFirstRender <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  isOpen = false;"><span class="lineCounter-0-0-15">12</span>  isOpen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">13</span></div><br><div class="line-0-0-16 " data-content="  constructor() {"><span class="lineCounter-0-0-15">14</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    super();"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    this.template.addEventListener(&quot;click&quot;, (event) => {"><span class="lineCounter-0-0-15">16</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      const classList = [...event.target.classList];"><span class="lineCounter-0-0-15">17</span>      <span class="token keyword">const</span> classList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      if (classList.includes(OUTER_MODAL_CLASS)) {"><span class="lineCounter-0-0-15">18</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>classList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token constant">OUTER_MODAL_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        this.toggleModal();"><span class="lineCounter-0-0-15">19</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      }"><span class="lineCounter-0-0-15 prim">20</span>      <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    });"><span class="lineCounter-0-0-15">21</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">22</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">23</span></div><br><div class="line-0-0-16 " data-content="  renderedCallback() {"><span class="lineCounter-0-0-15">24</span>  <span class="token function">renderedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    if (this.isFirstRender) {"><span class="lineCounter-0-0-15 prim">25</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isFirstRender<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      this.isFirstRender = false;"><span class="lineCounter-0-0-15">26</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>isFirstRender <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">27</span></div><br><div class="line-0-0-16 " data-content="      //the &quot;once&quot; option for `addEventListener` should auto-cleanup"><span class="lineCounter-0-0-15">28</span>      <span class="token comment">//the "once" option for `addEventListener` should auto-cleanup</span></div><br><div class="line-0-0-16 " data-content="      window.addEventListener(&quot;keyup&quot;, (e) => this.handleKeyUp(e), {"><span class="lineCounter-0-0-15">29</span>      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"keyup"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleKeyUp</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        once: true,"><span class="lineCounter-0-0-15 prim">30</span>        once<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="      });"><span class="lineCounter-0-0-15">31</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">32</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">33</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">34</span></div><br><div class="line-0-0-16 " data-content="  @api modalHeader;"><span class="lineCounter-0-0-15 prim">35</span>  @api modalHeader<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  @api modalTagline;"><span class="lineCounter-0-0-15">36</span>  @api modalTagline<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  @api modalSaveHandler;"><span class="lineCounter-0-0-15">37</span>  @api modalSaveHandler<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">38</span></div><br><div class="line-0-0-16 " data-content="  @api"><span class="lineCounter-0-0-15">39</span>  @api</div><br><div class="line-0-0-16 " data-content="  toggleModal() {"><span class="lineCounter-0-0-15 prim">40</span>  <span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    this.isOpen = !this.isOpen;"><span class="lineCounter-0-0-15">41</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isOpen <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    if (this.isOpen) {"><span class="lineCounter-0-0-15">42</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      const focusableElems = this._getFocusableElements();"><span class="lineCounter-0-0-15">43</span>      <span class="token keyword">const</span> focusableElems <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getFocusableElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      this._focusFirstTabbableElement(focusableElems);"><span class="lineCounter-0-0-15">44</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_focusFirstTabbableElement</span><span class="token punctuation">(</span>focusableElems<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">45</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">46</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">47</span></div><br><div class="line-0-0-16 " data-content="  @api"><span class="lineCounter-0-0-15">48</span>  @api</div><br><div class="line-0-0-16 " data-content="  get cssClass() {"><span class="lineCounter-0-0-15">49</span>  <span class="token keyword">get</span> <span class="token function">cssClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const baseClass = &quot;slds-modal &quot; + OUTER_MODAL_CLASS + &quot; &quot;;"><span class="lineCounter-0-0-15 prim">50</span>    <span class="token keyword">const</span> baseClass <span class="token operator">=</span> <span class="token string">"slds-modal "</span> <span class="token operator">+</span> <span class="token constant">OUTER_MODAL_CLASS</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    return ("><span class="lineCounter-0-0-15">51</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="      baseClass +"><span class="lineCounter-0-0-15">52</span>      baseClass <span class="token operator">+</span></div><br><div class="line-0-0-16 " data-content="      (this.isOpen ? &quot;slds-visible slds-fade-in-open&quot; : &quot;slds-hidden&quot;)"><span class="lineCounter-0-0-15">53</span>      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen <span class="token operator">?</span> <span class="token string">"slds-visible slds-fade-in-open"</span> <span class="token operator">:</span> <span class="token string">"slds-hidden"</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="    );"><span class="lineCounter-0-0-15">54</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">55</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">56</span></div><br><div class="line-0-0-16 " data-content="  @api"><span class="lineCounter-0-0-15">57</span>  @api</div><br><div class="line-0-0-16 " data-content="  get modalAriaHidden() {"><span class="lineCounter-0-0-15">58</span>  <span class="token keyword">get</span> <span class="token function">modalAriaHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    return !this.isOpen;"><span class="lineCounter-0-0-15">59</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">60</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">61</span></div><br><div class="line-0-0-16 " data-content="  closeModal(event) {"><span class="lineCounter-0-0-15">62</span>  <span class="token function">closeModal</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    event.stopPropagation();"><span class="lineCounter-0-0-15">63</span>    event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    this.toggleModal();"><span class="lineCounter-0-0-15">64</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">65</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">66</span></div><br><div class="line-0-0-16 " data-content="  handleModalLostFocus() {"><span class="lineCounter-0-0-15">67</span>  <span class="token function">handleModalLostFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const focusableElems = this._getFocusableElements();"><span class="lineCounter-0-0-15">68</span>    <span class="token keyword">const</span> focusableElems <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getFocusableElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    this._focusFirstTabbableElement(focusableElems);"><span class="lineCounter-0-0-15">69</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_focusFirstTabbableElement</span><span class="token punctuation">(</span>focusableElems<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">70</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">71</span></div><br><div class="line-0-0-16 " data-content="  handleKeyUp(event) {"><span class="lineCounter-0-0-15">72</span>  <span class="token function">handleKeyUp</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    if (event.keyCode === ESC_KEY_CODE || event.code === ESC_KEY_STRING) {"><span class="lineCounter-0-0-15">73</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">ESC_KEY_CODE</span> <span class="token operator">||</span> event<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token constant">ESC_KEY_STRING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      this.toggleModal();"><span class="lineCounter-0-0-15">74</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    } else if ("><span class="lineCounter-0-0-15 prim">75</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="      event.keyCode === TAB_KEY_CODE ||"><span class="lineCounter-0-0-15">76</span>      event<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">TAB_KEY_CODE</span> <span class="token operator">||</span></div><br><div class="line-0-0-16 " data-content="      event.code === TAB_KEY_STRING"><span class="lineCounter-0-0-15">77</span>      event<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token constant">TAB_KEY_STRING</span></div><br><div class="line-0-0-16 " data-content="    ) {"><span class="lineCounter-0-0-15">78</span>    <span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      const focusableElems = this._getFocusableElements();"><span class="lineCounter-0-0-15">79</span>      <span class="token keyword">const</span> focusableElems <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getFocusableElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      if (this._shouldRefocusToModal(focusableElems)) {"><span class="lineCounter-0-0-15 prim">80</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_shouldRefocusToModal</span><span class="token punctuation">(</span>focusableElems<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        this._focusFirstTabbableElement(focusableElems);"><span class="lineCounter-0-0-15">81</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_focusFirstTabbableElement</span><span class="token punctuation">(</span>focusableElems<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      }"><span class="lineCounter-0-0-15">82</span>      <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">83</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">84</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">85</span></div><br><div class="line-0-0-16 " data-content="  _shouldRefocusToModal(focusableElems) {"><span class="lineCounter-0-0-15">86</span>  <span class="token function">_shouldRefocusToModal</span><span class="token punctuation">(</span><span class="token parameter">focusableElems</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    return focusableElems.indexOf(this.template.activeElement) === -1;"><span class="lineCounter-0-0-15">87</span>    <span class="token keyword">return</span> focusableElems<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span>activeElement<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">88</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">89</span></div><br><div class="line-0-0-16 " data-content="  _getFocusableElements() {"><span class="lineCounter-0-0-15 prim">90</span>  <span class="token function">_getFocusableElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    /*a not obvious distinct between slotted components"><span class="lineCounter-0-0-15">91</span>    <span class="token comment">/*a not obvious distinct between slotted components</span></div><br><div class="line-0-0-16 " data-content="      and the rest of the component's markup:"><span class="lineCounter-0-0-15">92</span>      and the rest of the component's markup:</div><br><div class="line-0-0-16 " data-content="      markup injected by slot appears with this.querySelector"><span class="lineCounter-0-0-15">93</span>      markup injected by slot appears with this.querySelector</div><br><div class="line-0-0-16 " data-content="      or this.querySelectorAll; all other markup for a component"><span class="lineCounter-0-0-15">94</span>      or this.querySelectorAll; all other markup for a component</div><br><div class="line-0-0-16 " data-content="      appears with this.template.querySelector/querySelectorAll."><span class="lineCounter-0-0-15 prim">95</span>      appears with this.template.querySelector/querySelectorAll.</div><br><div class="line-0-0-16 " data-content="      unfortunately, at the present moment I cannot use the focusable"><span class="lineCounter-0-0-15">96</span>      unfortunately, at the present moment I cannot use the focusable</div><br><div class="line-0-0-16 " data-content="      elements returned by this.querySelectorAll, because this.template.activeElement"><span class="lineCounter-0-0-15">97</span>      elements returned by this.querySelectorAll, because this.template.activeElement</div><br><div class="line-0-0-16 " data-content="      is not set when markup injected via slot is focused. I have filed"><span class="lineCounter-0-0-15">98</span>      is not set when markup injected via slot is focused. I have filed</div><br><div class="line-0-0-16 " data-content="      an issue on the LWC github (https://github.com/salesforce/lwc/issues/1923)"><span class="lineCounter-0-0-15">99</span>      an issue on the LWC github (https://github.com/salesforce/lwc/issues/1923)</div><br><div class="line-0-0-16 " data-content="      and will fix the below lines once the issue has been resolved"><span class="lineCounter-0-0-15 prim">100</span>      and will fix the below lines once the issue has been resolved</div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">101</span></div><br><div class="line-0-0-16 " data-content="      const potentialElems = [...this.querySelectorAll(FOCUSABLE_ELEMENTS)];"><span class="lineCounter-0-0-15">102</span>      const potentialElems = [...this.querySelectorAll(FOCUSABLE_ELEMENTS)];</div><br><div class="line-0-0-16 " data-content="      potentialElems.push("><span class="lineCounter-0-0-15">103</span>      potentialElems.push(</div><br><div class="line-0-0-16 " data-content="          ...this.template.querySelectorAll(FOCUSABLE_ELEMENTS)"><span class="lineCounter-0-0-15">104</span>          ...this.template.querySelectorAll(FOCUSABLE_ELEMENTS)</div><br><div class="line-0-0-16 " data-content="      ); */"><span class="lineCounter-0-0-15 prim">105</span>      ); */</div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">106</span></div><br><div class="line-0-0-16 " data-content="    const potentialElems = ["><span class="lineCounter-0-0-15">107</span>    <span class="token keyword">const</span> potentialElems <span class="token operator">=</span> <span class="token punctuation">[</span></div><br><div class="line-0-0-16 " data-content="      ...this.template.querySelectorAll(FOCUSABLE_ELEMENTS),"><span class="lineCounter-0-0-15">108</span>      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token constant">FOCUSABLE_ELEMENTS</span><span class="token punctuation">)</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="    ];"><span class="lineCounter-0-0-15">109</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    return potentialElems;"><span class="lineCounter-0-0-15 prim">110</span>    <span class="token keyword">return</span> potentialElems<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">111</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">112</span></div><br><div class="line-0-0-16 " data-content="  _focusFirstTabbableElement(focusableElems) {"><span class="lineCounter-0-0-15">113</span>  <span class="token function">_focusFirstTabbableElement</span><span class="token punctuation">(</span><span class="token parameter">focusableElems</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    if (focusableElems.length > 0) {"><span class="lineCounter-0-0-15">114</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>focusableElems<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      focusableElems[0].focus();"><span class="lineCounter-0-0-15 prim">115</span>      focusableElems<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">116</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">117</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">118</span><span class="token punctuation">}</span></div><br></code></pre><p>The <code>keyup</code> listener ends up living on the <code>window</code> object, which is necessary to detect ESC presses if the modal is open but not focused.</p><p>In the <a href="https://github.com/jamessimone/lwc-modal">example usage of the modal component on my Github</a>, I show off what a consumer of the <code>modal</code> ends up looking like:</p><p><img src="/joys-of-apex/img/lwc-modal-consumer-github-example.png" alt="LWC example consumer component on Github"></p><p>In the example, the <code>modal_wrapper</code> attempts to use the <code>focusable</code> CSS class to allow its date component to be focusable by the <code>keyup</code> listener. The ideal "tab order" for this component is:</p><ol><li>First tab selects the date-picker element</li><li>Second tab selects the cancel button</li><li>Third tab selects the save button</li></ol><p>Unfortunately, this doesn't quite pan out (as mentioned in the commented out section above for <code>this._getFocusableElements()</code>). I am hopeful that the <a href="https://github.com/salesforce/lwc/issues/1923">Github issue that I have filed with the LWC team</a> will (eventually) be addressed, but at the moment, there's no good way to detect when an element injected by means of a <code>&lt;slot&gt;</code> has been focused. There <em>is</em> a workaround, of sorts, but it's not pretty:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="handleKeyUp(event) {"><span class="lineCounter-0-0-15 prim">1</span><span class="token function">handleKeyUp</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  //the rest of the method is omitted"><span class="lineCounter-0-0-15">2</span>  <span class="token comment">//the rest of the method is omitted</span></div><br><div class="line-0-0-16 " data-content="  else if ("><span class="lineCounter-0-0-15">3</span>  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="    event.keyCode === TAB_KEY_CODE ||"><span class="lineCounter-0-0-15">4</span>    event<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">TAB_KEY_CODE</span> <span class="token operator">||</span></div><br><div class="line-0-0-16 " data-content="    event.code === TAB_KEY_STRING"><span class="lineCounter-0-0-15 prim">5</span>    event<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token constant">TAB_KEY_STRING</span></div><br><div class="line-0-0-16 " data-content="  ) {"><span class="lineCounter-0-0-15">6</span>  <span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const focusableElems = this._getFocusableElements();"><span class="lineCounter-0-0-15">7</span>    <span class="token keyword">const</span> focusableElems <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getFocusableElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    if (this._shouldRefocusToModal(focusableElems)) {"><span class="lineCounter-0-0-15">8</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_shouldRefocusToModal</span><span class="token punctuation">(</span>focusableElems<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        this._focusFirstTabbableElement(focusableElems);"><span class="lineCounter-0-0-15">9</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_focusFirstTabbableElement</span><span class="token punctuation">(</span>focusableElems<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">10</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">11</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">12</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">13</span></div><br><div class="line-0-0-16 " data-content="_shouldRefocusToModal(focusableElems) {"><span class="lineCounter-0-0-15">14</span><span class="token function">_shouldRefocusToModal</span><span class="token punctuation">(</span><span class="token parameter">focusableElems</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    return ("><span class="lineCounter-0-0-15 prim">15</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="        focusableElems"><span class="lineCounter-0-0-15">16</span>        focusableElems</div><br><div class="line-0-0-16 " data-content="            .map(elem =>"><span class="lineCounter-0-0-15">17</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">elem</span> <span class="token operator">=&gt;</span></div><br><div class="line-0-0-16 " data-content="                elem.toString().replace('SecureElement', 'SecureObject')"><span class="lineCounter-0-0-15">18</span>                elem<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'SecureElement'</span><span class="token punctuation">,</span> <span class="token string">'SecureObject'</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="            )"><span class="lineCounter-0-0-15">19</span>            <span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="            .indexOf(document.activeElement.toString()) === -1"><span class="lineCounter-0-0-15 prim">20</span>            <span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>activeElement<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span></div><br><div class="line-0-0-16 " data-content="    );"><span class="lineCounter-0-0-15">21</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15">22</span><span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">23</span></div><br><div class="line-0-0-16 " data-content="_getFocusableElements() {"><span class="lineCounter-0-0-15">24</span><span class="token function">_getFocusableElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  const potentialElems = [...this.querySelectorAll(FOCUSABLE_ELEMENTS)];"><span class="lineCounter-0-0-15 prim">25</span>  <span class="token keyword">const</span> potentialElems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token constant">FOCUSABLE_ELEMENTS</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  potentialElems.push("><span class="lineCounter-0-0-15">26</span>  potentialElems<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="      ...this.template.querySelectorAll(FOCUSABLE_ELEMENTS)"><span class="lineCounter-0-0-15">27</span>      <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token constant">FOCUSABLE_ELEMENTS</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="  );"><span class="lineCounter-0-0-15">28</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">29</span></div><br><div class="line-0-0-16 " data-content="  return potentialElems;"><span class="lineCounter-0-0-15 prim">30</span>  <span class="token keyword">return</span> potentialElems<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">31</span><span class="token punctuation">}</span></div><br></code></pre><p>The gist of the workaround that <a href="https://github.com/w3c/webcomponents/issues/358#issuecomment-597802921">has been posted on one of the associated Github issues</a> doesn't apply here; the <code>document</code>'s <code>shadowRoot</code> object isn't accessible by the component when the handler is invoked, and the <code>activeElement</code> on the document only has a <code>toString</code> method publicly available. Add the Lightning Locker Service into the equation, which makes comparing the <code>activeElement</code> on the <code>document</code> impossible against the <code>HTMLNodeList</code> returned by <code>this_getFocusableElements</code>, and this insane string comparison is the only option left on the table. While I might feel comfortable doing something like this in my own sandbox / scratch org, I wouldn't ever use it at production level (even if it works, which it does).</p><p>Unless a method is exposed via the same modal that <code>this.querySelector/querySelectorAll</code> works to access <code>&lt;slot&gt;</code> based markup that is focused, I'm happy with the component as-is, with the below tab order:</p><ol><li>First tab selects the cancel button</li><li>Second tab selects the save button</li></ol><h2 id="example-modal-implementation" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Example Modal Implementation</h2><p>The markup necessary for a consumer to add the modal to their own markup is quite minimal:</p><pre class=""><code class="html code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="<template>"><span class="lineCounter-0-0-15 prim">1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  <c-modal"><span class="lineCounter-0-0-15">2</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>c-modal</span></span></div><br><div class="line-0-0-16 " data-content="    modal-header=&quot;Modal Header&quot;"><span class="lineCounter-0-0-15">3</span>    <span class="token attr-name">modal-header</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Modal Header<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    modal-tagline=&quot;Some tag line&quot;"><span class="lineCounter-0-0-15">4</span>    <span class="token attr-name">modal-tagline</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Some tag line<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    modal-save-handler=&quot;{modalSaveHandler}&quot;"><span class="lineCounter-0-0-15 prim">5</span>    <span class="token attr-name">modal-save-handler</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{modalSaveHandler}<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="  >"><span class="lineCounter-0-0-15">6</span>  <span class="token punctuation">&gt;</span></div><br><div class="line-0-0-16 " data-content="    <p slot=&quot;body&quot;>This stuff can't be tabbed to when the modal is open</p>"><span class="lineCounter-0-0-15">7</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>body<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>This stuff can't be tabbed to when the modal is open<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    <div"><span class="lineCounter-0-0-15">8</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span></span></div><br><div class="line-0-0-16 " data-content="      slot=&quot;modalContent&quot;"><span class="lineCounter-0-0-15">9</span>      <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modalContent<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="      class=&quot;modalContent slds-modal__content slds-p-around_medium&quot;"><span class="lineCounter-0-0-15 prim">10</span>      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modalContent slds-modal__content slds-p-around_medium<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    >"><span class="lineCounter-0-0-15">11</span>    <span class="token punctuation">&gt;</span></div><br><div class="line-0-0-16 " data-content="      <p>Did you know that &quot;Gallia est omnis divisa in partes tres&quot; ?</p>"><span class="lineCounter-0-0-15">12</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Did you know that "Gallia est omnis divisa in partes tres" ?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="      <!-- not obvious, but &quot;slds-form-element&quot; applies -->"><span class="lineCounter-0-0-15">13</span>      <span class="token comment">&lt;!-- not obvious, but "slds-form-element" applies --&gt;</span></div><br><div class="line-0-0-16 " data-content="      <!-- the styles necessary for this element to &quot;pop out&quot; of the modal -->"><span class="lineCounter-0-0-15">14</span>      <span class="token comment">&lt;!-- the styles necessary for this element to "pop out" of the modal --&gt;</span></div><br><div class="line-0-0-16 " data-content="      <!-- instead of adding scrolling to the inner container -->"><span class="lineCounter-0-0-15 prim">15</span>      <span class="token comment">&lt;!-- instead of adding scrolling to the inner container --&gt;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">16</span></div><br><div class="line-0-0-16 " data-content="      <lightning-input"><span class="lineCounter-0-0-15">17</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lightning-input</span></span></div><br><div class="line-0-0-16 " data-content="        class=&quot;slds-form-element slds-m-around_small focusable&quot;"><span class="lineCounter-0-0-15">18</span>        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-form-element slds-m-around_small focusable<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="        label=&quot;Some field that you have required to save a record&quot;"><span class="lineCounter-0-0-15">19</span>        <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Some field that you have required to save a record<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="        type=&quot;date&quot;"><span class="lineCounter-0-0-15 prim">20</span>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>date<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="        date-style=&quot;short&quot;"><span class="lineCounter-0-0-15">21</span>        <span class="token attr-name">date-</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value">short</span><span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="        required"><span class="lineCounter-0-0-15">22</span>        <span class="token attr-name">required</span></div><br><div class="line-0-0-16 " data-content="      ></lightning-input>"><span class="lineCounter-0-0-15">23</span>      <span class="token punctuation">&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lightning-input</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="      <p>Once you're done selecting the date, click &quot;save&quot; to proceed!</p>"><span class="lineCounter-0-0-15">24</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Once you're done selecting the date, click "save" to proceed!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    </div>"><span class="lineCounter-0-0-15 prim">25</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  </c-modal>"><span class="lineCounter-0-0-15">26</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>c-modal</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  <button class=&quot;slds-m-left_small&quot; onclick=&quot;{handleClick}&quot;>"><span class="lineCounter-0-0-15">27</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-m-left_small<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{handleClick}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    Click me to open modal"><span class="lineCounter-0-0-15">28</span>    Click me to open modal</div><br><div class="line-0-0-16 " data-content="  </button>"><span class="lineCounter-0-0-15">29</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="</template>"><span class="lineCounter-0-0-15 prim">30</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br></code></pre><p>And the example JavaScript controller:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="import { LightningElement } from &quot;lwc&quot;;"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">import</span> <span class="token punctuation">{</span> LightningElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lwc"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="import { ShowToastEvent } from &quot;lightning/platformShowToastEvent&quot;;"><span class="lineCounter-0-0-15">2</span><span class="token keyword">import</span> <span class="token punctuation">{</span> ShowToastEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lightning/platformShowToastEvent"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">3</span></div><br><div class="line-0-0-16 " data-content="export default class ModalWrapper extends LightningElement {"><span class="lineCounter-0-0-15">4</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ModalWrapper</span> <span class="token keyword">extends</span> <span class="token class-name">LightningElement</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  handleClick() {"><span class="lineCounter-0-0-15 prim">5</span>  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    this.template.querySelector(&quot;c-modal&quot;).toggleModal();"><span class="lineCounter-0-0-15">6</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"c-modal"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">7</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">8</span></div><br><div class="line-0-0-16 " data-content="  //we have to use the fat arrow function here"><span class="lineCounter-0-0-15">9</span>  <span class="token comment">//we have to use the fat arrow function here</span></div><br><div class="line-0-0-16 " data-content="  //to retain &quot;this&quot; as the wrapper context"><span class="lineCounter-0-0-15 prim">10</span>  <span class="token comment">//to retain "this" as the wrapper context</span></div><br><div class="line-0-0-16 " data-content="  modalSaveHandler = (event) => {"><span class="lineCounter-0-0-15">11</span>  <span class="token function-variable function">modalSaveHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    //normally here you would do things like"><span class="lineCounter-0-0-15">12</span>    <span class="token comment">//normally here you would do things like</span></div><br><div class="line-0-0-16 " data-content="    //validate your inputs were correctly filled out"><span class="lineCounter-0-0-15">13</span>    <span class="token comment">//validate your inputs were correctly filled out</span></div><br><div class="line-0-0-16 " data-content="    event.stopPropagation();"><span class="lineCounter-0-0-15">14</span>    event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    this.handleClick();"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    this.dispatchEvent("><span class="lineCounter-0-0-15">16</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="      new ShowToastEvent({"><span class="lineCounter-0-0-15">17</span>      <span class="token keyword">new</span> <span class="token class-name">ShowToastEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        title: &quot;Success&quot;,"><span class="lineCounter-0-0-15">18</span>        title<span class="token operator">:</span> <span class="token string">"Success"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="        variant: &quot;success&quot;,"><span class="lineCounter-0-0-15">19</span>        variant<span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="        message: &quot;Record successfully updated!&quot;,"><span class="lineCounter-0-0-15 prim">20</span>        message<span class="token operator">:</span> <span class="token string">"Record successfully updated!"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="      })"><span class="lineCounter-0-0-15">21</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="    );"><span class="lineCounter-0-0-15">22</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  };"><span class="lineCounter-0-0-15">23</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">24</span><span class="token punctuation">}</span></div><br></code></pre><p>If you were using Lightning Data Service or an Apex Controller to save a record in the <code>modalSaveHandler</code>, you would just need to make the function <code>async</code> and only display the toast (or an error) after awaiting the DML operation. Another thing to keep in mind is that if you weren't exposing the modal through a button, and instead were responding to a form element / input changing to some sentinel value, you wouldn't need <code>handleClick</code> to be a public method.</p><h2 id="modal-wrap-up" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Modal Wrap-Up</h2><p>If you need to implement a pop-up modal into your own components, the source code from this post is available on <a href="https://github.com/jamessimone/lwc-modal">my Github</a>. Despite the issues in correctly focusing the inner contents of the modal (assuming you have elements you want to add that are in fact focusable), I like how clean the separation of concerns becomes:</p><ul><li>the modal only needs to know about saving if that's something the parent cares about</li><li>the parent only needs to tell the modal to close if a save operation is successful</li><li>the modal can choose whether or not to display a title/subtitle if the parent so dictates it, but the parent doesn't need to concern itself with that markup logic</li><li>the parent doesn't need to concern itself with accessibility (though if the parent Lightning Web Component wasn't top-level, you might need to consider some kind of delegration strategy to correctly mark the <code>aria</code> attributes properly)</li></ul><p>This is a clean departure from the example modal that's part of the LWC-recipes on Github. Like the <a href="/joys-of-apex/lwc-composable-pagination">example pager I've also shared</a>, I wrote this article to help people bridge the gap between the simple examples shown on Trailhead/Github and the practical, complicated edge-cases associated with actually using a component like this in production.</p><p>I hope you've enjoyed the latest in the <a href="/joys-of-apex/">Joys Of Apex</a>. Writing about Lightning Web Components has proven to be extremely satisfying, and I may spend some time documenting the tests for a component like this next if there is enough interest. When I first started writing about LWC (<a href="/joys-of-apex/react-versus-lightning-web-components">in comparison to React</a>), I had assumed that the usage of Jest was already very established within the SFDC community. Since then, I've had some feedback (and seen some questions online) that have made me realize people are still hungry to see testing examples. Either way, thanks for walking this road with me!</p><h2 id="contributions" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Contributions</h2><ul><li>many thanks to reader and <a href="https://discord.gg/xaM5cYq">SFXD Discord</a> frequenter <strong>havana59er</strong> for his contributions to the article. His investigation into assigning the <code>tabindex</code> property to different sections of the modal, additional <code>handleModalLostFocus</code> handler, and short-circuit feedback for <code>renderedCallback</code> were all excellent. I'm much obliged, and the modal is better off!</li><li>hats off to <a href="https://github.com/jlyon87">Justin Lyon</a>, another <a href="https://discord.gg/xaM5cYq">SFXD Discord</a> frequenter and fellow LWC enthusiast for experimenting with his own modal. He managed to shave off one of the existing <code>window</code> event listeners by the use of explicit classes to determine when the modal should be closed. The post has been updated to reflect this; however, I leave the original solution below because I believe that <code>getBoundingClientRect()</code> is something you should know about when considering your options for examining the size of a contiguous DOM section!</li></ul><p>The original solution for determining when a click was outside the modal looked like this (some sections of the controller omitted for brevity's sake):</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="export default class Modal extends LightningElement {"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Modal</span> <span class="token keyword">extends</span> <span class="token class-name">LightningElement</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  isFirstRender = true;"><span class="lineCounter-0-0-15">2</span>  isFirstRender <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  modalDimensions = {"><span class="lineCounter-0-0-15">3</span>  modalDimensions <span class="token operator">=</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    top: 0,"><span class="lineCounter-0-0-15">4</span>    top<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="    left: 0,"><span class="lineCounter-0-0-15 prim">5</span>    left<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="    bottom: 0,"><span class="lineCounter-0-0-15">6</span>    bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="    right: 0,"><span class="lineCounter-0-0-15">7</span>    right<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="  };"><span class="lineCounter-0-0-15">8</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  eventListeners = ["><span class="lineCounter-0-0-15">9</span>  eventListeners <span class="token operator">=</span> <span class="token punctuation">[</span></div><br><div class="line-0-0-16 " data-content="    { name: &quot;resize&quot;, listener: () => this._setModalSize() },"><span class="lineCounter-0-0-15 prim">10</span>    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"resize"</span><span class="token punctuation">,</span> <span class="token function-variable function">listener</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_setModalSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="    { name: &quot;keyup&quot;, listener: (e) => this.handleKeyUp(e) },"><span class="lineCounter-0-0-15">11</span>    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"keyup"</span><span class="token punctuation">,</span> <span class="token function-variable function">listener</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleKeyUp</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="  ];"><span class="lineCounter-0-0-15">12</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">13</span></div><br><div class="line-0-0-16 " data-content="  renderedCallback() {"><span class="lineCounter-0-0-15">14</span>  <span class="token function">renderedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    //always best to short-circuit when adding event listeners"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token comment">//always best to short-circuit when adding event listeners</span></div><br><div class="line-0-0-16 " data-content="    if (this.isFirstRender) {"><span class="lineCounter-0-0-15">16</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isFirstRender<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      this.isFirstRender = false;"><span class="lineCounter-0-0-15">17</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>isFirstRender <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      this._setModalSize();"><span class="lineCounter-0-0-15">18</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_setModalSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      for (let eventListener of this.eventListeners) {"><span class="lineCounter-0-0-15">19</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> eventListener <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventListeners<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        window.addEventListener(eventListener.name, eventListener.listener);"><span class="lineCounter-0-0-15 prim">20</span>        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventListener<span class="token punctuation">.</span>name<span class="token punctuation">,</span> eventListener<span class="token punctuation">.</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      }"><span class="lineCounter-0-0-15">21</span>      <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">22</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">23</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">24</span></div><br><div class="line-0-0-16 " data-content="  handleInnerModalClick(event) {"><span class="lineCounter-0-0-15 prim">25</span>  <span class="token function">handleInnerModalClick</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    //stop the event from bubbling to the <section>"><span class="lineCounter-0-0-15">26</span>    <span class="token comment">//stop the event from bubbling to the &lt;section&gt;</span></div><br><div class="line-0-0-16 " data-content="    //otherwise any click, anywhere in the modal,"><span class="lineCounter-0-0-15">27</span>    <span class="token comment">//otherwise any click, anywhere in the modal,</span></div><br><div class="line-0-0-16 " data-content="    //will close it"><span class="lineCounter-0-0-15">28</span>    <span class="token comment">//will close it</span></div><br><div class="line-0-0-16 " data-content="    event.stopPropagation();"><span class="lineCounter-0-0-15">29</span>    event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">30</span></div><br><div class="line-0-0-16 " data-content="    const isWithinInnerXBoundary ="><span class="lineCounter-0-0-15">31</span>    <span class="token keyword">const</span> isWithinInnerXBoundary <span class="token operator">=</span></div><br><div class="line-0-0-16 " data-content="      event.clientX >= this.modalDimensions.left &amp;&amp;"><span class="lineCounter-0-0-15">32</span>      event<span class="token punctuation">.</span>clientX <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modalDimensions<span class="token punctuation">.</span>left <span class="token operator">&amp;&amp;</span></div><br><div class="line-0-0-16 " data-content="      event.clientX <= this.modalDimensions.right;"><span class="lineCounter-0-0-15">33</span>      event<span class="token punctuation">.</span>clientX <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modalDimensions<span class="token punctuation">.</span>right<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    const isWithinInnerYBoundary ="><span class="lineCounter-0-0-15">34</span>    <span class="token keyword">const</span> isWithinInnerYBoundary <span class="token operator">=</span></div><br><div class="line-0-0-16 " data-content="      event.clientY >= this.modalDimensions.top &amp;&amp;"><span class="lineCounter-0-0-15 prim">35</span>      event<span class="token punctuation">.</span>clientY <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modalDimensions<span class="token punctuation">.</span>top <span class="token operator">&amp;&amp;</span></div><br><div class="line-0-0-16 " data-content="      event.clientY <= this.modalDimensions.bottom;"><span class="lineCounter-0-0-15">36</span>      event<span class="token punctuation">.</span>clientY <span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modalDimensions<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    if (isWithinInnerXBoundary &amp;&amp; isWithinInnerYBoundary) {"><span class="lineCounter-0-0-15">37</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>isWithinInnerXBoundary <span class="token operator">&amp;&amp;</span> isWithinInnerYBoundary<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      //do nothing, the click was properly within the modal bounds"><span class="lineCounter-0-0-15">38</span>      <span class="token comment">//do nothing, the click was properly within the modal bounds</span></div><br><div class="line-0-0-16 " data-content="      return;"><span class="lineCounter-0-0-15">39</span>      <span class="token keyword">return</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">40</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    this.toggleModal();"><span class="lineCounter-0-0-15">41</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">42</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">43</span></div><br><div class="line-0-0-16 " data-content="  _setModalSize() {"><span class="lineCounter-0-0-15">44</span>  <span class="token function">_setModalSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    //getBoundingClientRect() is one of those"><span class="lineCounter-0-0-15 prim">45</span>    <span class="token comment">//getBoundingClientRect() is one of those</span></div><br><div class="line-0-0-16 " data-content="    //life-saving JS APIs you should know!"><span class="lineCounter-0-0-15">46</span>    <span class="token comment">//life-saving JS APIs you should know!</span></div><br><div class="line-0-0-16 " data-content="    const innerModalDimensions = this.template"><span class="lineCounter-0-0-15">47</span>    <span class="token keyword">const</span> innerModalDimensions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template</div><br><div class="line-0-0-16 " data-content="      .querySelector(INNER_MODAL_CLASS)"><span class="lineCounter-0-0-15">48</span>      <span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token constant">INNER_MODAL_CLASS</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="      .getBoundingClientRect();"><span class="lineCounter-0-0-15">49</span>      <span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    this.modalDimensions { ... innerModalDimensions };"><span class="lineCounter-0-0-15 prim">50</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>modalDimensions <span class="token punctuation">{</span> <span class="token operator">...</span> innerModalDimensions <span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">51</span>  <span class="token punctuation">}</span></div><br></code></pre><div class="contentnav-0-0-7" data-no-search=""><a href="#a-quick-aside-on-web-components" class="h2" data-content-highlight="a-quick-aside-on-web-components">A Quick Aside On Web Components</a><a href="#modal-basics" class="h2" data-content-highlight="modal-basics">Modal Basics</a><a href="#handling-clicks-and-key-presses-properly-for-modals" class="h2" data-content-highlight="handling-clicks-and-key-presses-properly-for-modals">Handling Clicks And Key Presses Properly For Modals</a><a href="#example-modal-implementation" class="h2" data-content-highlight="example-modal-implementation">Example Modal Implementation</a><a href="#modal-wrap-up" class="h2" data-content-highlight="modal-wrap-up">Modal Wrap-Up</a><a href="#contributions" class="h2" data-content-highlight="contributions">Contributions</a></div></div><div id="-codedoc-toc" class="toc-0-0-4"><div class="content-0-0-5"><p><a href="/joys-of-apex/">Home</a>
<a href="/joys-of-apex/apex-logging-service">Apex Logging Service</a>
<a href="/joys-of-apex/apex-object-oriented-basics">Apex Object-Oriented Basics</a>
<a href="/joys-of-apex/batchable-and-queueable-apex">Batchable And Queueable Apex</a>
<a href="/joys-of-apex/building-a-better-singleton">Building A Better Singleton</a>
<a href="/joys-of-apex/continuous-integration-with-sfdx">Continuous Integration With SFDX</a>
<a href="/joys-of-apex/dependency-injection-factory-pattern">Dependency Injection &amp; Factory Pattern</a>
<a href="/joys-of-apex/enum-apex-class-gotchas">Enum Apex Class Gotchas</a>
<a href="/joys-of-apex/extendable-apis">Extendable Apis</a>
<a href="/joys-of-apex/future-method-callout-callback">Future Methods, Callouts &amp; Callbacks</a>
<a href="/joys-of-apex/idiomatic-salesforce-apex">Idiomatic Salesforce Apex</a>
<a href="/joys-of-apex/intro">Introduction &amp; Testing Philosophy</a>
<a href="/joys-of-apex/lazy-iterators">Lazy Iterators</a>
<a href="/joys-of-apex/lightweight-trigger-handler">Lightweight Trigger Handler</a>
<a href="/joys-of-apex/lwc-composable-modal">LWC Composable Modal</a>
<a href="/joys-of-apex/lwc-composable-pagination">LWC Composable Pagination</a>
<a href="/joys-of-apex/mocking-dml">Mocking DML</a>
<a href="/joys-of-apex/react-versus-lightning-web-components">React Versus Lightning Web Components</a>
<a href="/joys-of-apex/repository-pattern">Repository Pattern</a>
<a href="/joys-of-apex/sorting-and-performance-in-apex">Sorting And Performance In Apex</a>
<a href="/joys-of-apex/test-driven-development-example">Test Driven Development Example</a>
<a href="/joys-of-apex/writing-performant-apex-tests">Writing Performant Apex Tests</a></p><p><br><br></p><p><a href="https://www.jamessimone.net/">Read more tech articles</a></p></div></div><div class="footer-0-0-3"><div class="left"><script id="fkXPtRIMXW">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("fkXPtRIMXW", "BWW0vHR4333HbDOiwZ67JA==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"></div></div><div class="right"><script id="jWOYWPOJDv">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("jWOYWPOJDv", "6yEdMfRRlNsUBKSBOTazFg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="gwFrVyRbUt">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("gwFrVyRbUt", "wh9V9isakhdwzlz9ZUjvyw==", {"namespace":"/joys-of-apex"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>