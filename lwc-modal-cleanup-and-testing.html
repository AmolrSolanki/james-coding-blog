<!DOCTYPE html><html><head><title>Joys Of Apex | LWC Modal Cleanup And Testing</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="/joys-of-apex/favicon.ico"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><link href="/joys-of-apex/styles/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/joys-of-apex/bundle/codedoc-bundle.js"></script><meta property="og:image" content="./img/joys-of-apex-thumbnail.png"><script>window.githubConfig={"repo":"james-coding-blog","user":"jamessimone"}</script><style>.container{padding-top: 0 !important}</style><style>#-codedoc-toc { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px) }</style><meta name="twitter:title" content="Joys Of Apex | LWC Modal Cleanup And Testing"><meta property="og:type" content="article"><meta property="og:title" content="Joys Of Apex | LWC Modal Cleanup And Testing"></head><body><header style="margin-left: 1rem">Read more at <a href="https://wwww.jamessimone.net">jamessimone.net</a>, or return to the <a href="/joys-of-apex/">homepage</a></header><div id="-codedoc-container" class="container"><script>window.source = {"base":"posts","path":"lwc-modal-cleanup-and-testing.md","namespace":"/joys-of-apex","title":{"base":"Joys Of Apex","connector":" | "}}</script><div class="hero-0-0-8" style="margin-bottom: -156px"><img src="/joys-of-apex/img/the-joys-of-apex.png" class="image-0-0-9" data-hero=""><span class="caption-0-0-10"></span></div><marker><br>
<br>
<br>
<br>
<br>

</marker><h1 class="h-0-0-11 "><span style="color: green; 
      text-shadow: none; 
      font-size: 48px"><p>LWC Modal Cleanup And Testing</p></span></h1><script id="FePfBMdQOR">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("FePfBMdQOR", "kRzsgnV+B7EQTskbovy+YA==", {"src":"github"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script><div hidden="" data-ignore-text="" data-meta-override-property="og:image"><p>./img/joys-of-apex-thumbnail.png</p></div><p>If you had told a handful of people from the <a href="https://discord.gg/xaM5cYq">SFXD Discord</a> would spend most of our Friday night and weekend working on a better focus-trap for the <a href="/joys-of-apex/lwc-composable-modal">modal article I published on Friday afternoon</a>, I would have laughed. My typical <em>modus operandi</em> when writing begins with brainstorming furiously, often for weeks at a time, followed by a relaxing moment of catharsis as soon as I've published. While I frequently refer back to my own documentation on subjects I want to brush up, the initial relief of having documented something thoroughly often means that I don't revisit things for weeks or even months at a time.</p><p>With the modal, it was not to be -- and for good reason! I'm glad that both on the testing front and the effort to properly detect <code>&lt;slot&gt;</code>-based, focusable, markup proved to be so intriguing for the community at large. I've updated <a href="https://github.com/jamessimone/lwc-modal">my Github repo for the modal</a> with the results -- and the commit history's all there, for anyone interesting in the rapid-fire iteration.</p><h2 id="the-focusable-honeytrap" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>The Focusable Honeytrap</h2><p><a href="https://github.com/surajp">PSB</a> deserves full credit for working on a deterministic way to allow users to cycle through all focusable elements within the modal, regardless of whether those elements came from markup injected by way of <code>&lt;slot&gt;</code>. This is what things ended up looking like within the JavaScript controller:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="import { api, LightningElement } from &quot;lwc&quot;;"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">import</span> <span class="token punctuation">{</span> api<span class="token punctuation">,</span> LightningElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lwc"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">2</span></div><br><div class="line-0-0-16 " data-content="const ESC_KEY_CODE = 27;"><span class="lineCounter-0-0-15">3</span><span class="token keyword">const</span> <span class="token constant">ESC_KEY_CODE</span> <span class="token operator">=</span> <span class="token number">27</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="const ESC_KEY_STRING = &quot;Escape&quot;;"><span class="lineCounter-0-0-15">4</span><span class="token keyword">const</span> <span class="token constant">ESC_KEY_STRING</span> <span class="token operator">=</span> <span class="token string">"Escape"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="const TAB_KEY_CODE = 9;"><span class="lineCounter-0-0-15 prim">5</span><span class="token keyword">const</span> <span class="token constant">TAB_KEY_CODE</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="const TAB_KEY_STRING = &quot;Tab&quot;;"><span class="lineCounter-0-0-15">6</span><span class="token keyword">const</span> <span class="token constant">TAB_KEY_STRING</span> <span class="token operator">=</span> <span class="token string">"Tab"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">7</span></div><br><div class="line-0-0-16 " data-content="export default class Modal extends LightningElement {"><span class="lineCounter-0-0-15">8</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Modal</span> <span class="token keyword">extends</span> <span class="token class-name">LightningElement</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  isFirstRender = true;"><span class="lineCounter-0-0-15">9</span>  isFirstRender <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  isOpen = false;"><span class="lineCounter-0-0-15 prim">10</span>  isOpen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">11</span></div><br><div class="line-0-0-16 " data-content="  outsideClickListener = (e) => {"><span class="lineCounter-0-0-15">12</span>  <span class="token function-variable function">outsideClickListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    e.stopPropagation();"><span class="lineCounter-0-0-15">13</span>    e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    if (!this.isOpen) {"><span class="lineCounter-0-0-15">14</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      return;"><span class="lineCounter-0-0-15 prim">15</span>      <span class="token keyword">return</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">16</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    this.toggleModal();"><span class="lineCounter-0-0-15">17</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  };"><span class="lineCounter-0-0-15">18</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">19</span></div><br><div class="line-0-0-16 " data-content="  renderedCallback() {"><span class="lineCounter-0-0-15 prim">20</span>  <span class="token function">renderedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    this.focusGained = false;"><span class="lineCounter-0-0-15">21</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>focusGained <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    if (this.isFirstRender) {"><span class="lineCounter-0-0-15">22</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isFirstRender<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      this.isFirstRender = false;"><span class="lineCounter-0-0-15">23</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>isFirstRender <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      document.addEventListener(&quot;click&quot;, this.outsideClickListener);"><span class="lineCounter-0-0-15">24</span>      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>outsideClickListener<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15 prim">25</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">26</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">27</span></div><br><div class="line-0-0-16 " data-content="  disconnectedCallback() {"><span class="lineCounter-0-0-15">28</span>  <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    document.removeEventListener(&quot;click&quot;, this.outsideClickListener);"><span class="lineCounter-0-0-15">29</span>    document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>outsideClickListener<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">30</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">31</span></div><br><div class="line-0-0-16 " data-content="  @api modalHeader;"><span class="lineCounter-0-0-15">32</span>  @api modalHeader<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  @api modalTagline;"><span class="lineCounter-0-0-15">33</span>  @api modalTagline<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  @api modalSaveHandler;"><span class="lineCounter-0-0-15">34</span>  @api modalSaveHandler<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">35</span></div><br><div class="line-0-0-16 " data-content="  @api"><span class="lineCounter-0-0-15">36</span>  @api</div><br><div class="line-0-0-16 " data-content="  toggleModal() {"><span class="lineCounter-0-0-15">37</span>  <span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    this.isOpen = !this.isOpen;"><span class="lineCounter-0-0-15">38</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isOpen <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    if (this.isOpen) {"><span class="lineCounter-0-0-15">39</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      this.focusFirstChild();"><span class="lineCounter-0-0-15 prim">40</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">focusFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">41</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">42</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">43</span></div><br><div class="line-0-0-16 " data-content="  @api"><span class="lineCounter-0-0-15">44</span>  @api</div><br><div class="line-0-0-16 " data-content="  get cssClass() {"><span class="lineCounter-0-0-15 prim">45</span>  <span class="token keyword">get</span> <span class="token function">cssClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const baseClasses = [&quot;slds-modal&quot;];"><span class="lineCounter-0-0-15">46</span>    <span class="token keyword">const</span> baseClasses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"slds-modal"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    baseClasses.push(["><span class="lineCounter-0-0-15">47</span>    baseClasses<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span></div><br><div class="line-0-0-16 " data-content="      this.isOpen ? &quot;slds-visible slds-fade-in-open&quot; : &quot;slds-hidden&quot;,"><span class="lineCounter-0-0-15">48</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>isOpen <span class="token operator">?</span> <span class="token string">"slds-visible slds-fade-in-open"</span> <span class="token operator">:</span> <span class="token string">"slds-hidden"</span><span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="    ]);"><span class="lineCounter-0-0-15">49</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    return baseClasses.join(&quot; &quot;);"><span class="lineCounter-0-0-15 prim">50</span>    <span class="token keyword">return</span> baseClasses<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">51</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">52</span></div><br><div class="line-0-0-16 " data-content="  @api"><span class="lineCounter-0-0-15">53</span>  @api</div><br><div class="line-0-0-16 " data-content="  get modalAriaHidden() {"><span class="lineCounter-0-0-15">54</span>  <span class="token keyword">get</span> <span class="token function">modalAriaHidden</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    return !this.isOpen;"><span class="lineCounter-0-0-15 prim">55</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpen<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">56</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">57</span></div><br><div class="line-0-0-16 " data-content="  closeModal(event) {"><span class="lineCounter-0-0-15">58</span>  <span class="token function">closeModal</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    event.stopPropagation();"><span class="lineCounter-0-0-15">59</span>    event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    this.toggleModal();"><span class="lineCounter-0-0-15 prim">60</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">61</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">62</span></div><br><div class="line-0-0-16 " data-content="  innerClickHandler(event) {"><span class="lineCounter-0-0-15">63</span>  <span class="token function">innerClickHandler</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    event.stopPropagation();"><span class="lineCounter-0-0-15">64</span>    event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">65</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">66</span></div><br><div class="line-0-0-16 " data-content="  innerKeyUpHandler(event) {"><span class="lineCounter-0-0-15">67</span>  <span class="token function">innerKeyUpHandler</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    if (event.keyCode === ESC_KEY_CODE || event.code === ESC_KEY_STRING) {"><span class="lineCounter-0-0-15">68</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">ESC_KEY_CODE</span> <span class="token operator">||</span> event<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token constant">ESC_KEY_STRING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      this.toggleModal();"><span class="lineCounter-0-0-15">69</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    } else if ("><span class="lineCounter-0-0-15 prim">70</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="      event.keyCode === TAB_KEY_CODE ||"><span class="lineCounter-0-0-15">71</span>      event<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token constant">TAB_KEY_CODE</span> <span class="token operator">||</span></div><br><div class="line-0-0-16 " data-content="      event.code === TAB_KEY_STRING"><span class="lineCounter-0-0-15">72</span>      event<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token constant">TAB_KEY_STRING</span></div><br><div class="line-0-0-16 " data-content="    ) {"><span class="lineCounter-0-0-15">73</span>    <span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      const el = this.template.activeElement;"><span class="lineCounter-0-0-15">74</span>      <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span>activeElement<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      let focusableElement;"><span class="lineCounter-0-0-15 prim">75</span>      <span class="token keyword">let</span> focusableElement<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      if (event.shiftKey &amp;&amp; el &amp;&amp; el.classList.contains(&quot;firstlink&quot;)) {"><span class="lineCounter-0-0-15">76</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>shiftKey <span class="token operator">&amp;&amp;</span> el <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"firstlink"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        //the save button is only shown"><span class="lineCounter-0-0-15">77</span>        <span class="token comment">//the save button is only shown</span></div><br><div class="line-0-0-16 " data-content="        //for modals with a saveHandler attached"><span class="lineCounter-0-0-15">78</span>        <span class="token comment">//for modals with a saveHandler attached</span></div><br><div class="line-0-0-16 " data-content="        //fallback to the close button, otherwise"><span class="lineCounter-0-0-15">79</span>        <span class="token comment">//fallback to the close button, otherwise</span></div><br><div class="line-0-0-16 " data-content="        focusableElement = this.modalSaveHandler"><span class="lineCounter-0-0-15 prim">80</span>        focusableElement <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modalSaveHandler</div><br><div class="line-0-0-16 " data-content="          ? this.template.querySelector(&quot;button.save&quot;)"><span class="lineCounter-0-0-15">81</span>          <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"button.save"</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="          : this._getCloseButton();"><span class="lineCounter-0-0-15">82</span>          <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getCloseButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      } else if (el &amp;&amp; el.classList.contains(&quot;lastLink&quot;)) {"><span class="lineCounter-0-0-15">83</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>el <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"lastLink"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        focusableElement = this._getCloseButton();"><span class="lineCounter-0-0-15">84</span>        focusableElement <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getCloseButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      }"><span class="lineCounter-0-0-15 prim">85</span>      <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="      if (focusableElement) {"><span class="lineCounter-0-0-15">86</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>focusableElement<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        focusableElement.focus();"><span class="lineCounter-0-0-15">87</span>        focusableElement<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      }"><span class="lineCounter-0-0-15">88</span>      <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">89</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">90</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">91</span></div><br><div class="line-0-0-16 " data-content="  _getCloseButton() {"><span class="lineCounter-0-0-15">92</span>  <span class="token function">_getCloseButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    let closeButton = this.template.querySelector('button[title=&quot;Close&quot;]');"><span class="lineCounter-0-0-15">93</span>    <span class="token keyword">let</span> closeButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'button[title="Close"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    if (!closeButton) {"><span class="lineCounter-0-0-15">94</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>closeButton<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      //if no header is present, the first button is"><span class="lineCounter-0-0-15 prim">95</span>      <span class="token comment">//if no header is present, the first button is</span></div><br><div class="line-0-0-16 " data-content="      //always the cancel button"><span class="lineCounter-0-0-15">96</span>      <span class="token comment">//always the cancel button</span></div><br><div class="line-0-0-16 " data-content="      closeButton = this.template.querySelector(&quot;button&quot;);"><span class="lineCounter-0-0-15">97</span>      closeButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">98</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    return closeButton;"><span class="lineCounter-0-0-15">99</span>    <span class="token keyword">return</span> closeButton<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">100</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">101</span></div><br><div class="line-0-0-16 " data-content="  _getSlotName(element) {"><span class="lineCounter-0-0-15">102</span>  <span class="token function">_getSlotName</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    let slotName = element.slot;"><span class="lineCounter-0-0-15">103</span>    <span class="token keyword">let</span> slotName <span class="token operator">=</span> element<span class="token punctuation">.</span>slot<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    while (!slotName &amp;&amp; element.parentElement) {"><span class="lineCounter-0-0-15">104</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>slotName <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>parentElement<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      slotName = this._getSlotName(element.parentElement);"><span class="lineCounter-0-0-15 prim">105</span>      slotName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getSlotName</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>parentElement<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">106</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    return slotName;"><span class="lineCounter-0-0-15">107</span>    <span class="token keyword">return</span> slotName<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">108</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">109</span></div><br><div class="line-0-0-16 " data-content="  async focusFirstChild() {"><span class="lineCounter-0-0-15 prim">110</span>  <span class="token keyword">async</span> <span class="token function">focusFirstChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const children = [...this.querySelectorAll(&quot;*&quot;)];"><span class="lineCounter-0-0-15">111</span>    <span class="token keyword">const</span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    for (let child of children) {"><span class="lineCounter-0-0-15">112</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> child <span class="token keyword">of</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      let hasBeenFocused = false;"><span class="lineCounter-0-0-15">113</span>      <span class="token keyword">let</span> hasBeenFocused <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      if (this._getSlotName(child) === &quot;body&quot;) {"><span class="lineCounter-0-0-15">114</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getSlotName</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"body"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        continue;"><span class="lineCounter-0-0-15 prim">115</span>        <span class="token keyword">continue</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      }"><span class="lineCounter-0-0-15">116</span>      <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="      await this.setFocus(child).then((res) => {"><span class="lineCounter-0-0-15">117</span>      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setFocus</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        hasBeenFocused = res;"><span class="lineCounter-0-0-15">118</span>        hasBeenFocused <span class="token operator">=</span> res<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      });"><span class="lineCounter-0-0-15">119</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      if (hasBeenFocused) {"><span class="lineCounter-0-0-15 prim">120</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasBeenFocused<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        return;"><span class="lineCounter-0-0-15">121</span>        <span class="token keyword">return</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      }"><span class="lineCounter-0-0-15">122</span>      <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">123</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    //if there is no focusable markup from slots"><span class="lineCounter-0-0-15">124</span>    <span class="token comment">//if there is no focusable markup from slots</span></div><br><div class="line-0-0-16 " data-content="    //focus the first button"><span class="lineCounter-0-0-15 prim">125</span>    <span class="token comment">//focus the first button</span></div><br><div class="line-0-0-16 " data-content="    const closeButton = this._getCloseButton();"><span class="lineCounter-0-0-15">126</span>    <span class="token keyword">const</span> closeButton <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getCloseButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    if (closeButton) {"><span class="lineCounter-0-0-15">127</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>closeButton<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      closeButton.focus();"><span class="lineCounter-0-0-15">128</span>      closeButton<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    }"><span class="lineCounter-0-0-15">129</span>    <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15 prim">130</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">131</span></div><br><div class="line-0-0-16 " data-content="  setFocus(el) {"><span class="lineCounter-0-0-15">132</span>  <span class="token function">setFocus</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    return new Promise((resolve) => {"><span class="lineCounter-0-0-15">133</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      const promiseListener = () => resolve(true);"><span class="lineCounter-0-0-15">134</span>      <span class="token keyword">const</span> <span class="token function-variable function">promiseListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      try {"><span class="lineCounter-0-0-15 prim">135</span>      <span class="token keyword">try</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        el.addEventListener(&quot;focus&quot;, promiseListener);"><span class="lineCounter-0-0-15">136</span>        el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span> promiseListener<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        el.focus();"><span class="lineCounter-0-0-15">137</span>        el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        el.removeEventListener(&quot;focus&quot;, promiseListener);"><span class="lineCounter-0-0-15">138</span>        el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"focus"</span><span class="token punctuation">,</span> promiseListener<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        setTimeout(() => resolve(false), 0);"><span class="lineCounter-0-0-15">139</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      } catch (ex) {"><span class="lineCounter-0-0-15 prim">140</span>      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        resolve(false);"><span class="lineCounter-0-0-15">141</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      }"><span class="lineCounter-0-0-15">142</span>      <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    });"><span class="lineCounter-0-0-15">143</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  }"><span class="lineCounter-0-0-15">144</span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">145</span><span class="token punctuation">}</span></div><br></code></pre><p>Some of the nicer key differences between this and <a href="/joys-of-apex/lwc-composable-modal">the controller you saw in the original article</a>:</p><ul><li>while there is still an outer click listener function, it's attached to the <code>document</code>, which feels better than going for the <code>window</code>. In addition, this click listener relies less on CSS classes than the original, which used the <code>.outerModalContent</code> selector to do its thing.</li><li>take special note of the <code>focusFirstChild</code> and <code>setFocus</code> methods. This promise-based approach to rifling through the focusable elements -- and stopping as soon as one of the elements has been focused -- works really well. We do have to take special precaution to not focus elements that are outside the modal with this approach (since we are using the wildcard <code>*</code> query selector), so the <code>_getSlotName</code> method is employed to ensure that only elements within the modal try to get focused. Special thanks to <strong>AndyV</strong> on Discord for pointing out that the use of <code>setTimeout</code> is necessary because DOM events themselves are async (in comparison to custom events, which fire immediately); ceding control to the event loop allows the DOM event to actually fire on the first focusable element</li></ul><p>The work to make the modal more accessible is ongoing. In an ideal world, the HTML <code>tabindex</code> property would also be factored in to ensure that screen readers know which element is currently focused, and which elements are focusable.</p><h2 id="testing-the-modal-using-sfdx-lwc-jest" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Testing The Modal Using sfdx-lwc-jest</h2><p>As I mentioned when comparing <a href="/joys-of-apex/react-versus-lightning-web-components">React to LWC</a>, we use <code>sfdx-lwc-jest</code> to create tests for our Lightning Web Components. Typically, tests for a LWC are located in a <code>__tests__</code> folder within the LWC's folder itself:</p><pre class=""><code class="undefined code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="SFDX root (./force-app/main/default)"><span class="lineCounter-0-0-15 prim">1</span>SFDX root (./force-app/main/default)</div><br><div class="line-0-0-16 " data-content="│"><span class="lineCounter-0-0-15">2</span>│</div><br><div class="line-0-0-16 " data-content="└───lwc"><span class="lineCounter-0-0-15">3</span>└───lwc</div><br><div class="line-0-0-16 " data-content="│ │ jsconfig.json"><span class="lineCounter-0-0-15">4</span>│ │ jsconfig.json</div><br><div class="line-0-0-16 " data-content="│ │"><span class="lineCounter-0-0-15 prim">5</span>│ │</div><br><div class="line-0-0-16 " data-content="│ └───modal"><span class="lineCounter-0-0-15">6</span>│ └───modal</div><br><div class="line-0-0-16 " data-content="| | |"><span class="lineCounter-0-0-15">7</span>| | |</div><br><div class="line-0-0-16 " data-content="| | └───__tests__"><span class="lineCounter-0-0-15">8</span>| | └───__tests__</div><br><div class="line-0-0-16 " data-content="| | | modal.test.js"><span class="lineCounter-0-0-15">9</span>| | | modal.test.js</div><br><div class="line-0-0-16 " data-content="│ │ modal.js"><span class="lineCounter-0-0-15 prim">10</span>│ │ modal.js</div><br><div class="line-0-0-16 " data-content="│ │ modal.js-meta.xml"><span class="lineCounter-0-0-15">11</span>│ │ modal.js-meta.xml</div><br><div class="line-0-0-16 " data-content="│ │ modal.html"><span class="lineCounter-0-0-15">12</span>│ │ modal.html</div><br><div class="line-0-0-16 " data-content="│"><span class="lineCounter-0-0-15">13</span>│</div><br><div class="line-0-0-16 " data-content="└───classes"><span class="lineCounter-0-0-15">14</span>└───classes</div><br><div class="line-0-0-16 " data-content="│ ..."><span class="lineCounter-0-0-15 prim">15</span>│ ...</div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">16</span></div><br></code></pre><p>Tests that make use of the <code>jest</code> test-runner use <code>describe</code> function calls to group associated tests. Within the <code>describe</code> function, individual tests supply logic using a combination of the <code>it</code> function, which names the test, and the <code>expect</code> library for performing assertions.</p><p>One piece of boilerplate that is required at the moment when using <code>sfdx-lwc-jest</code> is this <code>afterEach</code> call to do DOM cleanup:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="describe('modal tests', () => {"><span class="lineCounter-0-0-15 prim">1</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'modal tests'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    afterEach(() => {"><span class="lineCounter-0-0-15">2</span>    <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="        //the dom has to be reset after every test to prevent"><span class="lineCounter-0-0-15">3</span>        <span class="token comment">//the dom has to be reset after every test to prevent</span></div><br><div class="line-0-0-16 " data-content="        //the modal from preserving state"><span class="lineCounter-0-0-15">4</span>        <span class="token comment">//the modal from preserving state</span></div><br><div class="line-0-0-16 " data-content="        while (document.body.firstChild) {"><span class="lineCounter-0-0-15 prim">5</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="            document.body.removeChild(document.body.firstChild);"><span class="lineCounter-0-0-15">6</span>            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="        }"><span class="lineCounter-0-0-15">7</span>        <span class="token punctuation">}</span></div><br><div class="line-0-0-16 " data-content="    });"><span class="lineCounter-0-0-15">8</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    ..."><span class="lineCounter-0-0-15">9</span>    <span class="token operator">...</span></div><br><div class="line-0-0-16 " data-content="})"><span class="lineCounter-0-0-15 prim">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span></div><br></code></pre><p>Lightning Web Component re-renders (triggered by changes to <code>@api</code> publicly tracked properties, or methods called on the component that update <code>@track</code> properties) occur <em>asynchronously</em>. For this reason, we have to pass a resolved promise to the jest test-runner in each test when asserting for async updates. I like to use a little helper function for this, but it's certainly not required:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="//just a little syntax sugar for testing"><span class="lineCounter-0-0-15 prim">1</span><span class="token comment">//just a little syntax sugar for testing</span></div><br><div class="line-0-0-16 " data-content="function assertForTestConditions() {"><span class="lineCounter-0-0-15">2</span><span class="token keyword">function</span> <span class="token function">assertForTestConditions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  const resolvedPromise = Promise.resolve();"><span class="lineCounter-0-0-15">3</span>  <span class="token keyword">const</span> resolvedPromise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  return resolvedPromise.then.apply(resolvedPromise, arguments);"><span class="lineCounter-0-0-15">4</span>  <span class="token keyword">return</span> resolvedPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>resolvedPromise<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="}"><span class="lineCounter-0-0-15 prim">5</span><span class="token punctuation">}</span></div><br></code></pre><p>To kick us off, let's look at how to test that the modal properly renders the header elements when set. In contrast to the unit tests that we've been covering here when discussing Apex, testing on the front-end is frequently much more on the integration side. For that reason, I tend to group assertions that belong together. In this case, since I'm essentially testing the output of the <code>template if:true</code> statement associated with the modal's header (shown below for clarity), I'm going to cover both that and the modal tagline in the same test:</p><pre class=""><code class="html code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="<template if:true=&quot;{modalHeader}&quot;>"><span class="lineCounter-0-0-15 prim">1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">if:</span>true</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{modalHeader}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  <header class=&quot;slds-modal__header&quot; onclick=&quot;{innerClickHandler}&quot;>"><span class="lineCounter-0-0-15">2</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-modal__header<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{innerClickHandler}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    <button"><span class="lineCounter-0-0-15">3</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span></span></div><br><div class="line-0-0-16 " data-content="      onclick=&quot;{closeModal}&quot;"><span class="lineCounter-0-0-15">4</span>      <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{closeModal}<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="      class=&quot;slds-button slds-button_icon slds-modal__close slds-button_icon-inverse&quot;"><span class="lineCounter-0-0-15 prim">5</span>      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-button slds-button_icon slds-modal__close slds-button_icon-inverse<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="      title=&quot;Close&quot;"><span class="lineCounter-0-0-15">6</span>      <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Close<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="    >"><span class="lineCounter-0-0-15">7</span>    <span class="token punctuation">&gt;</span></div><br><div class="line-0-0-16 " data-content="      <svg class=&quot;slds-button__icon slds-button__icon_large&quot; aria-hidden=&quot;true&quot;>"><span class="lineCounter-0-0-15">8</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-button__icon slds-button__icon_large<span class="token punctuation">"</span></span> <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="        <use"><span class="lineCounter-0-0-15">9</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span></span></div><br><div class="line-0-0-16 " data-content="          xlink:href=&quot;/apexpages/slds/latest/assets/icons/utility-sprite/svg/symbols.svg#close&quot;"><span class="lineCounter-0-0-15 prim">10</span>          <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/apexpages/slds/latest/assets/icons/utility-sprite/svg/symbols.svg#close<span class="token punctuation">"</span></span></div><br><div class="line-0-0-16 " data-content="        ></use>"><span class="lineCounter-0-0-15">11</span>        <span class="token punctuation">&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>use</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="      </svg>"><span class="lineCounter-0-0-15">12</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="      <span class=&quot;slds-assistive-text&quot;>Close</span>"><span class="lineCounter-0-0-15">13</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-assistive-text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Close<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    </button>"><span class="lineCounter-0-0-15">14</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    <h2 id=&quot;modal-heading-01&quot; class=&quot;slds-modal__title slds-hyphenate&quot;>"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>modal-heading-01<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-modal__title slds-hyphenate<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="      {modalHeader}"><span class="lineCounter-0-0-15">16</span>      {modalHeader}</div><br><div class="line-0-0-16 " data-content="    </h2>"><span class="lineCounter-0-0-15">17</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    <template if:true=&quot;{modalTagline}&quot;>"><span class="lineCounter-0-0-15">18</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name"><span class="token namespace">if:</span>true</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{modalTagline}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="      <p class=&quot;slds-m-top_x-small&quot;>"><span class="lineCounter-0-0-15">19</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>slds-m-top_x-small<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="        {modalTagline}"><span class="lineCounter-0-0-15 prim">20</span>        {modalTagline}</div><br><div class="line-0-0-16 " data-content="      </p>"><span class="lineCounter-0-0-15">21</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="    </template>"><span class="lineCounter-0-0-15">22</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="  </header>"><span class="lineCounter-0-0-15">23</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span></div><br><div class="line-0-0-16 " data-content="</template>"><span class="lineCounter-0-0-15 prim">24</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></div><br></code></pre><p>And the test:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="import { createElement } from &quot;lwc&quot;;"><span class="lineCounter-0-0-15 prim">1</span><span class="token keyword">import</span> <span class="token punctuation">{</span> createElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lwc"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">2</span></div><br><div class="line-0-0-16 " data-content="import Modal from &quot;c/modal&quot;;"><span class="lineCounter-0-0-15">3</span><span class="token keyword">import</span> Modal <span class="token keyword">from</span> <span class="token string">"c/modal"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">4</span></div><br><div class="line-0-0-16 " data-content="// the assertForTestConditions previously shown"><span class="lineCounter-0-0-15 prim">5</span><span class="token comment">// the assertForTestConditions previously shown</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">6</span></div><br><div class="line-0-0-16 " data-content="describe(&quot;modal tests&quot;, () => {"><span class="lineCounter-0-0-15">7</span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"modal tests"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  it(&quot;shows modal header elements when header is set&quot;, () => {"><span class="lineCounter-0-0-15">8</span>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"shows modal header elements when header is set"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const modal = createElement(&quot;c-modal&quot;, {"><span class="lineCounter-0-0-15">9</span>    <span class="token keyword">const</span> modal <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"c-modal"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      is: Modal,"><span class="lineCounter-0-0-15 prim">10</span>      is<span class="token operator">:</span> Modal<span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="    });"><span class="lineCounter-0-0-15">11</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    document.body.appendChild(modal);"><span class="lineCounter-0-0-15">12</span>    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>modal<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">13</span></div><br><div class="line-0-0-16 " data-content="    const headerElementBeforeHeaderSet = modal.shadowRoot.querySelector("><span class="lineCounter-0-0-15">14</span>    <span class="token keyword">const</span> headerElementBeforeHeaderSet <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="      &quot;.slds-modal__header&quot;"><span class="lineCounter-0-0-15 prim">15</span>      <span class="token string">".slds-modal__header"</span></div><br><div class="line-0-0-16 " data-content="    );"><span class="lineCounter-0-0-15">16</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(headerElementBeforeHeaderSet).toBeNull();"><span class="lineCounter-0-0-15">17</span>    <span class="token function">expect</span><span class="token punctuation">(</span>headerElementBeforeHeaderSet<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">18</span></div><br><div class="line-0-0-16 " data-content="    //setting an @api value on a LWC triggers a re-render,"><span class="lineCounter-0-0-15">19</span>    <span class="token comment">//setting an @api value on a LWC triggers a re-render,</span></div><br><div class="line-0-0-16 " data-content="    //but the re-render only completes in a resolved promise"><span class="lineCounter-0-0-15 prim">20</span>    <span class="token comment">//but the re-render only completes in a resolved promise</span></div><br><div class="line-0-0-16 " data-content="    //you can gather variables to test the initial state"><span class="lineCounter-0-0-15">21</span>    <span class="token comment">//you can gather variables to test the initial state</span></div><br><div class="line-0-0-16 " data-content="    //prior to returning the resolved promise to the test runner"><span class="lineCounter-0-0-15">22</span>    <span class="token comment">//prior to returning the resolved promise to the test runner</span></div><br><div class="line-0-0-16 " data-content="    //but all updated state must be gathered / asserted for"><span class="lineCounter-0-0-15">23</span>    <span class="token comment">//but all updated state must be gathered / asserted for</span></div><br><div class="line-0-0-16 " data-content="    //within the promise"><span class="lineCounter-0-0-15">24</span>    <span class="token comment">//within the promise</span></div><br><div class="line-0-0-16 " data-content="    modal.modalHeader = &quot;Some Header&quot;;"><span class="lineCounter-0-0-15 prim">25</span>    modal<span class="token punctuation">.</span>modalHeader <span class="token operator">=</span> <span class="token string">"Some Header"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    modal.modalTagline = &quot;Some tag line&quot;;"><span class="lineCounter-0-0-15">26</span>    modal<span class="token punctuation">.</span>modalTagline <span class="token operator">=</span> <span class="token string">"Some tag line"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">27</span></div><br><div class="line-0-0-16 " data-content="    return assertForTestConditions(() => {"><span class="lineCounter-0-0-15">28</span>    <span class="token keyword">return</span> <span class="token function">assertForTestConditions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="      const headerElementAfterHeaderSet = modal.shadowRoot.querySelector("><span class="lineCounter-0-0-15">29</span>      <span class="token keyword">const</span> headerElementAfterHeaderSet <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="        &quot;.slds-modal__header&quot;"><span class="lineCounter-0-0-15 prim">30</span>        <span class="token string">".slds-modal__header"</span></div><br><div class="line-0-0-16 " data-content="      );"><span class="lineCounter-0-0-15">31</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      expect(headerElementAfterHeaderSet).not.toBeNull();"><span class="lineCounter-0-0-15">32</span>      <span class="token function">expect</span><span class="token punctuation">(</span>headerElementAfterHeaderSet<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      expect("><span class="lineCounter-0-0-15">33</span>      <span class="token function">expect</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="        modal.shadowRoot.querySelector(&quot;.slds-modal__title&quot;).textContent"><span class="lineCounter-0-0-15">34</span>        modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".slds-modal__title"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent</div><br><div class="line-0-0-16 " data-content="      ).toEqual(&quot;Some Header&quot;);"><span class="lineCounter-0-0-15 prim">35</span>      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">"Some Header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">36</span></div><br><div class="line-0-0-16 " data-content="      const modalTagline = modal.shadowRoot.querySelector("><span class="lineCounter-0-0-15">37</span>      <span class="token keyword">const</span> modalTagline <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="        &quot;.slds-m-top_x-small&quot;"><span class="lineCounter-0-0-15">38</span>        <span class="token string">".slds-m-top_x-small"</span></div><br><div class="line-0-0-16 " data-content="      );"><span class="lineCounter-0-0-15">39</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="      expect(modalTagline.textContent).toEqual(&quot;Some tag line&quot;);"><span class="lineCounter-0-0-15 prim">40</span>      <span class="token function">expect</span><span class="token punctuation">(</span>modalTagline<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">"Some tag line"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    });"><span class="lineCounter-0-0-15">41</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">42</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="});"><span class="lineCounter-0-0-15 prim">43</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><p>In this way, the <em>singular behavior</em> of the template conditional is handled within the confines of one test. This feels like a good compromise in terms of grouping similar behavior into single tests. Note, as well, that when testing we don't have access to the <code>template</code> property of the component; instead, we use the <code>shadowRoot</code> property exposed by the <code>sfdx-lwc-jest</code>'s <code>createElement</code> object. Aside from having to mount this element into the DOM manually (and the aforementioned <code>querySelector</code> difference), the returned <code>modal</code> component behaves the way that you would expect a JavaScript object representation of the component to.</p><p>What else do we need to test for? When the modal is open, we want to ensure that the locking overlay is rendered. We also want to ensure that toggling the modal actually opens it ...</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="it(&quot;shows the modal with backdrop when toggled&quot;, () => {"><span class="lineCounter-0-0-15 prim">1</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"shows the modal with backdrop when toggled"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  const modal = createElement(&quot;c-modal&quot;, {"><span class="lineCounter-0-0-15">2</span>  <span class="token keyword">const</span> modal <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"c-modal"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    is: Modal,"><span class="lineCounter-0-0-15">3</span>    is<span class="token operator">:</span> Modal<span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">4</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  document.body.appendChild(modal);"><span class="lineCounter-0-0-15 prim">5</span>  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>modal<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">6</span></div><br><div class="line-0-0-16 " data-content="  const backdropBeforeToggle = modal.shadowRoot.querySelector("><span class="lineCounter-0-0-15">7</span>  <span class="token keyword">const</span> backdropBeforeToggle <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="    &quot;.slds-backdrop_open&quot;"><span class="lineCounter-0-0-15">8</span>    <span class="token string">".slds-backdrop_open"</span></div><br><div class="line-0-0-16 " data-content="  );"><span class="lineCounter-0-0-15">9</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  expect(backdropBeforeToggle).toBeNull();"><span class="lineCounter-0-0-15 prim">10</span>  <span class="token function">expect</span><span class="token punctuation">(</span>backdropBeforeToggle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  expect(modal.modalAriaHidden).toBeTruthy();"><span class="lineCounter-0-0-15">11</span>  <span class="token function">expect</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>modalAriaHidden<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">12</span></div><br><div class="line-0-0-16 " data-content="  modal.toggleModal();"><span class="lineCounter-0-0-15">13</span>  modal<span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">14</span></div><br><div class="line-0-0-16 " data-content="  return assertForTestConditions(() => {"><span class="lineCounter-0-0-15 prim">15</span>  <span class="token keyword">return</span> <span class="token function">assertForTestConditions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    expect(modal.modalAriaHidden).toBeFalsy();"><span class="lineCounter-0-0-15">16</span>    <span class="token function">expect</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>modalAriaHidden<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeFalsy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">17</span></div><br><div class="line-0-0-16 " data-content="    expect(modal.cssClass).toEqual(&quot;slds-modal slds-visible slds-fade-in-open&quot;);"><span class="lineCounter-0-0-15">18</span>    <span class="token function">expect</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>cssClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">"slds-modal slds-visible slds-fade-in-open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">19</span></div><br><div class="line-0-0-16 " data-content="    const backdropAfterOpen = modal.shadowRoot.querySelector("><span class="lineCounter-0-0-15 prim">20</span>    <span class="token keyword">const</span> backdropAfterOpen <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="      &quot;.slds-backdrop_open&quot;"><span class="lineCounter-0-0-15">21</span>      <span class="token string">".slds-backdrop_open"</span></div><br><div class="line-0-0-16 " data-content="    );"><span class="lineCounter-0-0-15">22</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(backdropAfterOpen).toBeTruthy();"><span class="lineCounter-0-0-15">23</span>    <span class="token function">expect</span><span class="token punctuation">(</span>backdropAfterOpen<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">24</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="});"><span class="lineCounter-0-0-15 prim">25</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><p>The use of the <code>modalAriaHidden</code> property is also a compromise, and one that you might choose to architect differently. This is because <code>modal.isOpen</code> is not an exposed property on the component.</p><hr><p>OK, so we've tested the modal's public properties being set (aside from the save handler, but more on that later); now we're in the realm of opening and closing, so might as well cover those cases:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="it(&quot;hides the modal when outer modal is clicked&quot;, () => {"><span class="lineCounter-0-0-15 prim">1</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"hides the modal when outer modal is clicked"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  const modal = createElement(&quot;c-modal&quot;, {"><span class="lineCounter-0-0-15">2</span>  <span class="token keyword">const</span> modal <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"c-modal"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    is: Modal,"><span class="lineCounter-0-0-15">3</span>    is<span class="token operator">:</span> Modal<span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">4</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  document.body.appendChild(modal);"><span class="lineCounter-0-0-15 prim">5</span>  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>modal<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">6</span></div><br><div class="line-0-0-16 " data-content="  modal.toggleModal();"><span class="lineCounter-0-0-15">7</span>  modal<span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">8</span></div><br><div class="line-0-0-16 " data-content="  return assertForTestConditions(() => {"><span class="lineCounter-0-0-15">9</span>  <span class="token keyword">return</span> <span class="token function">assertForTestConditions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const anyOuterElement = modal.shadowRoot.querySelector(&quot;.slds-modal&quot;);"><span class="lineCounter-0-0-15 prim">10</span>    <span class="token keyword">const</span> anyOuterElement <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".slds-modal"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    anyOuterElement.click();"><span class="lineCounter-0-0-15">11</span>    anyOuterElement<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    //note that the positive case for the class"><span class="lineCounter-0-0-15">12</span>    <span class="token comment">//note that the positive case for the class</span></div><br><div class="line-0-0-16 " data-content="    //is already handled, in the above backdrop test"><span class="lineCounter-0-0-15">13</span>    <span class="token comment">//is already handled, in the above backdrop test</span></div><br><div class="line-0-0-16 " data-content="    expect(modal.cssClass).toEqual(&quot;slds-modal slds-hidden&quot;);"><span class="lineCounter-0-0-15">14</span>    <span class="token function">expect</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>cssClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">"slds-modal slds-hidden"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(modal.modalAriaHidden).toBeTruthy();"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token function">expect</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>modalAriaHidden<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">16</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="});"><span class="lineCounter-0-0-15">17</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">18</span></div><br><div class="line-0-0-16 " data-content="it(&quot;hides the modal when the esc key is pressed&quot;, () => {"><span class="lineCounter-0-0-15">19</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"hides the modal when the esc key is pressed"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  const modal = createElement(&quot;c-modal&quot;, {"><span class="lineCounter-0-0-15 prim">20</span>  <span class="token keyword">const</span> modal <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"c-modal"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    is: Modal,"><span class="lineCounter-0-0-15">21</span>    is<span class="token operator">:</span> Modal<span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">22</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  document.body.appendChild(modal);"><span class="lineCounter-0-0-15">23</span>  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>modal<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">24</span></div><br><div class="line-0-0-16 " data-content="  modal.toggleModal();"><span class="lineCounter-0-0-15 prim">25</span>  modal<span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">26</span></div><br><div class="line-0-0-16 " data-content="  return assertForTestConditions(() => {"><span class="lineCounter-0-0-15">27</span>  <span class="token keyword">return</span> <span class="token function">assertForTestConditions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const event = new KeyboardEvent(&quot;keyup&quot;, { code: &quot;Escape&quot; });"><span class="lineCounter-0-0-15">28</span>    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KeyboardEvent</span><span class="token punctuation">(</span><span class="token string">"keyup"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> code<span class="token operator">:</span> <span class="token string">"Escape"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    modal.shadowRoot"><span class="lineCounter-0-0-15">29</span>    modal<span class="token punctuation">.</span>shadowRoot</div><br><div class="line-0-0-16 " data-content="      .querySelector('section[role=&quot;dialog&quot;]')"><span class="lineCounter-0-0-15 prim">30</span>      <span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'section[role="dialog"]'</span><span class="token punctuation">)</span></div><br><div class="line-0-0-16 " data-content="      .dispatchEvent(event);"><span class="lineCounter-0-0-15">31</span>      <span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(modal.modalAriaHidden).toBeTruthy();"><span class="lineCounter-0-0-15">32</span>    <span class="token function">expect</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>modalAriaHidden<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">33</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="});"><span class="lineCounter-0-0-15 prim">34</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><p>Something of special note when simulating keyboard presses/touches is that the event <em>must</em> be dispatched from the DOM node containing the listener; when the modal was attaching the <code>keyup</code> listener to the <code>window</code>, it was <code>window.dispatchEvent</code> that needed to be used.</p><p>On the list of things left to be tested lies showing the save button when a save handler is provided:</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="it(&quot;shows a save button when the modalSaveHandler is provided&quot;, () => {"><span class="lineCounter-0-0-15 prim">1</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"shows a save button when the modalSaveHandler is provided"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  const modal = createElement(&quot;c-modal&quot;, {"><span class="lineCounter-0-0-15">2</span>  <span class="token keyword">const</span> modal <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"c-modal"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    is: Modal,"><span class="lineCounter-0-0-15">3</span>    is<span class="token operator">:</span> Modal<span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">4</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  document.body.appendChild(modal);"><span class="lineCounter-0-0-15 prim">5</span>  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>modal<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">6</span></div><br><div class="line-0-0-16 " data-content="  let wasCalled = false;"><span class="lineCounter-0-0-15">7</span>  <span class="token keyword">let</span> wasCalled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  const modalSaveHandler = () => (wasCalled = true);"><span class="lineCounter-0-0-15">8</span>  <span class="token keyword">const</span> <span class="token function-variable function">modalSaveHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>wasCalled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  modal.modalSaveHandler = modalSaveHandler;"><span class="lineCounter-0-0-15">9</span>  modal<span class="token punctuation">.</span>modalSaveHandler <span class="token operator">=</span> modalSaveHandler<span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">10</span></div><br><div class="line-0-0-16 " data-content="  const saveSelector = `button[class=&quot;slds-button slds-button_brand save&quot;]`;"><span class="lineCounter-0-0-15">11</span>  <span class="token keyword">const</span> saveSelector <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">button[class="slds-button slds-button_brand save"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">12</span></div><br><div class="line-0-0-16 " data-content="  const saveButtonBefore = modal.shadowRoot.querySelector(saveSelector);"><span class="lineCounter-0-0-15">13</span>  <span class="token keyword">const</span> saveButtonBefore <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>saveSelector<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">14</span></div><br><div class="line-0-0-16 " data-content="  return assertForTestConditions(() => {"><span class="lineCounter-0-0-15 prim">15</span>  <span class="token keyword">return</span> <span class="token function">assertForTestConditions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    expect(wasCalled).toBeFalsy();"><span class="lineCounter-0-0-15">16</span>    <span class="token function">expect</span><span class="token punctuation">(</span>wasCalled<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeFalsy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(saveButtonBefore).toBeNull();"><span class="lineCounter-0-0-15">17</span>    <span class="token function">expect</span><span class="token punctuation">(</span>saveButtonBefore<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">18</span></div><br><div class="line-0-0-16 " data-content="    const saveButtonAfter = modal.shadowRoot.querySelector(saveSelector);"><span class="lineCounter-0-0-15">19</span>    <span class="token keyword">const</span> saveButtonAfter <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>saveSelector<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(saveButtonAfter).toBeTruthy();"><span class="lineCounter-0-0-15 prim">20</span>    <span class="token function">expect</span><span class="token punctuation">(</span>saveButtonAfter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    saveButtonAfter.click();"><span class="lineCounter-0-0-15">21</span>    saveButtonAfter<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(wasCalled).toBeTruthy();"><span class="lineCounter-0-0-15">22</span>    <span class="token function">expect</span><span class="token punctuation">(</span>wasCalled<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">23</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="});"><span class="lineCounter-0-0-15 prim">24</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><p>In more complicated cases, we can actually mock function calls using <code>jest.fn()</code> to ensure that the correct values are being passed, but since the handler will be specific to components implementing the modal (leaving no actual logic/passing necessary on the modal's side), that doesn't apply here.</p><p>The only big remaining section to test is how the modal chooses to trap focus and focus the first element. If we were testing the <code>modal_wrapper</code> example component, for example, we would want to verify that the first <code>lightning-input</code> element being passed in was focused. This onus on the consumer of the component is not ideal; I think there are more complicated test setups that would involve either directly manipulating the slotted <code>shadowRoot</code> elements of the modal or relying on the use of a single test wrapper component that was referenced throughout the codebase in order to verify that the focus function is working as intended.</p><p>I'd be curious to hear how people are handling slot-based logic in their components when writing tests. For now, I'll leave off with the tests that <em>are</em> obvious; if there <em>isn't</em> focusable markup, the modal is supposed to fallback to focusing the first cancel button (and where that button will be depends on if a header is supplied or not):</p><pre class=""><code class="javascript code-0-0-14" tabindex="0"><span class="wmbar-0-0-17"><span></span><span></span><span></span><span></span></span><div class="line-0-0-16 " data-content="it(&quot;should focus the close button when no focusable markup is passed and header is present&quot;, () => {"><span class="lineCounter-0-0-15 prim">1</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should focus the close button when no focusable markup is passed and header is present"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  const modal = createElement(&quot;c-modal&quot;, {"><span class="lineCounter-0-0-15">2</span>  <span class="token keyword">const</span> modal <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"c-modal"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    is: Modal,"><span class="lineCounter-0-0-15">3</span>    is<span class="token operator">:</span> Modal<span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">4</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  modal.modalHeader = &quot;Some Value&quot;;"><span class="lineCounter-0-0-15 prim">5</span>  modal<span class="token punctuation">.</span>modalHeader <span class="token operator">=</span> <span class="token string">"Some Value"</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  document.body.appendChild(modal);"><span class="lineCounter-0-0-15">6</span>  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>modal<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">7</span></div><br><div class="line-0-0-16 " data-content="  modal.toggleModal();"><span class="lineCounter-0-0-15">8</span>  modal<span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">9</span></div><br><div class="line-0-0-16 " data-content="  return assertForTestConditions(() => {"><span class="lineCounter-0-0-15 prim">10</span>  <span class="token keyword">return</span> <span class="token function">assertForTestConditions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const firstCloseButton = modal.shadowRoot.querySelector("><span class="lineCounter-0-0-15">11</span>    <span class="token keyword">const</span> firstCloseButton <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span></div><br><div class="line-0-0-16 " data-content="      'button[title=&quot;Close&quot;]'"><span class="lineCounter-0-0-15">12</span>      <span class="token string">'button[title="Close"]'</span></div><br><div class="line-0-0-16 " data-content="    );"><span class="lineCounter-0-0-15">13</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(firstCloseButton).toBeTruthy();"><span class="lineCounter-0-0-15">14</span>    <span class="token function">expect</span><span class="token punctuation">(</span>firstCloseButton<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(modal.shadowRoot.activeElement).toBeTruthy();"><span class="lineCounter-0-0-15 prim">15</span>    <span class="token function">expect</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span>activeElement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">16</span></div><br><div class="line-0-0-16 " data-content="    expect(firstCloseButton).toEqual(modal.shadowRoot.activeElement);"><span class="lineCounter-0-0-15">17</span>    <span class="token function">expect</span><span class="token punctuation">(</span>firstCloseButton<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span>activeElement<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">18</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="});"><span class="lineCounter-0-0-15">19</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15 prim">20</span></div><br><div class="line-0-0-16 " data-content="it(&quot;should focus the cancel button when no focusable markup is passed and no header is present&quot;, () => {"><span class="lineCounter-0-0-15">21</span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should focus the cancel button when no focusable markup is passed and no header is present"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="  const modal = createElement(&quot;c-modal&quot;, {"><span class="lineCounter-0-0-15">22</span>  <span class="token keyword">const</span> modal <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"c-modal"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    is: Modal,"><span class="lineCounter-0-0-15">23</span>    is<span class="token operator">:</span> Modal<span class="token punctuation">,</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15">24</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  document.body.appendChild(modal);"><span class="lineCounter-0-0-15 prim">25</span>  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>modal<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">26</span></div><br><div class="line-0-0-16 " data-content="  modal.toggleModal();"><span class="lineCounter-0-0-15">27</span>  modal<span class="token punctuation">.</span><span class="token function">toggleModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">28</span></div><br><div class="line-0-0-16 " data-content="  return assertForTestConditions(() => {"><span class="lineCounter-0-0-15">29</span>  <span class="token keyword">return</span> <span class="token function">assertForTestConditions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-16 " data-content="    const firstCloseButton = modal.shadowRoot.querySelector(&quot;button&quot;);"><span class="lineCounter-0-0-15 prim">30</span>    <span class="token keyword">const</span> firstCloseButton <span class="token operator">=</span> modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(firstCloseButton).toBeTruthy();"><span class="lineCounter-0-0-15">31</span>    <span class="token function">expect</span><span class="token punctuation">(</span>firstCloseButton<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="    expect(modal.shadowRoot.activeElement).toBeTruthy();"><span class="lineCounter-0-0-15">32</span>    <span class="token function">expect</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span>activeElement<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content=""><span class="lineCounter-0-0-15">33</span></div><br><div class="line-0-0-16 " data-content="    expect(firstCloseButton).toEqual(modal.shadowRoot.activeElement);"><span class="lineCounter-0-0-15">34</span>    <span class="token function">expect</span><span class="token punctuation">(</span>firstCloseButton<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>modal<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span>activeElement<span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="  });"><span class="lineCounter-0-0-15 prim">35</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-16 " data-content="});"><span class="lineCounter-0-0-15 prim">36</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><p>And there you have it. That's the extent of the logic that lives within the modal, tested!</p><h2 id="wrapping-up-testing-the-lwc-modal" class="heading-0-0-12"><span class="anchor-0-0-13" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Wrapping Up Testing The LWC Modal</h2><p>Again, I definitely didn't expect there to be such public interest in improving the modal. It was a really fun weekend collaborating with a variety of people on focus-trap improvements; I also was eager to outline some common test cases.</p><p>Hopefully the latest in the <a href="/joys-of-apex/">Joys Of Apex</a> has proven to be helpful to you when considering how to create and test composable Lightning Web Components -- till next time!</p><div class="contentnav-0-0-7" data-no-search=""><a href="#the-focusable-honeytrap" class="h2" data-content-highlight="the-focusable-honeytrap">The Focusable Honeytrap</a><a href="#testing-the-modal-using-sfdx-lwc-jest" class="h2" data-content-highlight="testing-the-modal-using-sfdx-lwc-jest">Testing The Modal Using sfdx-lwc-jest</a><a href="#wrapping-up-testing-the-lwc-modal" class="h2" data-content-highlight="wrapping-up-testing-the-lwc-modal">Wrapping Up Testing The LWC Modal</a></div></div><div id="-codedoc-toc" class="toc-0-0-4"><div class="content-0-0-5"><p><a href="/joys-of-apex/">Home</a>
<a href="/joys-of-apex/apex-logging-service">Apex Logging Service</a>
<a href="/joys-of-apex/apex-object-oriented-basics">Apex Object-Oriented Basics</a>
<a href="/joys-of-apex/batchable-and-queueable-apex">Batchable And Queueable Apex</a>
<a href="/joys-of-apex/building-a-better-singleton">Building A Better Singleton</a>
<a href="/joys-of-apex/continuous-integration-with-sfdx">Continuous Integration With SFDX</a>
<a href="/joys-of-apex/dependency-injection-factory-pattern">Dependency Injection &amp; Factory Pattern</a>
<a href="/joys-of-apex/enum-apex-class-gotchas">Enum Apex Class Gotchas</a>
<a href="/joys-of-apex/extendable-apis">Extendable Apis</a>
<a href="/joys-of-apex/future-method-callout-callback">Future Methods, Callouts &amp; Callbacks</a>
<a href="/joys-of-apex/idiomatic-salesforce-apex">Idiomatic Salesforce Apex</a>
<a href="/joys-of-apex/intro">Introduction &amp; Testing Philosophy</a>
<a href="/joys-of-apex/lazy-iterators">Lazy Iterators</a>
<a href="/joys-of-apex/lightweight-trigger-handler">Lightweight Trigger Handler</a>
<a href="/joys-of-apex/lwc-composable-modal">LWC Composable Modal</a>
<a href="/joys-of-apex/lwc-composable-pagination">LWC Composable Pagination</a>
<a href="/joys-of-apex/mocking-dml">Mocking DML</a>
<a href="/joys-of-apex/react-versus-lightning-web-components">React Versus Lightning Web Components</a>
<a href="/joys-of-apex/repository-pattern">Repository Pattern</a>
<a href="/joys-of-apex/sorting-and-performance-in-apex">Sorting And Performance In Apex</a>
<a href="/joys-of-apex/test-driven-development-example">Test Driven Development Example</a>
<a href="/joys-of-apex/writing-performant-apex-tests">Writing Performant Apex Tests</a></p><p><br><br></p><p><a href="https://www.jamessimone.net/">Read more tech articles</a></p></div></div><div class="footer-0-0-3"><div class="left"><script id="aTTeMPcnxo">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("aTTeMPcnxo", "BWW0vHR4333HbDOiwZ67JA==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div><div class="main"><div class="inside"></div></div><div class="right"><script id="HtWFuhyJyw">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("HtWFuhyJyw", "6yEdMfRRlNsUBKSBOTazFg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></div></div><script id="EMfSvyfazi">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("EMfSvyfazi", "wh9V9isakhdwzlz9ZUjvyw==", {"namespace":"/joys-of-apex"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); })()</script></body></html>